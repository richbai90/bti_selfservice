{"version":3,"sources":["../../../_itsm_default_v2_template/app/services/requests.list.service.js"],"names":["angular","module","service","RequestListService","$inject","$q","$rootScope","RequestService","SWSessionService","$state","wssHelpers","wssLogging","requestServ","self","name","value","setOrder","oColumn","oIndex","outputConfigObject","requestPage","sortColumn","sortOrder","strSortOrder","outputOrderBy","dbtable","column","pageNo","getPagedRequests","getEntityTableStructure","deferred","defer","isDefined","table","getTableConfig","outputConfig","then","response","outputSQLColumns","resolve","error","logger","reject","promise","selectedRequest","loadingRequests","requestArray","totalRequests","getRequestCount","useClass","useStatus","search","getRequests","params","clearSearch","selectRequest","request","getNextPage","pageNum","checkActiveSession","requestDetails","callRef","go","requestID","watchFilters","$watch","callStatus","newVal","oldVal","callClass"],"mappings":"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","file":"requests.list.service.js","sourcesContent":["(function (){\r\n    'use strict';\r\n    angular\r\n      .module('swSelfService')\r\n      .service('RequestListService', RequestListService);\r\n\r\n    RequestListService.$inject=['$q', '$rootScope','RequestService','SWSessionService', '$state','wssHelpers','wssLogging'];\r\n    function RequestListService($q, $rootScope, RequestService, SWSessionService, $state, wssHelpers, wssLogging) {\r\n      var requestServ = RequestService;\r\n      var self = {\r\n        'loadingRequests': false,\r\n        'outputConfigObject': {},\r\n        'selectedRequest': null,\r\n        'requestArray': [],\r\n        'totalRequests': 0,\r\n        'callClass': 'all',\r\n        'useClass': 'all',\r\n        'callStatus': 'active',\r\n        'useStatus': 'active',\r\n        'pageNo': 1,\r\n        'search': '',\r\n        'callStatuses': [{\r\n          name: 'Active Requests',\r\n          value: 'active'\r\n        }, {\r\n          name: 'On-Hold Requests',\r\n          value: 'onhold'\r\n        }, {\r\n          name: 'Resolved Requests',\r\n          value: 'resolved'\r\n        }, {\r\n          name: 'Closed Requests',\r\n          value: 'closed'\r\n        }, {\r\n          name: 'Cancelled Requests',\r\n          value: 'cancelled'\r\n        }, {\r\n          name: 'All Requests',\r\n          value: 'all'\r\n        }]\r\n      };\r\n\r\n      self.setOrder = function(oColumn, oIndex){\r\n        self.outputConfigObject[self.requestPage].sortColumn = oIndex;\r\n        self.outputConfigObject[self.requestPage].sortOrder = !self.outputConfigObject[self.requestPage].sortOrder;\r\n        var strSortOrder = (self.outputConfigObject[self.requestPage].sortOrder ? 'ASC' : 'DESC');\r\n        self.outputConfigObject[self.requestPage].outputOrderBy = oColumn.dbtable +'.'+oColumn.column+' '+strSortOrder;\r\n        if(self.pageNo === 1) {\r\n          self.getPagedRequests();\r\n        } else {\r\n          self.pageNo = 1;\r\n        }\r\n      };\r\n\r\n      self.getEntityTableStructure = function() {\r\n        var deferred = $q.defer();\r\n        if( !angular.isDefined(self.outputConfigObject[self.requestPage]) ||\r\n            !angular.isDefined(self.outputConfigObject[self.requestPage].table)) {\r\n          wssHelpers.getTableConfig(self.outputConfig).then(function(response){\r\n            if(angular.isDefined(response.outputSQLColumns) && response.outputSQLColumns !== ''){\r\n              self.outputConfigObject[self.requestPage] = response;\r\n            }\r\n            deferred.resolve(\"\");\r\n          }, function(error){\r\n            wssLogging.logger(error, \"ERROR\", \"RequestListService::getEntityTableStructure\", false, false);\r\n            deferred.reject(error);\r\n          });\r\n        } else {\r\n          deferred.resolve(\"\");\r\n        }\r\n        return deferred.promise;\r\n      };\r\n\r\n      self.getPagedRequests = function () {\r\n        self.selectedRequest = null;\r\n        self.loadingRequests = true;\r\n        self.requestArray = [];\r\n        self.totalRequests = 0;\r\n        self.outputConfig = 'table.requests.'+self.requestPage;\r\n        self.getEntityTableStructure().then(function(){\r\n          requestServ.getRequestCount(self.outputConfigObject[self.requestPage], self.useClass, self.useStatus, self.search)\r\n          .then(function(response){\r\n            self.totalRequests = response;\r\n            requestServ.getRequests(self.outputConfigObject[self.requestPage], self.outputConfigObject[self.requestPage].outputSQLColumns, self.useClass, self.useStatus, self.outputConfigObject[self.requestPage].outputOrderBy, self.search, self.pageNo, self.totalRequests)\r\n            .then(function(params){\r\n              self.requestArray = params;\r\n              self.loadingRequests = false;\r\n            }, function(error) {\r\n              self.loadingRequests = false;\r\n              self.totalRequests = 0;\r\n              wssLogging.logger(error, \"ERROR\", \"RequestListService::getPagedRequests\", false, false);\r\n            });\r\n          }, function(error){\r\n            self.loadingRequests = false;\r\n            self.totalRequests = 0;\r\n            wssLogging.logger(error, \"ERROR\", \"RequestListService::getPagedRequests\", false, false);\r\n          });\r\n        }, function(error){\r\n          self.loadingRequests = false;\r\n          self.totalRequests = 0;\r\n          wssLogging.logger(error, \"ERROR\", \"RequestListService::getPagedRequests\", false, false);\r\n        });\r\n      };\r\n\r\n      self.clearSearch = function() {\r\n        self.search = \"\";\r\n      };\r\n\r\n      self.selectRequest = function(request) {\r\n        self.selectedRequest = request;\r\n      };\r\n\r\n      self.getNextPage = function(pageNum) {\r\n        SWSessionService.checkActiveSession().then(function(){\r\n          self.selectedRequest = null;\r\n          self.pageNo = pageNum;\r\n        });\r\n      };\r\n\r\n      self.requestDetails = function(callRef) {\r\n        self.selectedRequest = null;\r\n        self.requestArray = [];\r\n        self.totalRequests = 0;\r\n        self.pageNo = 1;\r\n        $state.go('requestdetails', { requestID: callRef });\r\n      };\r\n\r\n      self.watchFilters = function() {\r\n        $rootScope.$watch(function(){\r\n          return self.callStatus;\r\n        }, function (newVal, oldVal) {\r\n          if (angular.isDefined(newVal.value) && angular.isDefined(oldVal.value) && newVal.value != oldVal.value) {\r\n            self.callStatus = newVal;\r\n            self.useStatus = newVal.value;\r\n            if(self.pageNo === 1) {\r\n              self.getPagedRequests();\r\n            } else {\r\n              self.pageNo = 1;\r\n            }\r\n          }\r\n        });\r\n        $rootScope.$watch(function(){\r\n          return self.callClass;\r\n        }, function (newVal, oldVal) {\r\n          if (angular.isDefined(newVal.value) && angular.isDefined(oldVal.value) && newVal.value != oldVal.value) {\r\n            self.callClass = newVal;\r\n            self.useClass = newVal.value;\r\n            if(self.pageNo === 1) {\r\n              self.getPagedRequests();\r\n            } else {\r\n              self.pageNo = 1;\r\n            }\r\n          }\r\n        });\r\n        $rootScope.$watch(function(){\r\n          return self.pageNo;\r\n        }, function (newVal, oldVal) {\r\n          if (angular.isDefined(newVal)) {\r\n            if(angular.isDefined(self.requestPage)){\r\n              self.getPagedRequests();\r\n            }\r\n          }\r\n        });\r\n        $rootScope.$watch(function(){\r\n          return self.requestPage;\r\n        }, function (newVal, oldVal) {\r\n          if (angular.isDefined(newVal)) {\r\n            //self.pageNo = 1;\r\n            self.getPagedRequests();\r\n          }\r\n        });\r\n        $rootScope.$watch(function(){\r\n          return self.search;\r\n        }, function (newVal) {\r\n          if(angular.isDefined(self.outputConfigObject[self.requestPage])) {\r\n            if (angular.isDefined(newVal)) {\r\n              if(self.pageNo === 1) {\r\n                self.getPagedRequests();\r\n              } else {\r\n                self.pageNo = 1;\r\n              }\r\n            }\r\n          }\r\n        });\r\n      };\r\n\r\n      self.watchFilters();\r\n      self.getEntityTableStructure();\r\n      return self;\r\n    }\r\n})();\r\n"]}