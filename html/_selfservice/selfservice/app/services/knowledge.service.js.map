{"version":3,"sources":["../../../_itsm_default_v2_template/app/services/knowledge.service.js"],"names":["angular","module","factory","KnowledgeService","$inject","$q","XMLMCService","store","wssLogging","self","custDetails","get","instanceConfig","searchKB","searchCriteriaObj","boolSendToast","deferred","defer","xmlmc","MethodCall","searchOperation","searchType","addParam","searchString","isDefined","catalog","catalogId","searchOptions","title","keywords","problem","solution","maxResults","invoke","onSuccess","results","sendToast","resolve","kbArticleArray","Object","prototype","toString","call","document","resultsArray","resultCnt","length","docflags","push","result","onFailure","error","logger","promise","getArticleDetails","strDocRef","params","getDocumentURL","res","url","getKBCatList","folder","getRelatedArticles","arrRelatedArticles","sqparams","getRelatedArticlesSQ","rowData","row","rowArray","rowKey","getRelatedTypes","arrRelatedTypes","getRelatedTypesSQ","strRelatedTypes","forEach","key","type_display","getDefaultSearchSettings","objSettings","getDefSrchSettings","arrSettings","boolChangeCat","setting_value","boolChangeType","catalogName","incrementAccessCounter","getProfileInfo","strCode","strInfo","getProfileInfoSQ","info"],"mappings":"AAAA,CAAC,YAAW;AACR;;AACAA,SACGC,MADH,CACU,eADV,EAEGC,OAFH,CAEW,kBAFX,EAE+BC,gBAF/B;;AAIEA,kBAAiBC,OAAjB,GAAyB,CAAC,IAAD,EAAO,cAAP,EAAsB,OAAtB,EAA8B,YAA9B,CAAzB;;AAEF,UAASD,gBAAT,CAA0BE,EAA1B,EAA8BC,YAA9B,EAA4CC,KAA5C,EAAmDC,UAAnD,EACH;AACC,MAAIC,OAAO;AACV,yBAAsB,gDADZ;AAEV,wBAAqB,0CAFX;AAGV,2BAAwB,+CAHd;AAIV,uBAAoB;;AAJV,GAAX;;AAQAA,OAAKC,WAAL,GAAiBH,MAAMI,GAAN,CAAU,aAAV,CAAjB;AACAF,OAAKG,cAAL,GAAoBL,MAAMI,GAAN,CAAU,gBAAV,CAApB;;AAEAF,OAAKI,QAAL,GAAgB,UAASC,iBAAT,EAA4BC,aAA5B,EAChB;AACC,OAAIC,WAAWX,GAAGY,KAAH,EAAf;AACA,OAAIC,QAAQ,IAAIZ,aAAaa,UAAjB,EAAZ;AACA,OAAIC,eAAJ;;AAEA,OAAIN,kBAAkBO,UAAlB,IAA8B,CAAlC,EACA;AACC;AACAD,sBAAkB,cAAlB;AACAF,UAAMI,QAAN,CAAe,aAAf,EAA8BR,kBAAkBS,YAAhD;;AAEA;AACA,QAAIvB,QAAQwB,SAAR,CAAkBV,kBAAkBW,OAApC,KAAgDX,kBAAkBW,OAAlB,KAA8B,EAA9E,IAAoFX,kBAAkBW,OAAlB,KAA8B,IAAtH,EACA;AACCP,WAAMI,QAAN,CAAe,WAAf,EAA4BR,kBAAkBW,OAAlB,CAA0BC,SAAtD;AACA;AACD,IAXD,MAaA;AACCN,sBAAkB,cAAlB;AACAF,UAAMI,QAAN,CAAe,aAAf,EAA8BR,kBAAkBS,YAAhD;;AAEA;AACA,QAAIvB,QAAQwB,SAAR,CAAkBV,kBAAkBW,OAApC,KAAgDX,kBAAkBW,OAAlB,KAA8B,EAA9E,IAAoFX,kBAAkBW,OAAlB,KAA8B,IAAtH,EACA;AACCP,WAAMI,QAAN,CAAe,WAAf,EAA4BR,kBAAkBW,OAAlB,CAA0BC,SAAtD;AACA;;AAED,QAAIZ,kBAAkBO,UAAlB,IAA8B,CAAlC,EACA;AACC;AACAH,WAAMI,QAAN,CAAe,WAAf,EAA4B,KAA5B;AACA,KAJD,MAMA;AACC;AACAJ,WAAMI,QAAN,CAAe,WAAf,EAA4B,KAA5B;AACA;AACDJ,UAAMI,QAAN,CAAe,aAAf,EAA8BR,kBAAkBa,aAAlB,CAAgCC,KAA9D;AACAV,UAAMI,QAAN,CAAe,gBAAf,EAAiCR,kBAAkBa,aAAlB,CAAgCE,QAAjE;AACAX,UAAMI,QAAN,CAAe,eAAf,EAAgCR,kBAAkBa,aAAlB,CAAgCG,OAAhE;AACAZ,UAAMI,QAAN,CAAe,gBAAf,EAAiCR,kBAAkBa,aAAlB,CAAgCI,QAAjE;AACA;;AAEDb,SAAMI,QAAN,CAAe,YAAf,EAA6BR,kBAAkBkB,UAA/C;;AAEAd,SAAMe,MAAN,CAAa,eAAb,EAA8Bb,eAA9B,EACA;AACCc,eAAW,UAASC,OAAT,EACX;AACM,SAAI,CAACnC,QAAQwB,SAAR,CAAkBW,OAAlB,CAAL,EACL;AACC,UAAIpB,aAAJ,EACA;AACCP,kBAAW4B,SAAX,CAAqB,SAArB,EAAgC,iDAAhC;AACA;AACKpB,eAASqB,OAAT,CAAiB,EAAjB;AACN,MAPI,MASL;AACC,UAAIC,iBAAiB,EAArB;AACA,UAAIC,OAAOC,SAAP,CAAiBC,QAAjB,CAA0BC,IAA1B,CAAgCP,QAAQQ,QAAxC,MAAuD,gBAA3D,EACA;AACC;AACA,WAAIC,eAAeT,QAAQQ,QAA3B;AACA,YAAK,IAAIE,YAAY,CAArB,EAAwBA,YAAYD,aAAaE,MAAjD,EAAyDD,WAAzD,EACA;AACC;AACA,YAAID,aAAaC,SAAb,EAAwBE,QAAxB,IAAoC,GAAxC,EACA;AACCT,wBAAeU,IAAf,CAAoBJ,aAAaC,SAAb,CAApB;AACA;AACD;AACD,OAZD,MAcA;AACC;AACA,WAAII,SAASd,QAAQQ,QAArB;;AAEA;AACA,WAAIM,OAAOF,QAAP,IAAmB,GAAvB,EACA;AACCT,uBAAeU,IAAf,CAAoBC,MAApB;AACA;AACD;AACD,UAAIX,eAAeQ,MAAf,KAA0B,CAA9B,EACA;AACC,WAAI/B,aAAJ,EACA;AACCP,mBAAW4B,SAAX,CAAqB,SAArB,EAAgC,iDAAhC;AACA;AACDpB,gBAASqB,OAAT,CAAiB,EAAjB;AACA,OAPD,MASA;AACCrB,gBAASqB,OAAT,CAAiBC,cAAjB;AACA;AACD;AACD,KAnDF;AAoDCY,eAAW,UAASC,KAAT,EACX;AACCnC,cAASqB,OAAT,CAAiB,EAAjB;AACA7B,gBAAW4C,MAAX,CAAkBD,KAAlB,EAAyB,OAAzB,EAAkC,4BAAlC,EAAgE,KAAhE,EAAuE,KAAvE;AACA;AAxDF,IADA;AA2DA,UAAOnC,SAASqC,OAAhB;AACA,GA3GD;;AA6GA5C,OAAK6C,iBAAL,GAAyB,UAASC,SAAT,EACzB;AACC,OAAIvC,WAAWX,GAAGY,KAAH,EAAf;AACA,OAAIC,QAAQ,IAAIZ,aAAaa,UAAjB,EAAZ;AACAD,SAAMI,QAAN,CAAe,QAAf,EAAyBiC,SAAzB;AACArC,SAAMe,MAAN,CAAa,eAAb,EAA8B,iBAA9B,EACA;AACCC,eAAW,UAASsB,MAAT,EACX;AACCxC,cAASqB,OAAT,CAAiBmB,MAAjB;AACA,KAJF;AAKCN,eAAW,UAASC,KAAT,EACX;AACCnC,cAASqB,OAAT,CAAiB,EAAjB;AACA7B,gBAAW4C,MAAX,CAAkBD,KAAlB,EAAyB,OAAzB,EAAkC,qCAAlC,EAAyE,KAAzE,EAAgF,KAAhF;AACA;AATF,IADA;AAYA,UAAOnC,SAASqC,OAAhB;AACA,GAlBD;;AAoBA5C,OAAKgD,cAAL,GAAsB,UAASF,SAAT,EACtB;AACC,OAAIvC,WAAWX,GAAGY,KAAH,EAAf;AACA,OAAIC,QAAQ,IAAIZ,aAAaa,UAAjB,EAAZ;AACAD,SAAMI,QAAN,CAAe,QAAf,EAAyBiC,SAAzB;AACArC,SAAMe,MAAN,CAAa,eAAb,EAA8B,gBAA9B,EACA;AACCC,eAAW,UAASwB,GAAT,EACX;AACC1C,cAASqB,OAAT,CAAiBqB,IAAIC,GAArB;AACA,KAJF;AAKCT,eAAW,UAASC,KAAT,EACX;AACCnC,cAASqB,OAAT,CAAiB,EAAjB;AACA7B,gBAAW4C,MAAX,CAAkBD,KAAlB,EAAyB,OAAzB,EAAkC,kCAAlC,EAAsE,KAAtE,EAA6E,KAA7E;AACA;AATF,IADA;AAYA,UAAOnC,SAASqC,OAAhB;AACA,GAlBD;;AAoBA5C,OAAKmD,YAAL,GAAoB,YACpB;AACC,OAAI5C,WAAWX,GAAGY,KAAH,EAAf;AACA,OAAIC,QAAQ,IAAIZ,aAAaa,UAAjB,EAAZ;AACAD,SAAMe,MAAN,CAAa,eAAb,EAA8B,aAA9B,EACA;AACCC,eAAW,UAASsB,MAAT,EACX;AACCxC,cAASqB,OAAT,CAAiBmB,OAAOK,MAAxB;AACA,KAJF;AAKCX,eAAW,UAASC,KAAT,EACX;AACCnC,cAASqB,OAAT,CAAiB,EAAjB;AACA7B,gBAAW4C,MAAX,CAAkBD,KAAlB,EAAyB,OAAzB,EAAkC,gCAAlC,EAAoE,KAApE,EAA2E,KAA3E;AACA;AATF,IADA;AAYA,UAAOnC,SAASqC,OAAhB;AACA,GAjBD;;AAmBA5C,OAAKqD,kBAAL,GAA0B,UAASP,SAAT,EAC1B;AACC,OAAIvC,WAAWX,GAAGY,KAAH,EAAf;AACA,OAAI8C,qBAAqB,EAAzB;AACA,OAAI7C,QAAQ,IAAIZ,aAAaa,UAAjB,EAAZ;AACA,OAAI6C,WAAW,YAAUT,SAAzB;AACArC,SAAMI,QAAN,CAAe,aAAf,EAA8Bb,KAAKwD,oBAAnC;AACA/C,SAAMI,QAAN,CAAe,YAAf,EAA6B0C,QAA7B;AACA9C,SAAMe,MAAN,CAAa,MAAb,EAAqB,mBAArB,EACA;AACCC,eAAW,UAASsB,MAAT,EACX;AACC,SAAGA,OAAOU,OAAV,EACA;AACC,UAAI3B,OAAOC,SAAP,CAAiBC,QAAjB,CAA0BC,IAA1B,CAAgCc,OAAOU,OAAP,CAAeC,GAA/C,MAAyD,gBAA7D,EACA;AACC,WAAIC,WAAWZ,OAAOU,OAAP,CAAeC,GAA9B;AACA,YAAK,IAAIE,SAAS,CAAlB,EAAqBA,SAASD,SAAStB,MAAvC,EAA+CuB,QAA/C,EACA;AACCN,2BAAmBf,IAAnB,CAAwBoB,SAASC,MAAT,CAAxB;AACA;AACD,OAPD,MASA;AACC,WAAIF,MAAMX,OAAOU,OAAP,CAAeC,GAAzB;AACAJ,0BAAmBf,IAAnB,CAAwBmB,GAAxB;AACA;AACDnD,eAASqB,OAAT,CAAiB0B,kBAAjB;AACA,MAhBD,MAkBA;AACC/C,eAASqB,OAAT,CAAiB,EAAjB;AACA;AACD,KAxBF;AAyBCa,eAAW,UAASC,KAAT,EACX;AACCnC,cAASqB,OAAT,CAAiB,EAAjB;AACA7B,gBAAW4C,MAAX,CAAkBD,KAAlB,EAAyB,OAAzB,EAAkC,sCAAlC,EAA0E,KAA1E,EAAiF,KAAjF;AACA;AA7BF,IADA;AAgCA,UAAOnC,SAASqC,OAAhB;AACA,GAzCD;;AA2CA5C,OAAK6D,eAAL,GAAuB,UAASf,SAAT,EACvB;AACC,OAAIvC,WAAWX,GAAGY,KAAH,EAAf;AACA,OAAIsD,kBAAkB,EAAtB;AACA,OAAIrD,QAAQ,IAAIZ,aAAaa,UAAjB,EAAZ;AACAD,SAAMI,QAAN,CAAe,aAAf,EAA8Bb,KAAK+D,iBAAnC;AACA,OAAIR,WAAW,YAAUT,SAAzB;AACArC,SAAMI,QAAN,CAAe,YAAf,EAA6B0C,QAA7B;AACA9C,SAAMe,MAAN,CAAa,MAAb,EAAqB,mBAArB,EACA;AACCC,eAAW,UAASsB,MAAT,EACX;AACC,SAAGA,OAAOU,OAAV,EACA;AACC,UAAIO,kBAAkB,EAAtB;AACA,UAAIlC,OAAOC,SAAP,CAAiBC,QAAjB,CAA0BC,IAA1B,CAAgCc,OAAOU,OAAP,CAAeC,GAA/C,MAAyD,gBAA7D,EACA;AACC,WAAIC,WAAWZ,OAAOU,OAAP,CAAeC,GAA9B;AACAnE,eAAQ0E,OAAR,CAAgBN,QAAhB,EAA0B,UAASD,GAAT,EAAcQ,GAAd,EAC1B;AACC,YAAIF,oBAAoB,EAAxB,EACA;AACCA,4BAAmB,IAAnB;AACA;AACDA,2BAAmBN,IAAIS,YAAvB;AACA,QAPD;AAQA,OAXD,MAaA;AACC,WAAIT,MAAMX,OAAOU,OAAP,CAAeC,GAAzB;AACAM,yBAAkBN,IAAIS,YAAtB;AACA;AACD5D,eAASqB,OAAT,CAAiBoC,eAAjB;AACA,MArBD,MAuBA;AACCzD,eAASqB,OAAT,CAAiB,EAAjB;AACA;AACD,KA7BF;AA8BCa,eAAW,UAASC,KAAT,EACX;AACCnC,cAASqB,OAAT,CAAiB,EAAjB;AACA7B,gBAAW4C,MAAX,CAAkBD,KAAlB,EAAyB,OAAzB,EAAkC,mCAAlC,EAAuE,KAAvE,EAA8E,KAA9E;AACA;AAlCF,IADA;AAqCA,UAAOnC,SAASqC,OAAhB;AACA,GA9CD;;AAiDA5C,OAAKoE,wBAAL,GAAgC,YAChC;AACC,OAAI7D,WAAWX,GAAGY,KAAH,EAAf;AACA,OAAI6D,cAAc,EAAlB;AACA,OAAI5D,QAAQ,IAAIZ,aAAaa,UAAjB,EAAZ;AACAD,SAAMI,QAAN,CAAe,aAAf,EAA8Bb,KAAKsE,kBAAnC;AACA7D,SAAMe,MAAN,CAAa,MAAb,EAAqB,mBAArB,EAA0C;AACzCC,eAAW,UAASsB,MAAT,EACX;AACC,SAAIA,OAAOU,OAAP,CAAeC,GAAf,CAAmBrB,MAAnB,IAA6B,CAAjC,EACA;AACCtC,iBAAW4B,SAAX,CAAqB,OAArB,EAA8B,+EAA9B;AACA5B,iBAAW4C,MAAX,CAAkB,kCAAlB,EAAsD,OAAtD,EAA+D,4CAA/D,EAA6G,KAA7G,EAAoH,KAApH;AACApC,eAASqB,OAAT,CAAiB,EAAjB;AACA,MALD,MAOA;AACC;AACA,UAAI2C,cAAcxB,OAAOU,OAAP,CAAeC,GAAjC;;AAEA;AACA,UAAIc,aAAJ;AACA,UAAID,YAAY,CAAZ,EAAeE,aAAf,IAAgC,MAApC,EAA4C;AAAED,uBAAgB,IAAhB;AAAuB,OAArE,MAA2E;AAAEA,uBAAgB,KAAhB;AAAwB;;AAErG,UAAIE,cAAJ;AACA,UAAIH,YAAY,CAAZ,EAAeE,aAAf,IAAgC,MAApC,EAA4C;AAAEC,wBAAiB,IAAjB;AAAwB,OAAtE,MAA4E;AAAEA,wBAAiB,KAAjB;AAAyB;;AAEvGL,oBAAc,EAAEG,eAAiBA,aAAnB;AACVE,uBAAkBA,cADR;AAEVC,oBAAgBJ,YAAY,CAAZ,EAAeE,aAFrB;AAGV7D,mBAAe2D,YAAY,CAAZ,EAAeE,aAHpB,EAAd;;AAKAlE,eAASqB,OAAT,CAAiByC,WAAjB;AACA;AACD,KA5BwC;AA6BzC5B,eAAW,UAASC,KAAT,EACX;AACCnC,cAASqB,OAAT,CAAiB,EAAjB;AACA7B,gBAAW4C,MAAX,CAAkBD,KAAlB,EAAyB,OAAzB,EAAkC,4CAAlC,EAAgF,KAAhF,EAAuF,KAAvF;AACA;AAjCwC,IAA1C;;AAoCA,UAAOnC,SAASqC,OAAhB;AACA,GA3CD;;AA6CA5C,OAAK4E,sBAAL,GAA8B,UAAS9B,SAAT,EAC9B;AACC,OAAIrC,QAAQ,IAAIZ,aAAaa,UAAjB,EAAZ;AACAD,SAAMI,QAAN,CAAe,QAAf,EAAyBiC,SAAzB;AACArC,SAAMe,MAAN,CAAa,eAAb,EAA8B,+BAA9B,EACA;AACCC,eAAW,YACX;AACC;AACA,KAJF;AAKCgB,eAAW,UAASC,KAAT,EACX;AACC3C,gBAAW4C,MAAX,CAAkBD,KAAlB,EAAyB,OAAzB,EAAkC,0CAAlC,EAA8E,KAA9E,EAAqF,KAArF;AACA;AARF,IADA;AAWA,GAfD;;AAkBA1C,OAAK6E,cAAL,GAAsB,UAASC,OAAT,EACtB;AACC,OAAIvE,WAAWX,GAAGY,KAAH,EAAf;AACA,OAAIuE,OAAJ;AACA,OAAItE,QAAQ,IAAIZ,aAAaa,UAAjB,EAAZ;AACAD,SAAMI,QAAN,CAAe,aAAf,EAA8Bb,KAAKgF,gBAAnC;AACA,OAAIzB,WAAW,WAASuB,OAAxB;AACArE,SAAMI,QAAN,CAAe,YAAf,EAA6B0C,QAA7B;AACA9C,SAAMe,MAAN,CAAa,MAAb,EAAqB,mBAArB,EAA0C;AACzCC,eAAW,UAASsB,MAAT,EACX;AACC,SAAGA,OAAOU,OAAV,EACA;AACCsB,gBAAUhC,OAAOU,OAAP,CAAeC,GAAf,CAAmBuB,IAA7B;AACA1E,eAASqB,OAAT,CAAiBmD,OAAjB;AACA,MAJD,MAMA;AACCxE,eAASqB,OAAT,CAAiB,EAAjB;AACA7B,iBAAW4C,MAAX,CAAkB,wBAAlB,EAA4C,OAA5C,EAAqD,kCAArD,EAAyF,KAAzF,EAAgG,KAAhG;AACA;AACD,KAbwC;AAczCF,eAAW,UAASC,KAAT,EACX;AACCnC,cAASqB,OAAT,CAAiB,EAAjB;AACA7B,gBAAW4C,MAAX,CAAkBD,KAAlB,EAAyB,OAAzB,EAAkC,kCAAlC,EAAsE,KAAtE,EAA6E,KAA7E;AACA;AAlBwC,IAA1C;;AAqBA,UAAOnC,SAASqC,OAAhB;AACA,GA9BD;;AAgCA,SAAO5C,IAAP;AACA;AACD,CA1XD","file":"knowledge.service.js","sourcesContent":["(function (){\r\n    'use strict';\r\n    angular\r\n      .module('swSelfService')\r\n      .factory('KnowledgeService', KnowledgeService);\r\n\r\n      KnowledgeService.$inject=['$q', 'XMLMCService','store','wssLogging'];\r\n\r\n    function KnowledgeService($q, XMLMCService, store, wssLogging)\r\n\t{\r\n\t\tvar self = {\r\n\t\t\t'getDefSrchSettings': 'query/wss/knowledge/def.search.settings.select',\r\n\t\t\t'getRelatedTypesSQ': 'query/wss/knowledge/related.types.select',\r\n\t\t\t'getRelatedArticlesSQ': 'query/wss/knowledge/related.kbarticles.select',\r\n\t\t\t'getProfileInfoSQ': 'query/wss/knowledge/profile.info.select'\r\n\r\n\t\t};\r\n\r\n\t\tself.custDetails=store.get(\"custDetails\");\r\n\t\tself.instanceConfig=store.get(\"instanceConfig\");\r\n\r\n\t\tself.searchKB = function(searchCriteriaObj, boolSendToast)\r\n\t\t{\r\n\t\t\tvar deferred = $q.defer();\r\n\t\t\tvar xmlmc = new XMLMCService.MethodCall();\r\n\t\t\tvar searchOperation;\r\n\r\n\t\t\tif (searchCriteriaObj.searchType==1)\r\n\t\t\t{\r\n\t\t\t\t//-- Natural language query (ask a question)...\r\n\t\t\t\tsearchOperation = \"queryNatural\";\r\n\t\t\t\txmlmc.addParam(\"queryString\", searchCriteriaObj.searchString);\r\n\r\n\t\t\t\t//-- Check if a catalog has been selected\r\n\t\t\t\tif (angular.isDefined(searchCriteriaObj.catalog) && searchCriteriaObj.catalog !== \"\" && searchCriteriaObj.catalog !== null)\r\n\t\t\t\t{\r\n\t\t\t\t\txmlmc.addParam(\"catalogId\", searchCriteriaObj.catalog.catalogId);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tsearchOperation = \"queryKeyword\";\r\n\t\t\t\txmlmc.addParam(\"queryString\", searchCriteriaObj.searchString);\r\n\r\n\t\t\t\t//-- Check if a catalog has been selected\r\n\t\t\t\tif (angular.isDefined(searchCriteriaObj.catalog) && searchCriteriaObj.catalog !== \"\" && searchCriteriaObj.catalog !== null)\r\n\t\t\t\t{\r\n\t\t\t\t\txmlmc.addParam(\"catalogId\", searchCriteriaObj.catalog.catalogId);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (searchCriteriaObj.searchType==2)\r\n\t\t\t\t{\r\n\t\t\t\t\t//-- Word Search (any words can match)\r\n\t\t\t\t\txmlmc.addParam(\"queryType\", \"any\");\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\t//-- Word Search (all words must match)\r\n\t\t\t\t\txmlmc.addParam(\"queryType\", \"all\");\r\n\t\t\t\t}\r\n\t\t\t\txmlmc.addParam(\"searchTitle\", searchCriteriaObj.searchOptions.title);\r\n\t\t\t\txmlmc.addParam(\"searchKeywords\", searchCriteriaObj.searchOptions.keywords);\r\n\t\t\t\txmlmc.addParam(\"searchProblem\", searchCriteriaObj.searchOptions.problem);\r\n\t\t\t\txmlmc.addParam(\"searchSolution\", searchCriteriaObj.searchOptions.solution);\r\n\t\t\t}\r\n\r\n\t\t\txmlmc.addParam(\"maxResults\", searchCriteriaObj.maxResults);\r\n\r\n\t\t\txmlmc.invoke(\"knowledgebase\", searchOperation,\r\n\t\t\t{\r\n\t\t\t\tonSuccess: function(results)\r\n\t\t\t\t{\n          if (!angular.isDefined(results))\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif (boolSendToast)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\twssLogging.sendToast('warning', 'No knowledgebase documents match your criteria!');\r\n\t\t\t\t\t\t}\r\n            deferred.resolve('');\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tvar kbArticleArray = [];\r\n\t\t\t\t\t\tif( Object.prototype.toString.call( results.document ) === '[object Array]' )\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t//-- Multiple articles found\r\n\t\t\t\t\t\t\tvar resultsArray = results.document;\r\n\t\t\t\t\t\t\tfor (var resultCnt = 0; resultCnt < resultsArray.length; resultCnt++)\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t//-- Check article is visible to the public\r\n\t\t\t\t\t\t\t\tif (resultsArray[resultCnt].docflags == \"1\")\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tkbArticleArray.push(resultsArray[resultCnt]);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t//-- 1 article found\r\n\t\t\t\t\t\t\tvar result = results.document;\r\n\r\n\t\t\t\t\t\t\t//-- Check article is visible to the public\r\n\t\t\t\t\t\t\tif (result.docflags == \"1\")\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tkbArticleArray.push(result);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (kbArticleArray.length === 0)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tif (boolSendToast)\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\twssLogging.sendToast('warning', 'No knowledgebase documents match your criteria!');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tdeferred.resolve('');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tdeferred.resolve(kbArticleArray);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tonFailure: function(error)\r\n\t\t\t\t{\r\n\t\t\t\t\tdeferred.resolve('');\r\n\t\t\t\t\twssLogging.logger(error, \"ERROR\", \"KnowledgeService::searchKB\", false, false);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn deferred.promise;\r\n\t\t};\r\n\r\n\t\tself.getArticleDetails = function(strDocRef)\r\n\t\t{\r\n\t\t\tvar deferred = $q.defer();\r\n\t\t\tvar xmlmc = new XMLMCService.MethodCall();\r\n\t\t\txmlmc.addParam(\"docRef\", strDocRef);\r\n\t\t\txmlmc.invoke(\"knowledgebase\", \"documentGetInfo\",\r\n\t\t\t{\r\n\t\t\t\tonSuccess: function(params)\r\n\t\t\t\t{\r\n\t\t\t\t\tdeferred.resolve(params);\r\n\t\t\t\t},\r\n\t\t\t\tonFailure: function(error)\r\n\t\t\t\t{\r\n\t\t\t\t\tdeferred.resolve('');\r\n\t\t\t\t\twssLogging.logger(error, \"ERROR\", \"KnowledgeService::getArticleDetails\", false, false);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn deferred.promise;\r\n\t\t};\r\n\r\n\t\tself.getDocumentURL = function(strDocRef)\r\n\t\t{\r\n\t\t\tvar deferred = $q.defer();\r\n\t\t\tvar xmlmc = new XMLMCService.MethodCall();\r\n\t\t\txmlmc.addParam(\"docRef\", strDocRef);\r\n\t\t\txmlmc.invoke(\"knowledgebase\", \"documentGetUrl\",\r\n\t\t\t{\r\n\t\t\t\tonSuccess: function(res)\r\n\t\t\t\t{\r\n\t\t\t\t\tdeferred.resolve(res.url);\r\n\t\t\t\t},\r\n\t\t\t\tonFailure: function(error)\r\n\t\t\t\t{\r\n\t\t\t\t\tdeferred.resolve('');\r\n\t\t\t\t\twssLogging.logger(error, \"ERROR\", \"KnowledgeService::getDocumentURL\", false, false);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn deferred.promise;\r\n\t\t};\r\n\r\n\t\tself.getKBCatList = function()\r\n\t\t{\r\n\t\t\tvar deferred = $q.defer();\r\n\t\t\tvar xmlmc = new XMLMCService.MethodCall();\r\n\t\t\txmlmc.invoke(\"knowledgebase\", \"catalogList\",\r\n\t\t\t{\r\n\t\t\t\tonSuccess: function(params)\r\n\t\t\t\t{\r\n\t\t\t\t\tdeferred.resolve(params.folder);\r\n\t\t\t\t},\r\n\t\t\t\tonFailure: function(error)\r\n\t\t\t\t{\r\n\t\t\t\t\tdeferred.resolve('');\r\n\t\t\t\t\twssLogging.logger(error, \"ERROR\", \"KnowledgeService::getKBCatList\", false, false);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn deferred.promise;\r\n\t\t};\r\n\r\n\t\tself.getRelatedArticles = function(strDocRef)\r\n\t\t{\r\n\t\t\tvar deferred = $q.defer();\r\n\t\t\tvar arrRelatedArticles = [];\r\n\t\t\tvar xmlmc = new XMLMCService.MethodCall();\r\n\t\t\tvar sqparams = \"docRef=\"+strDocRef;\r\n\t\t\txmlmc.addParam(\"storedQuery\", self.getRelatedArticlesSQ);\r\n\t\t\txmlmc.addParam(\"parameters\", sqparams);\r\n\t\t\txmlmc.invoke(\"data\", \"invokeStoredQuery\",\r\n\t\t\t{\r\n\t\t\t\tonSuccess: function(params)\r\n\t\t\t\t{\r\n\t\t\t\t\tif(params.rowData)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif( Object.prototype.toString.call( params.rowData.row ) === '[object Array]' )\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tvar rowArray = params.rowData.row;\r\n\t\t\t\t\t\t\tfor (var rowKey = 0; rowKey < rowArray.length; rowKey++)\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tarrRelatedArticles.push(rowArray[rowKey]);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tvar row = params.rowData.row;\r\n\t\t\t\t\t\t\tarrRelatedArticles.push(row);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tdeferred.resolve(arrRelatedArticles);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tdeferred.resolve('');\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tonFailure: function(error)\r\n\t\t\t\t{\r\n\t\t\t\t\tdeferred.resolve('');\r\n\t\t\t\t\twssLogging.logger(error, \"ERROR\", \"KnowledgeService::getRelatedArticles\", false, false);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn deferred.promise;\r\n\t\t};\r\n\r\n\t\tself.getRelatedTypes = function(strDocRef)\r\n\t\t{\r\n\t\t\tvar deferred = $q.defer();\r\n\t\t\tvar arrRelatedTypes = [];\r\n\t\t\tvar xmlmc = new XMLMCService.MethodCall();\r\n\t\t\txmlmc.addParam(\"storedQuery\", self.getRelatedTypesSQ);\r\n\t\t\tvar sqparams = \"docRef=\"+strDocRef;\r\n\t\t\txmlmc.addParam(\"parameters\", sqparams);\r\n\t\t\txmlmc.invoke(\"data\", \"invokeStoredQuery\",\r\n\t\t\t{\r\n\t\t\t\tonSuccess: function(params)\r\n\t\t\t\t{\r\n\t\t\t\t\tif(params.rowData)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tvar strRelatedTypes = \"\";\r\n\t\t\t\t\t\tif (Object.prototype.toString.call( params.rowData.row ) === '[object Array]')\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tvar rowArray = params.rowData.row;\r\n\t\t\t\t\t\t\tangular.forEach(rowArray, function(row, key)\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tif (strRelatedTypes !== \"\")\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tstrRelatedTypes += \", \";\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tstrRelatedTypes += row.type_display;\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tvar row = params.rowData.row;\r\n\t\t\t\t\t\t\tstrRelatedTypes = row.type_display;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tdeferred.resolve(strRelatedTypes);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tdeferred.resolve('');\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tonFailure: function(error)\r\n\t\t\t\t{\r\n\t\t\t\t\tdeferred.resolve('');\r\n\t\t\t\t\twssLogging.logger(error, \"ERROR\", \"KnowledgeService::getRelatedTypes\", false, false);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn deferred.promise;\r\n\t\t};\r\n\r\n\r\n\t\tself.getDefaultSearchSettings = function()\r\n\t\t{\r\n\t\t\tvar deferred = $q.defer();\r\n\t\t\tvar objSettings = [];\r\n\t\t\tvar xmlmc = new XMLMCService.MethodCall();\r\n\t\t\txmlmc.addParam(\"storedQuery\", self.getDefSrchSettings);\r\n\t\t\txmlmc.invoke(\"data\", \"invokeStoredQuery\", {\r\n\t\t\t\tonSuccess: function(params)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (params.rowData.row.length != 4)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\twssLogging.sendToast('error', 'Error loading system settings. Please contact your Supportworks Administrator');\r\n\t\t\t\t\t\twssLogging.logger(\"Wrong number of system settings.\", \"ERROR\", \"KnowledgeService::getDefaultSearchSettings\", false, false);\r\n\t\t\t\t\t\tdeferred.resolve('');\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t//-- Stored query returns ordered list of the 4 \"KNOWLEDGEBASE.SELFSERVICE\" system settings\r\n\t\t\t\t\t\tvar arrSettings = params.rowData.row;\r\n\r\n\t\t\t\t\t\t//-- Sort out \"string booleans\"\r\n\t\t\t\t\t\tvar boolChangeCat;\r\n\t\t\t\t\t\tif (arrSettings[0].setting_value == \"True\") { boolChangeCat = true; } else { boolChangeCat = false; }\r\n\r\n\t\t\t\t\t\tvar boolChangeType;\r\n\t\t\t\t\t\tif (arrSettings[1].setting_value == \"True\") { boolChangeType = true; } else { boolChangeType = false; }\r\n\r\n\t\t\t\t\t\tobjSettings = { boolChangeCat\t\t: boolChangeCat,\r\n\t\t\t\t\t\t\t\t\t\tboolChangeType\t\t: boolChangeType,\r\n\t\t\t\t\t\t\t\t\t\tcatalogName\t\t\t: arrSettings[2].setting_value,\r\n\t\t\t\t\t\t\t\t\t\tsearchType\t\t\t: arrSettings[3].setting_value };\r\n\r\n\t\t\t\t\t\tdeferred.resolve(objSettings);\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tonFailure: function(error)\r\n\t\t\t\t{\r\n\t\t\t\t\tdeferred.resolve('');\r\n\t\t\t\t\twssLogging.logger(error, \"ERROR\", \"KnowledgeService::getDefaultSearchSettings\", false, false);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\treturn deferred.promise;\r\n\t\t};\r\n\r\n\t\tself.incrementAccessCounter = function(strDocRef)\r\n\t\t{\r\n\t\t\tvar xmlmc = new XMLMCService.MethodCall();\r\n\t\t\txmlmc.addParam(\"docRef\", strDocRef);\r\n\t\t\txmlmc.invoke(\"knowledgebase\", \"documentIncreaseAccessCounter\",\r\n\t\t\t{\r\n\t\t\t\tonSuccess: function()\r\n\t\t\t\t{\r\n\t\t\t\t\t//-- successfully incremneted access counter\r\n\t\t\t\t},\r\n\t\t\t\tonFailure: function(error)\r\n\t\t\t\t{\r\n\t\t\t\t\twssLogging.logger(error, \"ERROR\", \"KnowledgeService::incrementAccessCounter\", false, false);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t};\r\n\r\n\r\n\t\tself.getProfileInfo = function(strCode)\r\n\t\t{\r\n\t\t\tvar deferred = $q.defer();\r\n\t\t\tvar strInfo;\r\n\t\t\tvar xmlmc = new XMLMCService.MethodCall();\r\n\t\t\txmlmc.addParam(\"storedQuery\", self.getProfileInfoSQ);\r\n\t\t\tvar sqparams = \"pCode=\"+strCode;\r\n\t\t\txmlmc.addParam(\"parameters\", sqparams);\r\n\t\t\txmlmc.invoke(\"data\", \"invokeStoredQuery\", {\r\n\t\t\t\tonSuccess: function(params)\r\n\t\t\t\t{\r\n\t\t\t\t\tif(params.rowData)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tstrInfo = params.rowData.row.info;\r\n\t\t\t\t\t\tdeferred.resolve(strInfo);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tdeferred.resolve('');\r\n\t\t\t\t\t\twssLogging.logger(\"Profile Info Not Found\", \"ERROR\", \"KnowledgeService::getProfileInfo\", false, false);\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tonFailure: function(error)\r\n\t\t\t\t{\r\n\t\t\t\t\tdeferred.resolve('');\r\n\t\t\t\t\twssLogging.logger(error, \"ERROR\", \"KnowledgeService::getProfileInfo\", false, false);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\treturn deferred.promise;\r\n\t\t};\r\n\r\n\t\treturn self;\r\n\t}\r\n})();\r\n"]}