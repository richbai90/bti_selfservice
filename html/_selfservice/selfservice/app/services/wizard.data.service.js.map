{"version":3,"sources":["../../../_itsm_default_v2_template/app/services/wizard.data.service.js"],"names":["angular","module","service","WizardDataService","$inject","$rootScope","$q","XMLMCService","WizardFilterService","store","wssHelpers","$uibModal","wssLogging","self","addingFiles","isWssAdmin","hasWebflag","defSLA","ciPicker","tabSet","loadingItems","ciArray","outputConfigObject","wizardStages","openTableAdminModal","adminModalSchema","adminModalContent","currListType","modalInstance","open","animation","templateUrl","controller","size","resolve","items","result","then","setCIListSelect","openCIModal","question","custDetails","get","selectedItems","answer","setOrder","oColumn","oIndex","sortColumn","sortOrder","strSortOrder","outputOrderBy","dbtable","column","getCIs","response","error","connErrorType","connErrorBody","connErrorTitle","sendToast","servList","boolSkipConfig","isDefined","isObject","ciConfSetting","getTableConfig","deferred","defer","strAddTables","processAdditionalTables","itemArray","strDynFilter","sqparams","keysearch","table","outputSQLColumns","enableAppcodeFilter","filterSQLColumns","xmlmc","MethodCall","addParam","recordsStoredQuery","invoke","onSuccess","params","rowData","Object","prototype","toString","call","row","intArrayLength","length","i","push","onFailure","reject","promise","getDataform","intDataform","logger","getWizard","strWizardName","getStageDetails","intStage","getStageQuestions","questionArray","forEach","qVal","qKey","defaultvalue","processFilter","qfilter","type","pickername","checked","inputtype","validation_type","options","getQuestionOptions","respOptions","qOptVal","keycol","discol","getOrgs","oOrgs","getProfileTree","oCodes","strRel","qObj","qOptions","pk_qid","txtcol","getDynamicInputData","dynData","dynVal","dynKey","strSelector","filter","strQFilter","encodeBase64","wssConfig","treeData","catList","inCatList","ProfileChildNode","prVal","prKey","name","value","currTreeKey","arrCatType","split","strCurrentCat","parentId","catType","catKey","currCat","id","parentlabel","swValue","code","unflattenTreeview","probcodeSelected","objItems","objAnswer","optionSelected","multiOptionSelected","strAnswer","itemVal","swname","checkboxChanged","oVal","oKey","loadOptionData","parent","prim_extdet","qOption","detcol","hasChildren","singOption","sec_table","sec_keycol","sec_txtcol","sec_extdet","sec_filter","sec_filtercolumn","_hsmeta","isActive","isExpanded","getSLAQuestion","objDataform","objService","objSLAQuestion","strRelType","cp_sla_first","getServSubSLA","fk_cmdb_id","objSLAs","getClassDefaultSLA","callclass","respClassDefSLA","buildSLAQuestion","subs_id","getDefaultSLAOptions","returnPrice","slaQuestionResp","slaQVal","slaoptions","price","idServSub","slaType","slaArray","relId","relType","callClass","slaId","fk_slad","getStandardComponents","intServId","strCallClass","objStandardComponents","objStandardComponentQuestion","compVal","compKey","customComponents","flg_cancustomise","objCustomisedComponents","pk_auto_id","buildStandardCompQuestion","getOptionalComponents","buildOptionalCompQuestion","oComponents","objQuestion","flg_hidden","flg_prefixq","objCompVal","objCompKey","option","description","componentoptions","oSLAs","targetcolumn","flg_mandatory","objSLAVal","objSLAKey","fk_sla","fk_sla_name","getJumpRecords","qid","jumpArray","slaChange","oOption","parseFloat","toFixed","dataForm","prices","servicelevel","total_cost","serviceLevelCost","total","basic","customisation","optional","componentChange","customisationCompCost","customisationCompPrice","optionalCompCost","optionalCompPrice","keys","intEndStage","questions","objAnswerVal","intAnswerKey","cusPriceDiff","cusCost","price_diff","total_cost_for_item","customisationCost","opPrice","opCost","optionalCost","totalComponentPrice","totalComponentCost","totalCost","checkFiles","event","reader","fileList","fileError","abort","filesAdded","fileObjs","file"],"mappings":"AAAC,aAAW;AACV;;AACAA,UACGC,MADH,CACU,eADV,EAEGC,OAFH,CAEW,mBAFX,EAEgCC,iBAFhC;;AAIAA,oBAAkBC,OAAlB,GAA0B,CAAC,YAAD,EAAc,IAAd,EAAoB,cAApB,EAAmC,qBAAnC,EAAyD,OAAzD,EAAiE,YAAjE,EAA8E,WAA9E,EAA0F,YAA1F,CAA1B;AACA,WAASD,iBAAT,CAA2BE,UAA3B,EAAuCC,EAAvC,EAA2CC,YAA3C,EAAyDC,mBAAzD,EAA8EC,KAA9E,EAAqFC,UAArF,EAAiGC,SAAjG,EAA4GC,UAA5G,EAAwH;;AAEtH,QAAIC,OAAO;AACTC,mBAAa,KADJ;AAETC,kBAAYL,WAAWM,UAAX,CAAsB,cAAtB,CAFH;AAGTC,cAAQ,CAHC,EAGE;AACXC,gBAAU;AACRC,gBAAQ;AACN,2BAAgB,UADV;AAEN,0BAAgB,SAFV;AAGN,4BAAkB,OAHZ;AAIN,4BAAkB;AAJZ,SADA;AAORC,sBAAc,KAPN;AAQRC,iBAAS,EARD;AASRC,4BAAoB;AATZ,OAJD;AAeTC,oBAAc;AAfL,KAAX;;AAkBAV,SAAKW,mBAAL,GAA2B,YAAU;AACnCnB,iBAAWoB,gBAAX,GAA8B,cAA9B;AACApB,iBAAWqB,iBAAX,GAA+B,qBAAmBb,KAAKK,QAAL,CAAcS,YAAhE;AACA,UAAIC,gBAAgBjB,UAAUkB,IAAV,CAAe;AACjCC,mBAAW,IADsB;AAEjCC,qBAAa,4CAFoB;AAGjCC,oBAAY,sBAHqB;AAIjCC,cAAM,IAJ2B;AAKjCC,iBAAS;AACPC,iBAAO,YAAY;AACjB,mBAAO,EAAP;AACD;AAHM;AALwB,OAAf,CAApB;AAWAP,oBAAcQ,MAAd,CAAqBC,IAArB,CAA0B,YAAY;AACpC;AACAhC,mBAAWoB,gBAAX,GAA8B,EAA9B;AACApB,mBAAWqB,iBAAX,GAA+B,EAA/B;AACAb,aAAKK,QAAL,CAAcoB,eAAd,CAA8BzB,KAAKK,QAAL,CAAcS,YAA5C,EAA0D,KAA1D;AACD,OALD,EAKG,YAAW;AACZ;AACD,OAPD;AAQD,KAtBD;;AAwBA;AACAd,SAAKK,QAAL,CAAcqB,WAAd,GAA4B,UAASC,QAAT,EAAmBP,IAAnB,EAAyB;AACnDpB,WAAK4B,WAAL,GAAmBhC,MAAMiC,GAAN,CAAU,aAAV,CAAnB;AACA;AACA,UAAId,gBAAgBjB,UAAUkB,IAAV,CAAe;AACjCC,mBAAW,IADsB;AAEjCC,qBAAa,wDAFoB;AAGjCC,oBAAY,mBAHqB;AAIjCC,cAAMA,IAJ2B;AAKjCC,iBAAS;AACPC,iBAAO,YAAY;AACjB,mBAAOK,QAAP;AACD;AAHM;AALwB,OAAf,CAApB;;AAYAZ,oBAAcQ,MAAd,CAAqBC,IAArB,CAA0B,UAAUM,aAAV,EAAyB;AACjDH,iBAASI,MAAT,GAAkBD,aAAlB;AACD,OAFD,EAEG,YAAY;AACb;AACD,OAJD;AAKD,KApBD;;AAsBA9B,SAAKK,QAAL,CAAc2B,QAAd,GAAyB,UAASC,OAAT,EAAkBC,MAAlB,EAAyB;AAChDlC,WAAKK,QAAL,CAAcL,KAAKK,QAAL,CAAcS,YAA5B,EAA0CqB,UAA1C,GAAuDD,MAAvD;AACAlC,WAAKK,QAAL,CAAcL,KAAKK,QAAL,CAAcS,YAA5B,EAA0CsB,SAA1C,GAAsD,CAACpC,KAAKK,QAAL,CAAcL,KAAKK,QAAL,CAAcS,YAA5B,EAA0CsB,SAAjG;AACA,UAAIC,eAAgBrC,KAAKK,QAAL,CAAcL,KAAKK,QAAL,CAAcS,YAA5B,EAA0CsB,SAA1C,GAAsD,KAAtD,GAA8D,MAAlF;AACApC,WAAKK,QAAL,CAAcL,KAAKK,QAAL,CAAcS,YAA5B,EAA0CL,kBAA1C,CAA6D6B,aAA7D,GAA6EL,QAAQM,OAAR,GAAiB,GAAjB,GAAqBN,QAAQO,MAA7B,GAAoC,GAApC,GAAwCH,YAArH;AACArC,WAAKK,QAAL,CAAcoC,MAAd,GAAuBjB,IAAvB,CAA4B,UAASkB,QAAT,EAAkB;AAC5C1C,aAAKK,QAAL,CAAcL,KAAKK,QAAL,CAAcS,YAA5B,EAA0CN,OAA1C,GAAoDkC,QAApD;AACA1C,aAAKK,QAAL,CAAcE,YAAd,GAA6B,KAA7B;AACD,OAHD,EAGG,UAASoC,KAAT,EAAe;AAChB3C,aAAKK,QAAL,CAAcE,YAAd,GAA6B,KAA7B;AACA,YAAIqC,gBAAgB,OAApB;AACA,YAAIC,gBAAgB,iGAA+FF,KAAnH;AACA,YAAIG,iBAAiB,kBAArB;AACA/C,mBAAWgD,SAAX,CAAqBH,aAArB,EAAoCC,aAApC,EAAmDC,cAAnD;AACD,OATD;AAUD,KAfD;;AAiBA9C,SAAKK,QAAL,CAAcoB,eAAd,GAAgC,UAASuB,QAAT,EAAmBC,cAAnB,EAAkC;AAChE,UAAG,CAAC9D,QAAQ+D,SAAR,CAAkBD,cAAlB,CAAJ,EAAsC;AACpCA,yBAAiB,IAAjB;AACD;AACDjD,WAAKK,QAAL,CAAcE,YAAd,GAA6B,IAA7B;AACAP,WAAKK,QAAL,CAAcS,YAAd,GAA6BkC,QAA7B;AACA,UAAG7D,QAAQ+D,SAAR,CAAkBlD,KAAKK,QAAL,CAAc2C,QAAd,CAAlB,KAA8C7D,QAAQgE,QAAR,CAAiBnD,KAAKK,QAAL,CAAc2C,QAAd,EAAwBvC,kBAAzC,CAA9C,IAA8GwC,mBAAmB,IAApI,EAA0I;AACxI;AACAjD,aAAKK,QAAL,CAAcoC,MAAd,GAAuBjB,IAAvB,CAA4B,UAASkB,QAAT,EAAkB;AAC5C1C,eAAKK,QAAL,CAAcL,KAAKK,QAAL,CAAcS,YAA5B,EAA0CN,OAA1C,GAAoDkC,QAApD;AACA1C,eAAKK,QAAL,CAAcE,YAAd,GAA6B,KAA7B;AACD,SAHD,EAGG,UAASoC,KAAT,EAAe;AAChB3C,eAAKK,QAAL,CAAcE,YAAd,GAA6B,KAA7B;AACA,cAAIqC,gBAAgB,OAApB;AACA,cAAIC,gBAAgB,iGAA+FF,KAAnH;AACA,cAAIG,iBAAiB,kBAArB;AACA/C,qBAAWgD,SAAX,CAAqBH,aAArB,EAAoCC,aAApC,EAAmDC,cAAnD;AACD,SATD;AAUD,OAZD,MAYO;AACL9C,aAAKK,QAAL,CAAc2C,QAAd,IAA0B,EAA1B;AACA;AACA,YAAII,gBAAgB,qBAAmBJ,QAAvC;AACAnD,mBAAWwD,cAAX,CAA0BD,aAA1B,EAAyC5B,IAAzC,CAA8C,UAASkB,QAAT,EAAkB;AAC9D1C,eAAKK,QAAL,CAAcL,KAAKK,QAAL,CAAcS,YAA5B,EAA0CL,kBAA1C,GAA+DiC,QAA/D;AACA1C,eAAKK,QAAL,CAAcoC,MAAd,GAAuBjB,IAAvB,CAA4B,UAASkB,QAAT,EAAkB;AAC5C1C,iBAAKK,QAAL,CAAcL,KAAKK,QAAL,CAAcS,YAA5B,EAA0CN,OAA1C,GAAoDkC,QAApD;AACA1C,iBAAKK,QAAL,CAAcE,YAAd,GAA6B,KAA7B;AACD,WAHD,EAGG,UAASoC,KAAT,EAAe;AAChB3C,iBAAKK,QAAL,CAAcE,YAAd,GAA6B,KAA7B;AACA,gBAAIqC,gBAAgB,OAApB;AACA,gBAAIC,gBAAgB,iGAA+FF,KAAnH;AACA,gBAAIG,iBAAiB,kBAArB;AACA/C,uBAAWgD,SAAX,CAAqBH,aAArB,EAAoCC,aAApC,EAAmDC,cAAnD;AACD,WATD;AAUA;AACD,SAbD,EAaG,UAASH,KAAT,EAAe;AAChB3C,eAAKK,QAAL,CAAcE,YAAd,GAA6B,KAA7B;AACA,cAAIqC,gBAAgB,OAApB;AACA,cAAIC,gBAAgB,iGAA+FF,KAAnH;AACA,cAAIG,iBAAiB,4BAArB;AACA/C,qBAAWgD,SAAX,CAAqBH,aAArB,EAAoCC,aAApC,EAAmDC,cAAnD;AACD,SAnBD;AAoBD;AACF,KA3CD;;AA6CA9C,SAAKK,QAAL,CAAcoC,MAAd,GAAuB,YAAW;AAChC,UAAIa,WAAW7D,GAAG8D,KAAH,EAAf;AACA;AACA,UAAG,CAACpE,QAAQ+D,SAAR,CAAkBlD,KAAKK,QAAL,CAAcL,KAAKK,QAAL,CAAcS,YAA5B,EAA0CL,kBAA1C,CAA6D+C,YAA/E,CAAJ,EAAiG;AAC/FxD,aAAKK,QAAL,CAAcL,KAAKK,QAAL,CAAcS,YAA5B,EAA0CL,kBAA1C,CAA6D+C,YAA7D,GAA4E3D,WAAW4D,uBAAX,CAAmCzD,KAAKK,QAAL,CAAcL,KAAKK,QAAL,CAAcS,YAA5B,EAA0CL,kBAA7E,CAA5E;AACD;AACD,UAAIiD,YAAY,EAAhB;AACA,UAAIC,eAAe,EAAnB;AACA,UAAIC,WAAW,YAAU5D,KAAK4B,WAAL,CAAiBiC,SAA1C;AACAD,kBAAY,YAAU5D,KAAKK,QAAL,CAAcL,KAAKK,QAAL,CAAcS,YAA5B,EAA0CL,kBAA1C,CAA6DqD,KAAnF;AACAF,kBAAY,cAAY5D,KAAKK,QAAL,CAAcL,KAAKK,QAAL,CAAcS,YAA5B,EAA0CL,kBAA1C,CAA6DsD,gBAArF;AACAH,kBAAY,cAAY5D,KAAKK,QAAL,CAAcL,KAAKK,QAAL,CAAcS,YAA5B,EAA0CL,kBAA1C,CAA6D6B,aAArF;AACAsB,kBAAY,oBAAkB5D,KAAKK,QAAL,CAAcL,KAAKK,QAAL,CAAcS,YAA5B,EAA0CL,kBAA1C,CAA6DuD,mBAA3F;AACAJ,kBAAY,gBAAcD,YAA1B;AACAC,kBAAY,oBAAkB5D,KAAKK,QAAL,CAAcL,KAAKK,QAAL,CAAcS,YAA5B,EAA0CL,kBAA1C,CAA6DwD,gBAA3F;AACAL,kBAAY,gBAAc5D,KAAKK,QAAL,CAAcL,KAAKK,QAAL,CAAcS,YAA5B,EAA0CL,kBAA1C,CAA6D+C,YAAvF;;AAEA;AACA,UAAIU,QAAQ,IAAIxE,aAAayE,UAAjB,EAAZ;AACAD,YAAME,QAAN,CAAe,aAAf,EAA8BpE,KAAKK,QAAL,CAAcL,KAAKK,QAAL,CAAcS,YAA5B,EAA0CL,kBAA1C,CAA6D4D,kBAA3F;AACAH,YAAME,QAAN,CAAe,YAAf,EAA6BR,QAA7B;AACAM,YAAMI,MAAN,CAAa,MAAb,EAAqB,mBAArB,EAA0C;AACxCC,mBAAW,UAASC,MAAT,EAAgB;AACzB,cAAGA,OAAOC,OAAV,EAAmB;AACjB,gBAAIC,OAAOC,SAAP,CAAiBC,QAAjB,CAA0BC,IAA1B,CAAgCL,OAAOC,OAAP,CAAeK,GAA/C,MAAyD,gBAA7D,EAAgF;AAC9E,kBAAIC,iBAAiBP,OAAOC,OAAP,CAAeK,GAAf,CAAmBE,MAAxC;AACA;AACA,mBAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAIF,cAApB,EAAoCE,GAApC,EAAyC;AACvCvB,0BAAUwB,IAAV,CAAeV,OAAOC,OAAP,CAAeK,GAAf,CAAmBG,CAAnB,CAAf;AACD;AACF,aAND,MAMO;AACLvB,wBAAUwB,IAAV,CAAeV,OAAOC,OAAP,CAAeK,GAA9B;AACD;AACF;AACDxB,mBAASjC,OAAT,CAAiBqC,SAAjB;AACD,SAduC;AAexCyB,mBAAW,UAASxC,KAAT,EAAe;AACxBW,mBAAS8B,MAAT,CAAgBzC,KAAhB;AACD;AAjBuC,OAA1C;;AAoBA,aAAOW,SAAS+B,OAAhB;AACD,KA1CD;;AA4CArF,SAAKsF,WAAL,GAAmB,UAASC,WAAT,EAAsB;AACvC,UAAIjC,WAAW7D,GAAG8D,KAAH,EAAf;AACA,UAAIK,WAAW,UAAQ2B,WAAvB;AACA,UAAIrB,QAAQ,IAAIxE,aAAayE,UAAjB,EAAZ;AACAD,YAAME,QAAN,CAAe,aAAf,EAA8B,0CAA9B;AACAF,YAAME,QAAN,CAAe,YAAf,EAA6BR,QAA7B;AACAM,YAAMI,MAAN,CAAa,MAAb,EAAqB,mBAArB,EAA0C;AACxCC,mBAAW,UAASC,MAAT,EAAgB;AACzB,cAAGrF,QAAQgE,QAAR,CAAiBqB,OAAOC,OAAP,CAAeK,GAAhC,CAAH,EAAwC;AACtCxB,qBAASjC,OAAT,CAAiBmD,OAAOC,OAAP,CAAeK,GAAhC;AACD,WAFD,MAEO;AACLxB,qBAAS8B,MAAT,CAAgBZ,MAAhB;AACD;AACF,SAPuC;AAQxCW,mBAAW,UAASxC,KAAT,EAAe;AACxB5C,qBAAWyF,MAAX,CAAkB7C,KAAlB,EAAyB,OAAzB,EAAkC,gCAAlC,EAAoE,KAApE,EAA2E,KAA3E;AACAW,mBAAS8B,MAAT,CAAgBzC,KAAhB;AACD;AAXuC,OAA1C;AAaA,aAAOW,SAAS+B,OAAhB;AACD,KApBD;;AAsBArF,SAAKyF,SAAL,GAAiB,UAASC,aAAT,EAAwB;AACvC,UAAIpC,WAAW7D,GAAG8D,KAAH,EAAf;AACA,UAAIK,WAAW,gBAAc8B,aAA7B;AACA,UAAIxB,QAAQ,IAAIxE,aAAayE,UAAjB,EAAZ;AACAD,YAAME,QAAN,CAAe,aAAf,EAA8B,mCAA9B;AACAF,YAAME,QAAN,CAAe,YAAf,EAA6BR,QAA7B;AACAM,YAAMI,MAAN,CAAa,MAAb,EAAqB,mBAArB,EAA0C;AACxCC,mBAAW,UAASC,MAAT,EAAgB;AACzB,cAAGrF,QAAQgE,QAAR,CAAiBqB,OAAOC,OAAP,CAAeK,GAAhC,CAAH,EAAwC;AACtCxB,qBAASjC,OAAT,CAAiBmD,OAAOC,OAAP,CAAeK,GAAhC;AACD,WAFD,MAEO;AACLxB,qBAAS8B,MAAT,CAAgBZ,MAAhB;AACD;AACF,SAPuC;AAQxCW,mBAAW,UAASxC,KAAT,EAAe;AACxB5C,qBAAWyF,MAAX,CAAkB7C,KAAlB,EAAyB,OAAzB,EAAkC,8BAAlC,EAAkE,KAAlE,EAAyE,KAAzE;AACAW,mBAAS8B,MAAT,CAAgBzC,KAAhB;AACD;AAXuC,OAA1C;AAaA,aAAOW,SAAS+B,OAAhB;AACD,KApBD;;AAsBArF,SAAK2F,eAAL,GAAuB,UAASD,aAAT,EAAwBE,QAAxB,EAAkC;AACvD,UAAItC,WAAW7D,GAAG8D,KAAH,EAAf;AACA,UAAIK,WAAW,gBAAc8B,aAA7B;AACA9B,kBAAY,YAAUgC,QAAtB;AACA,UAAI1B,QAAQ,IAAIxE,aAAayE,UAAjB,EAAZ;AACAD,YAAME,QAAN,CAAe,aAAf,EAA8B,oCAA9B;AACAF,YAAME,QAAN,CAAe,YAAf,EAA6BR,QAA7B;AACAM,YAAMI,MAAN,CAAa,MAAb,EAAqB,mBAArB,EAA0C;AACxCC,mBAAW,UAASC,MAAT,EAAgB;AAC/B,cAAIrF,QAAQgE,QAAR,CAAiBqB,OAAOC,OAAxB,CAAJ,EAAqC;AACpC,gBAAGtF,QAAQgE,QAAR,CAAiBqB,OAAOC,OAAP,CAAeK,GAAhC,CAAH,EAAwC;AACzCxB,uBAASjC,OAAT,CAAiBmD,OAAOC,OAAP,CAAeK,GAAhC;AACE,aAFD,MAEO;AACRxB,uBAAS8B,MAAT,CAAgBZ,MAAhB;AACE;AACD,WAND,MAOI;AACL,gBAAI5B,gBAAgB,OAApB;AACA,gBAAIC,gBAAgB,mIAApB;AACA,gBAAIC,iBAAiB,6BAArB;AACA/C,uBAAWgD,SAAX,CAAqBH,aAArB,EAAoCC,aAApC,EAAmDC,cAAnD,EAAmE,KAAnE,EAA0E,KAA1E;AACE;AACI,SAfuC;AAgBxCqC,mBAAW,UAASxC,KAAT,EAAe;AACxBW,mBAAS8B,MAAT,CAAgBzC,KAAhB;AACD;AAlBuC,OAA1C;AAoBA,aAAOW,SAAS+B,OAAhB;AACD,KA5BD;;AA8BArF,SAAK6F,iBAAL,GAAyB,UAASD,QAAT,EAAmB;AAC1C,UAAItC,WAAW7D,GAAG8D,KAAH,EAAf;AACA,UAAIK,WAAW,WAASgC,QAAxB;AACA,UAAI1B,QAAQ,IAAIxE,aAAayE,UAAjB,EAAZ;AACAD,YAAME,QAAN,CAAe,aAAf,EAA8B,wCAA9B;AACAF,YAAME,QAAN,CAAe,YAAf,EAA6BR,QAA7B;AACAM,YAAMI,MAAN,CAAa,MAAb,EAAqB,mBAArB,EAA0C;AACxCC,mBAAW,UAASC,MAAT,EAAgB;AACzB,cAAGA,OAAOC,OAAV,EAAmB;AACjB,gBAAIqB,gBAAgB,EAApB;AACA,gBAAIpB,OAAOC,SAAP,CAAiBC,QAAjB,CAA0BC,IAA1B,CAAgCL,OAAOC,OAAP,CAAeK,GAA/C,MAAyD,gBAA7D,EAAgF;AAC9E,kBAAIC,iBAAiBP,OAAOC,OAAP,CAAeK,GAAf,CAAmBE,MAAxC;AACA;AACA,mBAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAIF,cAApB,EAAoCE,GAApC,EAAyC;AACvCa,8BAAcZ,IAAd,CAAmBV,OAAOC,OAAP,CAAeK,GAAf,CAAmBG,CAAnB,CAAnB;AACD;AACF,aAND,MAMO;AACLa,4BAAcZ,IAAd,CAAmBV,OAAOC,OAAP,CAAeK,GAAlC;AACD;;AAED;AACA;AACA3F,oBAAQ4G,OAAR,CAAgBD,aAAhB,EAA+B,UAASE,IAAT,EAAeC,IAAf,EAAoB;;AAEjD;AACA,kBAAG9G,QAAQ+D,SAAR,CAAkB8C,KAAKE,YAAvB,KAAwCF,KAAKE,YAAL,KAAsB,EAAjE,EAAoE;AAClEJ,8BAAcG,IAAd,EAAoBC,YAApB,GAAmCvG,oBAAoBwG,aAApB,CAAkCH,KAAKE,YAAvC,EAAqD,KAArD,CAAnC;AACD;;AAED;AACAJ,4BAAcG,IAAd,EAAoBG,OAApB,GAA8B,EAA9B;AACA,sBAAOJ,KAAKK,IAAZ;AACE,qBAAK,MAAL;AACEP,gCAAcG,IAAd,EAAoBG,OAApB,GAA8B,cAA9B;AACA;AACF,qBAAK,YAAL;AACEN,gCAAcG,IAAd,EAAoBG,OAApB,GAA8B,mBAA9B;AACA;AACF,qBAAK,WAAL;AACA,qBAAK,UAAL;AACA,qBAAK,iCAAL;AACEN,gCAAcG,IAAd,EAAoBG,OAApB,GAA8B,eAA9B;AACA;AACF,qBAAK,eAAL;AACE,0BAAOJ,KAAKM,UAAZ;AACE,yBAAK,kBAAL;AACER,oCAAcG,IAAd,EAAoBG,OAApB,GAA8B,aAA9B;AACA;AACF,yBAAK,qBAAL;AACEN,oCAAcG,IAAd,EAAoBG,OAApB,GAA8B,iBAA9B;AACA;AACF;AACEN,oCAAcG,IAAd,EAAoBG,OAApB,GAA8B,eAA9B;AACA;AATJ;AAWA;AACF,qBAAK,UAAL;AACEN,gCAAcG,IAAd,EAAoBG,OAApB,GAA8B,iBAA9B;AACA;AACA;AACAN,gCAAcG,IAAd,EAAoBM,OAApB,GAA8B,KAA9B;AACA;AACF,qBAAK,SAAL;AACET,gCAAcG,IAAd,EAAoBO,SAApB,GAAgC,MAAhC;AACA,sBAAGrH,QAAQ+D,SAAR,CAAkB4C,cAAcG,IAAd,EAAoBQ,eAAtC,CAAH,EAA2D;AACzD,4BAAOX,cAAcG,IAAd,EAAoBQ,eAA3B;AACE,2BAAK,eAAL;AACEX,sCAAcG,IAAd,EAAoBO,SAApB,GAAgC,OAAhC;AACA;AACF,2BAAK,SAAL;AACEV,sCAAcG,IAAd,EAAoBO,SAApB,GAAgC,QAAhC;AACA;AANJ;AAQD;AACD;AA3CJ;AA6CA;;AAEA;AACAV,4BAAcG,IAAd,EAAoBS,OAApB,GAA8B,EAA9B;AACA,kBAAIV,KAAKK,IAAL,KAAc,WAAd,IACAL,KAAKK,IAAL,KAAc,UADd,IAEAL,KAAKK,IAAL,KAAc,UAFlB,EAE6B;;AAE3BrG,qBAAK2G,kBAAL,CAAwBX,IAAxB,EAA8BxE,IAA9B,CAAmC,UAASoF,WAAT,EAAqB;AACtDd,gCAAcG,IAAd,EAAoBS,OAApB,GAA8BE,WAA9B;;AAEA;AACA,sBAAIzH,QAAQ+D,SAAR,CAAkB4C,cAAcG,IAAd,EAAoBC,YAAtC,KACAJ,cAAcG,IAAd,EAAoBC,YAApB,KAAqC,EADzC,EAC4C;AAC1C/G,4BAAQ4G,OAAR,CAAgBD,cAAcG,IAAd,EAAoBS,OAApC,EAA6C,UAASG,OAAT,EAAiB;AAC5D,0BAAGA,QAAQC,MAAR,KAAmBhB,cAAcG,IAAd,EAAoBC,YAA1C,EAAuD;AACrD,4BAAGF,KAAKK,IAAL,KAAc,UAAjB,EAA4B;AAC1BP,wCAAcG,IAAd,EAAoBlE,MAApB,GAA6B,EAA7B;AACA+D,wCAAcG,IAAd,EAAoBlE,MAApB,CAA2B8E,QAAQC,MAAnC,IAA6CD,QAAQE,MAArD;AACD,yBAHD,MAGO;AACLjB,wCAAcG,IAAd,EAAoBlE,MAApB,GAA6B8E,OAA7B;AACD;AACF;AACF,qBATD;AAUD;AACF,iBAjBD;AAkBD,eAtBD,MAsBO,IAAIb,KAAKK,IAAL,KAAc,eAAlB,EAAkC;AACvC,oBAAGL,KAAKM,UAAL,KAAoB,wBAApB,IAAgDN,KAAKM,UAAL,KAAoB,mBAAvE,EAA2F;AACzF;AACAtG,uBAAKgH,OAAL,CAAahB,KAAKM,UAAlB,EAA8B9E,IAA9B,CAAmC,UAASyF,KAAT,EAAe;AAChD;AACAnB,kCAAcG,IAAd,EAAoBS,OAApB,GAA8BO,KAA9B;AACA;AACA,wBAAI9H,QAAQ+D,SAAR,CAAkB4C,cAAcG,IAAd,EAAoBC,YAAtC,KACAJ,cAAcG,IAAd,EAAoBC,YAApB,KAAqC,EADzC,EAC4C;AAC1C/G,8BAAQ4G,OAAR,CAAgBD,cAAcG,IAAd,EAAoBS,OAApC,EAA6C,UAASG,OAAT,EAAiB;AAC5D,4BAAGA,QAAQC,MAAR,KAAmBhB,cAAcG,IAAd,EAAoBC,YAA1C,EAAuD;AACrDJ,wCAAcG,IAAd,EAAoBlE,MAApB,GAA6B8E,OAA7B;AACD;AACF,uBAJD;AAKD;AACF,mBAZD,EAYG,UAASlE,KAAT,EAAe;AAChB5C,+BAAWyF,MAAX,CAAkB7C,KAAlB,EAAyB,OAAzB,EAAkC,8CAAlC,EAAkF,KAAlF,EAAyF,KAAzF;AACD,mBAdD;AAeD,iBAjBD,MAiBO,IAAIqD,KAAKM,UAAL,KAAoB,UAAxB,EAAoC;AACzC;AACAtG,uBAAKkH,cAAL,GAAsB1F,IAAtB,CAA2B,UAAS2F,MAAT,EAAgB;AACzC;AACArB,kCAAcG,IAAd,EAAoBS,OAApB,GAA8BS,MAA9B;AACD,mBAHD,EAGG,UAASxE,KAAT,EAAe;AAChB5C,+BAAWyF,MAAX,CAAkB7C,KAAlB,EAAyB,OAAzB,EAAkC,qDAAlC,EAAyF,KAAzF,EAAgG,KAAhG;AACD,mBALD;AAMD,iBARM,MAQA,IAAIqD,KAAKM,UAAL,KAAoB,qBAAxB,EAA+C;AACpD;AACD;AACF;AACF,aA9GD;AA+GAhD,qBAASjC,OAAT,CAAiByE,aAAjB;AACD,WA9HD,MA8HO;AACLxC,qBAAS8B,MAAT,CAAgB,qBAAhB;AACD;AACF,SAnIuC;AAoIxCD,mBAAW,UAASxC,KAAT,EAAe;AACxB5C,qBAAWyF,MAAX,CAAkB7C,KAAlB,EAAyB,OAAzB,EAAkC,sCAAlC,EAA0E,KAA1E,EAAiF,KAAjF;AACAW,mBAAS8B,MAAT,CAAgBzC,KAAhB;AACD;AAvIuC,OAA1C;AAyIA,aAAOW,SAAS+B,OAAhB;AACD,KAhJD;;AAkJA;AACArF,SAAKgH,OAAL,GAAe,UAASI,MAAT,EAAiB;AAC9BpH,WAAK4B,WAAL,GAAmBhC,MAAMiC,GAAN,CAAU,aAAV,CAAnB;AACA,UAAIoF,QAAQ,EAAZ;AACA,UAAI3D,WAAW7D,GAAG8D,KAAH,EAAf;AACA,UAAIW,QAAQ,IAAIxE,aAAayE,UAAjB,EAAZ;AACA,UAAGiD,WAAW,wBAAd,EAAwC;AACtC,YAAIxD,WAAW,YAAU5D,KAAK4B,WAAL,CAAiBiC,SAA1C;AACAK,cAAME,QAAN,CAAe,aAAf,EAA8B,yCAA9B;AACAF,cAAME,QAAN,CAAe,YAAf,EAA6BR,QAA7B;AACD,OAJD,MAIO;AACLM,cAAME,QAAN,CAAe,aAAf,EAA8B,yCAA9B;AACD;AACDF,YAAMI,MAAN,CAAa,MAAb,EAAqB,mBAArB,EAA0C;AACxCC,mBAAW,UAASC,MAAT,EAAgB;AACzB,cAAGA,OAAOC,OAAV,EAAmB;AACjB,gBAAIC,OAAOC,SAAP,CAAiBC,QAAjB,CAA0BC,IAA1B,CAAgCL,OAAOC,OAAP,CAAeK,GAA/C,MAAyD,gBAA7D,EAAgF;AAC9E,kBAAIC,iBAAiBP,OAAOC,OAAP,CAAeK,GAAf,CAAmBE,MAAxC;AACA,mBAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAIF,cAApB,EAAoCE,GAApC,EAAyC;AACvCgC,sBAAM/B,IAAN,CAAWV,OAAOC,OAAP,CAAeK,GAAf,CAAmBG,CAAnB,CAAX;AACD;AACF,aALD,MAKO;AACLgC,oBAAM/B,IAAN,CAAWV,OAAOC,OAAP,CAAeK,GAA1B;AACD;AACDxB,qBAASjC,OAAT,CAAiB4F,KAAjB;AACD;AACF,SAbuC;AAcxC9B,mBAAW,UAASxC,KAAT,EAAe;AACxB5C,qBAAWyF,MAAX,CAAkB7C,KAAlB,EAAyB,OAAzB,EAAkC,4BAAlC,EAAgE,KAAhE,EAAuE,KAAvE;AACAW,mBAAS8B,MAAT,CAAgBzC,KAAhB;AACD;AAjBuC,OAA1C;AAmBA,aAAOW,SAAS+B,OAAhB;AACD,KAhCD;;AAkCA;AACArF,SAAK2G,kBAAL,GAA0B,UAASU,IAAT,EAAe;AACvC,UAAIC,WAAW,EAAf;AACA,UAAIhE,WAAW7D,GAAG8D,KAAH,EAAf;AACA;AACA,UAAIK,WAAW,SAAOyD,KAAKE,MAA3B;AACA,UAAIrD,QAAQ,IAAIxE,aAAayE,UAAjB,EAAZ;AACAD,YAAME,QAAN,CAAe,aAAf,EAA8B,2CAA9B;AACAF,YAAME,QAAN,CAAe,YAAf,EAA6BR,QAA7B;AACAM,YAAMI,MAAN,CAAa,MAAb,EAAqB,mBAArB,EAA0C;AACxCC,mBAAW,UAASC,MAAT,EAAgB;AACzB,cAAGA,OAAOC,OAAV,EAAmB;AACjB,gBAAIC,OAAOC,SAAP,CAAiBC,QAAjB,CAA0BC,IAA1B,CAAgCL,OAAOC,OAAP,CAAeK,GAA/C,MAAyD,gBAA7D,EAAgF;AAC9E,kBAAIC,iBAAiBP,OAAOC,OAAP,CAAeK,GAAf,CAAmBE,MAAxC;AACA;AACA,mBAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAIF,cAApB,EAAoCE,GAApC,EAAyC;AACvCqC,yBAASpC,IAAT,CAAcV,OAAOC,OAAP,CAAeK,GAAf,CAAmBG,CAAnB,CAAd;AACD;AACF,aAND,MAMO;AACLqC,uBAASpC,IAAT,CAAcV,OAAOC,OAAP,CAAeK,GAA7B;AACD;AACF;;AAED;AACA,cAAI3F,QAAQ+D,SAAR,CAAkBmE,KAAK9E,OAAvB,KAAmC8E,KAAK9E,OAAL,KAAiB,EAApD,IACApD,QAAQ+D,SAAR,CAAkBmE,KAAKP,MAAvB,CADA,IACkCO,KAAKP,MAAL,KAAgB,EADlD,IAEA3H,QAAQ+D,SAAR,CAAkBmE,KAAKG,MAAvB,CAFA,IAEkCH,KAAKG,MAAL,KAAgB,EAFtD,EAGI;;AAEFxH,iBAAKyH,mBAAL,CAAyBJ,IAAzB,EAA+B7F,IAA/B,CAAoC,UAASkG,OAAT,EAAiB;AACnDvI,sBAAQ4G,OAAR,CAAgB2B,OAAhB,EAAyB,UAASC,MAAT,EAAiBC,MAAjB,EAAwB;AAC/CN,yBAASpC,IAAT,CAAcyC,MAAd;AACD,eAFD;AAGArE,uBAASjC,OAAT,CAAiBiG,QAAjB;AACD,aALD;AAMD,WAXD,MAWO;AACHhE,qBAASjC,OAAT,CAAiBiG,QAAjB;AACH;AACF,SA7BuC;AA8BxCnC,mBAAW,UAASxC,KAAT,EAAe;AACxB5C,qBAAWyF,MAAX,CAAkB7C,KAAlB,EAAyB,OAAzB,EAAkC,uCAAlC,EAA2E,KAA3E,EAAkF,KAAlF;AACAW,mBAAS8B,MAAT,CAAgBzC,KAAhB;AACD;AAjCuC,OAA1C;AAmCA,aAAOW,SAAS+B,OAAhB;AACD,KA5CD;;AA8CA;AACArF,SAAKyH,mBAAL,GAA2B,UAASJ,IAAT,EAAeQ,WAAf,EAA2B;AACpD,UAAIP,WAAW,EAAf;AACA,UAAIhE,WAAW7D,GAAG8D,KAAH,EAAf;AACA,UAAIK,WAAW,EAAf;AACA,UAAIM,QAAQ,IAAIxE,aAAayE,UAAjB,EAAZ;AACAP,kBAAY,YAAUyD,KAAK9E,OAA3B;AACAqB,kBAAY,cAAYyD,KAAKP,MAA7B;AACA;AACA,UAAG3H,QAAQ+D,SAAR,CAAkBmE,KAAKG,MAAvB,KAAkCH,KAAKG,MAAL,KAAgB,EAArD,EAAwD;AACtD5D,oBAAY,cAAYyD,KAAKG,MAA7B;AACD;AACD,UAAGrI,QAAQ+D,SAAR,CAAkBmE,KAAKS,MAAvB,KAAkCT,KAAKS,MAAL,KAAgB,EAArD,EAAwD;AACtD;AACA,YAAIC,aAAapI,oBAAoBwG,aAApB,CAAkCkB,KAAKS,MAAvC,EAA+C,IAA/C,CAAjB;AACAC,qBAAa7D,MAAM8D,YAAN,CAAmBD,UAAnB,CAAb;AACAnE,oBAAY,cAAYmE,UAAxB;AACD;;AAED7D,YAAME,QAAN,CAAe,aAAf,EAA8B,4CAA9B;AACAF,YAAME,QAAN,CAAe,YAAf,EAA6BR,QAA7B;AACAM,YAAMI,MAAN,CAAa,MAAb,EAAqB,mBAArB,EAA0C;AACxCC,mBAAW,UAASC,MAAT,EAAgB;AACzB,cAAGA,OAAOC,OAAV,EAAmB;AACjB,gBAAIC,OAAOC,SAAP,CAAiBC,QAAjB,CAA0BC,IAA1B,CAAgCL,OAAOC,OAAP,CAAeK,GAA/C,MAAyD,gBAA7D,EAAgF;AAC9E,kBAAIC,iBAAiBP,OAAOC,OAAP,CAAeK,GAAf,CAAmBE,MAAxC;AACA,mBAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAIF,cAApB,EAAoCE,GAApC,EAAyC;AACvCqC,yBAASpC,IAAT,CAAcV,OAAOC,OAAP,CAAeK,GAAf,CAAmBG,CAAnB,CAAd;AACD;AACF,aALD,MAKO;AACLqC,uBAASpC,IAAT,CAAcV,OAAOC,OAAP,CAAeK,GAA7B;AACD;AACDxB,qBAASjC,OAAT,CAAiBiG,QAAjB;AACD;AACF,SAbuC;AAcxCnC,mBAAW,UAASxC,KAAT,EAAe;AACxB5C,qBAAWyF,MAAX,CAAkB7C,KAAlB,EAAyB,OAAzB,EAAkC,wCAAlC,EAA4E,KAA5E,EAAmF,KAAnF;AACAW,mBAAS8B,MAAT,CAAgBzC,KAAhB;AACD;AAjBuC,OAA1C;AAmBA,aAAOW,SAAS+B,OAAhB;AACD,KAxCD;;AA0CA;AACArF,SAAKkH,cAAL,GAAsB,YAAW;AAC/BlH,WAAKiI,SAAL,GAAiBrI,MAAMiC,GAAN,CAAU,WAAV,CAAjB;AACA,UAAIyB,WAAW7D,GAAG8D,KAAH,EAAf;AACAvD,WAAKkI,QAAL,GAAgB,EAAhB;AACA,UAAIhE,QAAQ,IAAIxE,aAAayE,UAAjB,EAAZ;AACAD,YAAME,QAAN,CAAe,gBAAf,EAAiC,MAAjC;AACAF,YAAMI,MAAN,CAAa,aAAb,EAA4B,4BAA5B,EAA0D;AACxDC,mBAAW,UAAS7B,QAAT,EAAkB;AAC3B,cAAIyF,UAAU,EAAd;AACA,cAAIC,YAAY,EAAhB;AACAjJ,kBAAQ4G,OAAR,CAAgBrD,SAAS2F,gBAAzB,EAA2C,UAASC,KAAT,EAAgBC,KAAhB,EAAsB;;AAE/D;;AAEA;AACA;AACA;AACA;AACAH,sBAAUE,MAAME,IAAhB,IAAwBF,KAAxB;AACD,WATD;AAUA;AACAnJ,kBAAQ4G,OAAR,CAAgBqC,SAAhB,EAA2B,UAASK,KAAT,EAAgBC,WAAhB,EAA4B;AACrD;AACA,gBAAIC,aAAaF,MAAMD,IAAN,CAAWI,KAAX,CAAiB,MAAjB,CAAjB;AACA;AACA;AACE,gBAAIC,gBAAgB,EAApB;AACA7I,iBAAK8I,QAAL,GAAgB,EAAhB;AACA;AACA3J,oBAAQ4G,OAAR,CAAgB4C,UAAhB,EAA4B,UAASI,OAAT,EAAkBC,MAAlB,EAAyB;AACnD,kBAAIC,UAAU,EAAd;AACA,kBAAGD,WAAW,CAAd,EAAgB;AACdH,iCAAiB,MAAjB;AACD;AACDA,+BAAiBE,OAAjB;AACAE,sBAAQC,EAAR,GAAaL,aAAb;AACAI,sBAAQE,WAAR,GAAsBnJ,KAAK8I,QAA3B;AACAG,sBAAQT,IAAR,GAAeO,OAAf;AACAE,sBAAQG,OAAR,GAAkBhB,UAAUS,aAAV,EAAyBQ,IAA3C;AACAlB,sBAAQjD,IAAR,CAAa+D,OAAb;AACAjJ,mBAAK8I,QAAL,GAAgBC,OAAhB;AACD,aAZD;AAaF;AACD,WAtBD;AAuBA;AACA/I,eAAKkI,QAAL,GAAgBrI,WAAWyJ,iBAAX,CAA6BnB,OAA7B,EAAsC,MAAtC,CAAhB;AACA7E,mBAASjC,OAAT,CAAiBrB,KAAKkI,QAAtB;AACD,SAzCuD;AA0CxD/C,mBAAW,UAASxC,KAAT,EAAe;AACxB5C,qBAAWyF,MAAX,CAAkB7C,KAAlB,EAAyB,OAAzB,EAAkC,mCAAlC,EAAuE,KAAvE,EAA8E,KAA9E;AACAW,mBAAS8B,MAAT,CAAgBzC,KAAhB;AACD;AA7CuD,OAA1D;AA+CA,aAAOW,SAAS+B,OAAhB;AACD,KAtDD;;AAwDA;AACArF,SAAKuJ,gBAAL,GAAwB,UAASC,QAAT,EAAkB;AACxC,UAAIC,YAAY,EAAhB;AACA,UAAGtK,QAAQ+D,SAAR,CAAkBsG,QAAlB,CAAH,EAA+B;AAC7BC,kBAAU3C,MAAV,GAAmB0C,SAAS,CAAT,EAAYJ,OAA/B;AACAK,kBAAU1C,MAAV,GAAmByC,SAAS,CAAT,EAAYN,EAA/B;AACD;AACD;AACA,UAAG,CAAC/J,QAAQ+D,SAAR,CAAkBuG,UAAU3C,MAA5B,CAAJ,EAAwC;AACtC,eAAO,EAAP;AACD;AACD,aAAO2C,SAAP;AACD,KAXD;;AAaA;AACAzJ,SAAK0J,cAAL,GAAsB,UAASF,QAAT,EAAkB;AACtC,UAAIC,YAAY,EAAhB;AACA,UAAGtK,QAAQ+D,SAAR,CAAkBsG,QAAlB,CAAH,EAA+B;AAC7BC,kBAAU3C,MAAV,GAAmB0C,SAAS,CAAT,EAAYN,EAA/B;AACAO,kBAAU1C,MAAV,GAAmByC,SAAS,CAAT,EAAYhB,IAA/B;AACD;AACD;AACA,UAAG,CAACrJ,QAAQ+D,SAAR,CAAkBuG,UAAU3C,MAA5B,CAAJ,EAAwC;AACtC,eAAO,EAAP;AACD;AACD,aAAO2C,SAAP;AACD,KAXD;;AAaA;AACAzJ,SAAK2J,mBAAL,GAA2B,UAASH,QAAT,EAAkB;AAC3C,UAAII,YAAY,EAAhB;AACAzK,cAAQ4G,OAAR,CAAgByD,QAAhB,EAA0B,UAASK,OAAT,EAAiB;AACzC,YAAGD,cAAc,EAAjB,EAAqBA,aAAa,IAAb;AACrBA,qBAAaC,QAAQC,MAArB;AACD,OAHD;AAIA,aAAOF,SAAP;AACD,KAPD;;AASA;AACA5J,SAAK+J,eAAL,GAAuB,UAASpI,QAAT,EAAmB;AACxCA,eAAS4E,OAAT,GAAmB,KAAnB;AACApH,cAAQ4G,OAAR,CAAgBpE,SAASI,MAAzB,EAAiC,UAASiI,IAAT,EAAeC,IAAf,EAAoB;AACnD,YAAGD,KAAKzD,OAAL,KAAiB,IAApB,EAA0B5E,SAAS4E,OAAT,GAAmB,IAAnB;AAC3B,OAFD;AAGD,KALD;;AAOA;AACAvG,SAAKkK,cAAL,GAAsB,UAASvI,QAAT,EAAmBwI,MAAnB,EAA0B;AAC9C,UAAI7G,WAAW7D,GAAG8D,KAAH,EAAf;AACA,UAAI+D,WAAW,EAAf;AACA,UAAI1D,WAAW,EAAf;AACA,UAAIM,QAAQ,IAAIxE,aAAayE,UAAjB,EAAZ;AACA,UAAI,CAACgG,MAAL,EAAa;AACX;AACAvG,oBAAY,YAAUjC,SAASY,OAA/B;AACAqB,oBAAY,cAAYjC,SAASmF,MAAjC;AACA;AACA,YAAG3H,QAAQ+D,SAAR,CAAkBvB,SAAS6F,MAA3B,KAAsC7F,SAAS6F,MAAT,KAAoB,EAA7D,EAAgE;AAC9D5D,sBAAY,cAAYjC,SAAS6F,MAAjC;AACD;AACD;AACA,YAAGrI,QAAQ+D,SAAR,CAAkBvB,SAASyI,WAA3B,KAA2CzI,SAASyI,WAAT,KAAyB,EAAvE,EAA0E;AACxExG,sBAAY,cAAYjC,SAAS6F,MAAjC;AACD;AACD,YAAGrI,QAAQ+D,SAAR,CAAkBvB,SAASmG,MAA3B,KAAsCnG,SAASmG,MAAT,KAAoB,EAA7D,EAAgE;AAC9D;AACAlE,sBAAY,cAAYjE,oBAAoBwG,aAApB,CAAkCxE,SAASmG,MAA3C,EAAmD,IAAnD,CAAxB;AACD;AACD5D,cAAME,QAAN,CAAe,aAAf,EAA8B,4CAA9B;AACAF,cAAME,QAAN,CAAe,YAAf,EAA6BR,QAA7B;AACAM,cAAMI,MAAN,CAAa,MAAb,EAAqB,mBAArB,EAA0C;AACxCC,qBAAW,UAASC,MAAT,EAAgB;AACzB,gBAAGA,OAAOC,OAAV,EAAmB;AACjB,kBAAIC,OAAOC,SAAP,CAAiBC,QAAjB,CAA0BC,IAA1B,CAAgCL,OAAOC,OAAP,CAAeK,GAA/C,MAAyD,gBAA7D,EAAgF;AAC9E,oBAAIC,iBAAiBP,OAAOC,OAAP,CAAeK,GAAf,CAAmBE,MAAxC;AACA,qBAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAIF,cAApB,EAAoCE,GAApC,EAAyC;AACvC,sBAAIoF,UAAU,EAAd;AACAA,0BAAQnB,EAAR,GAAa1E,OAAOC,OAAP,CAAeK,GAAf,CAAmBG,CAAnB,EAAsB6B,MAAnC;AACA,sBAAG3H,QAAQ+D,SAAR,CAAkBsB,OAAOC,OAAP,CAAeK,GAAf,CAAmBG,CAAnB,EAAsB8B,MAAxC,CAAH,EAAmD;AACjDsD,4BAAQ7B,IAAR,GAAehE,OAAOC,OAAP,CAAeK,GAAf,CAAmBG,CAAnB,EAAsB8B,MAArC;AACAsD,4BAAQP,MAAR,GAAiBtF,OAAOC,OAAP,CAAeK,GAAf,CAAmBG,CAAnB,EAAsB8B,MAAvC;AACD,mBAHD,MAGO;AACLsD,4BAAQ7B,IAAR,GAAehE,OAAOC,OAAP,CAAeK,GAAf,CAAmBG,CAAnB,EAAsB6B,MAArC;AACAuD,4BAAQP,MAAR,GAAiBtF,OAAOC,OAAP,CAAeK,GAAf,CAAmBG,CAAnB,EAAsB6B,MAAvC;AACD;AACD,sBAAG3H,QAAQ+D,SAAR,CAAkBsB,OAAOC,OAAP,CAAeK,GAAf,CAAmBG,CAAnB,EAAsBqF,MAAxC,CAAH,EAAmD;AACjDD,4BAAQ7B,IAAR,GAAe6B,QAAQ7B,IAAR,GAAe,KAAf,GAAuBhE,OAAOC,OAAP,CAAeK,GAAf,CAAmBG,CAAnB,EAAsBqF,MAA5D;AACD;AACDD,0BAAQE,WAAR,GAAsB,IAAtB;AACAjD,2BAASpC,IAAT,CAAcmF,OAAd;AACD;AACF,eAlBD,MAkBO;AACL,oBAAIG,aAAa,EAAjB;AACAA,2BAAWtB,EAAX,GAAgB1E,OAAOC,OAAP,CAAeK,GAAf,CAAmBgC,MAAnC;AACA,oBAAG3H,QAAQ+D,SAAR,CAAkBsB,OAAOC,OAAP,CAAeK,GAAf,CAAmBiC,MAArC,CAAH,EAAgD;AAC9CyD,6BAAWhC,IAAX,GAAkBhE,OAAOC,OAAP,CAAeK,GAAf,CAAmBiC,MAArC;AACAyD,6BAAWV,MAAX,GAAoBtF,OAAOC,OAAP,CAAeK,GAAf,CAAmBiC,MAAvC;AACD,iBAHD,MAGO;AACLyD,6BAAWhC,IAAX,GAAkBhE,OAAOC,OAAP,CAAeK,GAAf,CAAmBgC,MAArC;AACA0D,6BAAWV,MAAX,GAAoBtF,OAAOC,OAAP,CAAeK,GAAf,CAAmBgC,MAAvC;AACD;AACD,oBAAG3H,QAAQ+D,SAAR,CAAkBsB,OAAOC,OAAP,CAAeK,GAAf,CAAmBwF,MAArC,CAAH,EAAgD;AAC9CE,6BAAWhC,IAAX,GAAkBgC,WAAWhC,IAAX,GAAkB,KAAlB,GAA0BhE,OAAOC,OAAP,CAAeK,GAAf,CAAmBwF,MAA/D;AACD;AACDhD,yBAASpC,IAAT,CAAcsF,UAAd;AACD;AACDlH,uBAASjC,OAAT,CAAiBiG,QAAjB;AACD;AACF,WAtCuC;AAuCxCnC,qBAAW,UAASxC,KAAT,EAAe;AACxB5C,uBAAWyF,MAAX,CAAkB7C,KAAlB,EAAyB,OAAzB,EAAkC,4CAAlC,EAAgF,KAAhF,EAAuF,KAAvF;AACAW,qBAAS8B,MAAT,CAAgBzC,KAAhB;AACD;AA1CuC,SAA1C;AA4CD,OA9DD,MA+DK;AACH;AACAiB,oBAAY,YAAUjC,SAAS8I,SAA/B;AACA7G,oBAAY,cAAYjC,SAAS+I,UAAjC;AACA;AACA,YAAGvL,QAAQ+D,SAAR,CAAkBvB,SAASgJ,UAA3B,KAA0ChJ,SAASgJ,UAAT,KAAwB,EAArE,EAAwE;AACtE/G,sBAAY,cAAYjC,SAASgJ,UAAjC;AACD;AACD;AACA,YAAGxL,QAAQ+D,SAAR,CAAkBvB,SAASiJ,UAA3B,KAA0CjJ,SAASiJ,UAAT,KAAwB,EAArE,EAAwE;AACtEhH,sBAAY,cAAYjC,SAASiJ,UAAjC;AACD;AACD,YAAGzL,QAAQ+D,SAAR,CAAkBvB,SAASkJ,UAA3B,KAA0ClJ,SAASkJ,UAAT,KAAwB,EAArE,EAAwE;AACtE;AACAjH,sBAAY,cAAYjE,oBAAoBwG,aAApB,CAAkCxE,SAASkJ,UAA3C,EAAuD,IAAvD,CAAxB;AACD;AACD,YAAG1L,QAAQ+D,SAAR,CAAkBvB,SAASmJ,gBAA3B,KAAgDnJ,SAASmJ,gBAAT,KAA8B,EAAjF,EAAoF;AAClF;AACAlH,sBAAY,iBAAejC,SAASmJ,gBAApC;AACAlH,sBAAY,oBAAkBuG,OAAOjB,EAArC;AACD;AACDhF,cAAME,QAAN,CAAe,aAAf,EAA8B,4CAA9B;AACAF,cAAME,QAAN,CAAe,YAAf,EAA6BR,QAA7B;AACAM,cAAMI,MAAN,CAAa,MAAb,EAAqB,mBAArB,EAA0C;AACxCC,qBAAW,UAASC,MAAT,EAAgB;AACzB,gBAAGA,OAAOC,OAAV,EAAmB;AACjB,kBAAIC,OAAOC,SAAP,CAAiBC,QAAjB,CAA0BC,IAA1B,CAAgCL,OAAOC,OAAP,CAAeK,GAA/C,MAAyD,gBAA7D,EAAgF;AAC9E,oBAAIC,iBAAiBP,OAAOC,OAAP,CAAeK,GAAf,CAAmBE,MAAxC;AACA,qBAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAIF,cAApB,EAAoCE,GAApC,EAAyC;AACvC,sBAAIoF,UAAU,EAAd;AACAA,0BAAQnB,EAAR,GAAa1E,OAAOC,OAAP,CAAeK,GAAf,CAAmBG,CAAnB,EAAsB6B,MAAnC;AACA,sBAAG3H,QAAQ+D,SAAR,CAAkBsB,OAAOC,OAAP,CAAeK,GAAf,CAAmBG,CAAnB,EAAsB8B,MAAxC,CAAH,EAAmD;AACjDsD,4BAAQ7B,IAAR,GAAehE,OAAOC,OAAP,CAAeK,GAAf,CAAmBG,CAAnB,EAAsB8B,MAArC;AACAsD,4BAAQP,MAAR,GAAiBtF,OAAOC,OAAP,CAAeK,GAAf,CAAmBG,CAAnB,EAAsB8B,MAAvC;AACD,mBAHD,MAGO;AACLsD,4BAAQ7B,IAAR,GAAehE,OAAOC,OAAP,CAAeK,GAAf,CAAmBG,CAAnB,EAAsB6B,MAArC;AACAuD,4BAAQP,MAAR,GAAiBtF,OAAOC,OAAP,CAAeK,GAAf,CAAmBG,CAAnB,EAAsB6B,MAAvC;AACD;AACD,sBAAG3H,QAAQ+D,SAAR,CAAkBsB,OAAOC,OAAP,CAAeK,GAAf,CAAmBG,CAAnB,EAAsBqF,MAAxC,CAAH,EAAmD;AACjDD,4BAAQ7B,IAAR,GAAe6B,QAAQ7B,IAAR,GAAe,KAAf,GAAuBhE,OAAOC,OAAP,CAAeK,GAAf,CAAmBG,CAAnB,EAAsBqF,MAA5D;AACD;AACDhD,2BAASpC,IAAT,CAAcmF,OAAd;AACD;AACF,eAjBD,MAiBO;AACL,oBAAIG,aAAa,EAAjB;AACAA,2BAAWtB,EAAX,GAAgB1E,OAAOC,OAAP,CAAeK,GAAf,CAAmBgC,MAAnC;AACA,oBAAG3H,QAAQ+D,SAAR,CAAkBsB,OAAOC,OAAP,CAAeK,GAAf,CAAmBiC,MAArC,CAAH,EAAgD;AAC9CyD,6BAAWhC,IAAX,GAAkBhE,OAAOC,OAAP,CAAeK,GAAf,CAAmBiC,MAArC;AACAyD,6BAAWV,MAAX,GAAoBtF,OAAOC,OAAP,CAAeK,GAAf,CAAmBiC,MAAvC;AACD,iBAHD,MAGO;AACLyD,6BAAWhC,IAAX,GAAkBhE,OAAOC,OAAP,CAAeK,GAAf,CAAmBgC,MAArC;AACA0D,6BAAWV,MAAX,GAAoBtF,OAAOC,OAAP,CAAeK,GAAf,CAAmBgC,MAAvC;AACD;AACD,oBAAG3H,QAAQ+D,SAAR,CAAkBsB,OAAOC,OAAP,CAAeK,GAAf,CAAmBwF,MAArC,CAAH,EAAgD;AAC9CE,6BAAWhC,IAAX,GAAkBgC,WAAWhC,IAAX,GAAkB,KAAlB,GAA0BhE,OAAOC,OAAP,CAAeK,GAAf,CAAmBwF,MAA/D;AACD;AACDhD,yBAASpC,IAAT,CAAcsF,UAAd;AACD;AACDlH,uBAASjC,OAAT,CAAiBiG,QAAjB;AACD,aAlCD,MAkCO;AACL;AACA;AACA6C,qBAAOY,OAAP,CAAeC,QAAf,GAA0B,KAA1B;AACAb,qBAAOY,OAAP,CAAeE,UAAf,GAA4B,KAA5B;AACA,kBAAIrI,gBAAgB,OAApB;AACA,kBAAIC,gBAAgB,oDAAkDsH,OAAO3B,IAAzD,GAA8D,WAAlF;AACA,kBAAI1F,iBAAiB,uBAArB;AACA/C,yBAAWgD,SAAX,CAAqBH,aAArB,EAAoCC,aAApC,EAAmDC,cAAnD;AACD;AACF,WA9CuC;AA+CxCqC,qBAAW,UAASxC,KAAT,EAAe;AACxB5C,uBAAWyF,MAAX,CAAkB7C,KAAlB,EAAyB,OAAzB,EAAkC,6CAAlC,EAAiF,IAAjF,EAAuF,KAAvF;AACAW,qBAAS8B,MAAT,CAAgBzC,KAAhB;AACD;AAlDuC,SAA1C;AAoDD;AACD,aAAOW,SAAS+B,OAAhB;AACD,KAjJD;;AAmJA;AACA;AACArF,SAAKkL,cAAL,GAAsB,UAASC,WAAT,EAAsBC,UAAtB,EAAkC;AACtD,UAAI9H,WAAW7D,GAAG8D,KAAH,EAAf;AACA;AACA,UAAI8H,iBAAiB,EAArB;AACA,UAAIC,aAAa,EAAjB;AACA,UAAI,CAACnM,QAAQ+D,SAAR,CAAkBiI,YAAYI,YAA9B,CAAD,IACCpM,QAAQ+D,SAAR,CAAkBiI,YAAYI,YAA9B,KAA+CJ,YAAYI,YAAZ,KAA6B,SADjF,EAC4F;AACtFD,qBAAa,MAAb;AACA;AACAtL,aAAKwL,aAAL,CAAmBJ,WAAWK,UAA9B,EAA0CH,UAA1C,EAAsD9J,IAAtD,CAA2D,UAASkK,OAAT,EAAiB;AAC1E;AACA1L,eAAK2L,kBAAL,CAAwBP,WAAWK,UAAnC,EAA+CH,UAA/C,EAA2DH,YAAYS,SAAvE,EAAkFpK,IAAlF,CAAuF,UAASqK,eAAT,EAAyB;AAC9G7L,iBAAKI,MAAL,GAAcyL,eAAd;AACA;AACAR,6BAAiBrL,KAAK8L,gBAAL,CAAsBJ,OAAtB,CAAjB;AACApI,qBAASjC,OAAT,CAAiBgK,cAAjB;AACD,WALD;AAMD,SARD,EAQG,UAAS1I,KAAT,EAAe;AAChB5C,qBAAWyF,MAAX,CAAkB7C,KAAlB,EAAyB,OAAzB,EAAkC,mCAAlC,EAAuE,KAAvE,EAA8E,KAA9E;AACAW,mBAAS8B,MAAT,CAAgBzC,KAAhB;AACD,SAXD;AAYL,OAhBD,MAgBO,IAAIxD,QAAQ+D,SAAR,CAAkBiI,YAAYI,YAA9B,KAA+CJ,YAAYI,YAAZ,KAA6B,cAAhF,EAA+F;AACpGD,qBAAa,MAAb;AACA;AACAtL,aAAKwL,aAAL,CAAmBJ,WAAWW,OAA9B,EAAuCT,UAAvC,EAAmD9J,IAAnD,CAAwD,UAASkK,OAAT,EAAiB;AACvE;AACA1L,eAAK2L,kBAAL,CAAwBP,WAAWW,OAAnC,EAA4CT,UAA5C,EAAwDH,YAAYS,SAApE,EAA+EpK,IAA/E,CAAoF,UAASqK,eAAT,EAAyB;AAC3G7L,iBAAKI,MAAL,GAAcyL,eAAd;AACA;AACAR,6BAAiBrL,KAAK8L,gBAAL,CAAsBJ,OAAtB,CAAjB;AACApI,qBAASjC,OAAT,CAAiBgK,cAAjB;AACD,WALD;AAMD,SARD,EAQG,UAAS1I,KAAT,EAAe;AAChB5C,qBAAWyF,MAAX,CAAkB7C,KAAlB,EAAyB,OAAzB,EAAkC,mCAAlC,EAAuE,KAAvE,EAA8E,KAA9E;AACAW,mBAAS8B,MAAT,CAAgBzC,KAAhB;AACD,SAXD;AAYD,OAfM,MAeA,IAAIxD,QAAQ+D,SAAR,CAAkBiI,YAAYI,YAA9B,KAA+CJ,YAAYI,YAAZ,KAA6B,2BAAhF,EAA4G;AACjHD,qBAAa,MAAb;AACA;AACAtL,aAAKwL,aAAL,CAAmBJ,WAAWW,OAA9B,EAAuCT,UAAvC,EAAmD9J,IAAnD,CAAwD,UAASkK,OAAT,EAAiB;AACvE,cAAGA,QAAQ1G,MAAR,KAAmB,CAAtB,EAAyB;AACvBsG,yBAAa,MAAb;AACA;AACAtL,iBAAKwL,aAAL,CAAmBJ,WAAWK,UAA9B,EAA0CH,UAA1C,EAAsD9J,IAAtD,CAA2D,UAASkK,OAAT,EAAiB;AAC1E;AACA1L,mBAAK2L,kBAAL,CAAwBP,WAAWK,UAAnC,EAA+CH,UAA/C,EAA2DH,YAAYS,SAAvE,EAAkFpK,IAAlF,CAAuF,UAASqK,eAAT,EAAyB;AAC9G7L,qBAAKI,MAAL,GAAcyL,eAAd;AACA;AACAR,iCAAiBrL,KAAK8L,gBAAL,CAAsBJ,OAAtB,CAAjB;AACApI,yBAASjC,OAAT,CAAiBgK,cAAjB;AACD,eALD;AAMD,aARD,EAQG,UAAS1I,KAAT,EAAe;AAChB5C,yBAAWyF,MAAX,CAAkB7C,KAAlB,EAAyB,OAAzB,EAAkC,mCAAlC,EAAuE,KAAvE,EAA8E,KAA9E;AACAW,uBAAS8B,MAAT,CAAgBzC,KAAhB;AACD,aAXD;AAYD,WAfD,MAeO;AACL;AACA3C,iBAAK2L,kBAAL,CAAwBP,WAAWW,OAAnC,EAA4CT,UAA5C,EAAwDH,YAAYS,SAApE,EAA+EpK,IAA/E,CAAoF,UAASqK,eAAT,EAAyB;AAC3G7L,mBAAKI,MAAL,GAAcyL,eAAd;AACA;AACAR,+BAAiBrL,KAAK8L,gBAAL,CAAsBJ,OAAtB,CAAjB;AACApI,uBAASjC,OAAT,CAAiBgK,cAAjB;AACD,aALD;AAMD;AACF,SAzBD,EAyBG,UAAS1I,KAAT,EAAe;AAChB5C,qBAAWyF,MAAX,CAAkB7C,KAAlB,EAAyB,OAAzB,EAAkC,mCAAlC,EAAuE,KAAvE,EAA8E,KAA9E;AACAW,mBAAS8B,MAAT,CAAgBzC,KAAhB;AACD,SA5BD;AA6BD;AACD,aAAOW,SAAS+B,OAAhB;AACD,KAtED;;AAwEArF,SAAKgM,oBAAL,GAA4B,UAASb,WAAT,EAAsBC,UAAtB,EAAkC;AAC5D,UAAI9H,WAAW7D,GAAG8D,KAAH,EAAf;AACA,UAAI0I,cAAc,MAAlB;AACAjM,WAAKkL,cAAL,CAAoBC,WAApB,EAAiCC,UAAjC,EAA6C5J,IAA7C,CAAkD,UAAS0K,eAAT,EAAyB;AACzE,YAAG/M,QAAQ+D,SAAR,CAAkBgJ,gBAAgBhG,YAAlC,KAAmDgG,gBAAgBhG,YAAhB,GAA+B,CAArF,EAAwF;AACtF/G,kBAAQ4G,OAAR,CAAgBmG,gBAAgBxF,OAAhC,EAAyC,UAASyF,OAAT,EAAiB;AACxD,gBAAGA,QAAQrF,MAAR,KAAmBoF,gBAAgBhG,YAAnC,IAAmD/G,QAAQ+D,SAAR,CAAkBiJ,QAAQC,UAAR,CAAmBC,KAArC,CAAtD,EAAmG;AACjGJ,4BAAcE,QAAQC,UAAtB;AACD;AACF,WAJD;AAKD;AACD9I,iBAASjC,OAAT,CAAiB4K,WAAjB;AACD,OATD,EASG,UAAStJ,KAAT,EAAgB;AACjBW,iBAASjC,OAAT,CAAiB4K,WAAjB;AACD,OAXD;AAYA,aAAO3I,SAAS+B,OAAhB;AACD,KAhBD;;AAkBA;AACArF,SAAKwL,aAAL,GAAqB,UAASc,SAAT,EAAoBC,OAApB,EAA4B;AAC/C,UAAIjJ,WAAW7D,GAAG8D,KAAH,EAAf;AACA,UAAIK,WAAW,aAAW2I,OAA1B;AACA3I,kBAAY,UAAQ0I,SAApB;AACA,UAAIpI,QAAQ,IAAIxE,aAAayE,UAAjB,EAAZ;AACAD,YAAME,QAAN,CAAe,aAAf,EAA8B,+BAA9B;AACAF,YAAME,QAAN,CAAe,YAAf,EAA6BR,QAA7B;AACAM,YAAMI,MAAN,CAAa,MAAb,EAAqB,mBAArB,EAA0C;AACxCC,mBAAW,UAASC,MAAT,EAAgB;AACzB,cAAIgI,WAAW,EAAf;AACA,cAAGrN,QAAQgE,QAAR,CAAiBqB,OAAOC,OAAxB,CAAH,EAAoC;AAClC,gBAAIC,OAAOC,SAAP,CAAiBC,QAAjB,CAA0BC,IAA1B,CAAgCL,OAAOC,OAAP,CAAeK,GAA/C,MAAyD,gBAA7D,EAAgF;AAC9E,kBAAIC,iBAAiBP,OAAOC,OAAP,CAAeK,GAAf,CAAmBE,MAAxC;AACA;AACA,mBAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAIF,cAApB,EAAoCE,GAApC,EAAyC;AACvCuH,yBAAStH,IAAT,CAAcV,OAAOC,OAAP,CAAeK,GAAf,CAAmBG,CAAnB,CAAd;AACD;AACF,aAND,MAMO;AACLuH,uBAAStH,IAAT,CAAcV,OAAOC,OAAP,CAAeK,GAA7B;AACD;AACF;AACDxB,mBAASjC,OAAT,CAAiBmL,QAAjB;AACD,SAfuC;AAgBxCrH,mBAAW,UAASxC,KAAT,EAAe;AACxB5C,qBAAWyF,MAAX,CAAkB7C,KAAlB,EAAyB,OAAzB,EAAkC,kCAAlC,EAAsE,KAAtE,EAA6E,KAA7E;AACAW,mBAAS8B,MAAT,CAAgBzC,KAAhB;AACD;AAnBuC,OAA1C;AAqBA,aAAOW,SAAS+B,OAAhB;AACD,KA7BD;;AA+BArF,SAAK2L,kBAAL,GAA0B,UAASc,KAAT,EAAgBC,OAAhB,EAAyBC,SAAzB,EAAmC;AAC3D,UAAIC,QAAQ,GAAZ;AACA,UAAItJ,WAAW7D,GAAG8D,KAAH,EAAf;AACA,UAAIK,WAAW,aAAW8I,OAA1B;AACA9I,kBAAY,YAAU6I,KAAtB;AACA7I,kBAAY,gBAAc+I,SAA1B;AACA,UAAIzI,QAAQ,IAAIxE,aAAayE,UAAjB,EAAZ;AACAD,YAAME,QAAN,CAAe,aAAf,EAA8B,yCAA9B;AACAF,YAAME,QAAN,CAAe,YAAf,EAA6BR,QAA7B;AACAM,YAAMI,MAAN,CAAa,MAAb,EAAqB,mBAArB,EAA0C;AACxCC,mBAAW,UAASC,MAAT,EAAgB;AACzB,cAAGrF,QAAQgE,QAAR,CAAiBqB,OAAOC,OAAxB,CAAH,EAAoC;AAClCmI,oBAAQpI,OAAOC,OAAP,CAAeK,GAAf,CAAmB+H,OAA3B;AACD;AACDvJ,mBAASjC,OAAT,CAAiBuL,KAAjB;AACD,SANuC;AAOxCzH,mBAAW,UAASxC,KAAT,EAAe;AACxB5C,qBAAWyF,MAAX,CAAkB7C,KAAlB,EAAyB,MAAzB,EAAiC,uCAAjC,EAA0E,KAA1E,EAAiF,KAAjF;AACAW,mBAASjC,OAAT,CAAiBuL,KAAjB;AACD;AAVuC,OAA1C;AAYA,aAAOtJ,SAAS+B,OAAhB;AACD,KAtBD;;AAwBArF,SAAK8M,qBAAL,GAA6B,UAASC,SAAT,EAAoBC,YAApB,EAAkC;AAC7D,UAAI1J,WAAW7D,GAAG8D,KAAH,EAAf;AACA,UAAGyJ,iBAAiB,iBAApB,EAAuC;AACrC1J,iBAASjC,OAAT,CAAiB,KAAjB;AACD,OAFD,MAEO;AACL,YAAI4L,wBAAwB,EAA5B;AACA,YAAIC,+BAA+B,EAAnC;AACA;AACA,YAAItJ,WAAW,YAAUmJ,SAAzB;AACAnJ,oBAAY,iBAAZ;AACA,YAAIM,QAAQ,IAAIxE,aAAayE,UAAjB,EAAZ;AACAD,cAAME,QAAN,CAAe,aAAf,EAA8B,4CAA9B;AACAF,cAAME,QAAN,CAAe,YAAf,EAA6BR,QAA7B;AACAM,cAAMI,MAAN,CAAa,MAAb,EAAqB,mBAArB,EAA0C;AACxCC,qBAAW,UAASC,MAAT,EAAgB;AACzB,gBAAGrF,QAAQgE,QAAR,CAAiBqB,OAAOC,OAAxB,CAAH,EAAoC;AAClC,kBAAIC,OAAOC,SAAP,CAAiBC,QAAjB,CAA0BC,IAA1B,CAAgCL,OAAOC,OAAP,CAAeK,GAA/C,MAAyD,gBAA7D,EAAgF;AAC9E,oBAAIC,iBAAiBP,OAAOC,OAAP,CAAeK,GAAf,CAAmBE,MAAxC;AACA;AACA,qBAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAIF,cAApB,EAAoCE,GAApC,EAAyC;AACvCgI,wCAAsB/H,IAAtB,CAA2BV,OAAOC,OAAP,CAAeK,GAAf,CAAmBG,CAAnB,CAA3B;AACD;AACF,eAND,MAMO;AACLgI,sCAAsB/H,IAAtB,CAA2BV,OAAOC,OAAP,CAAeK,GAA1C;AACD;AACD;AACA3F,sBAAQ4G,OAAR,CAAgBkH,qBAAhB,EAAuC,UAASE,OAAT,EAAkBC,OAAlB,EAA0B;AAC/DH,sCAAsBG,OAAtB,EAA+BC,gBAA/B,GAAkD,EAAlD;AACA,oBAAGF,QAAQG,gBAAR,KAA6B,GAAhC,EAAoC;AAClC,sBAAIC,0BAA0B,EAA9B;AACA;AACA,sBAAI3J,WAAW,YAAUuJ,QAAQK,UAAjC;AACA,sBAAItJ,QAAQ,IAAIxE,aAAayE,UAAjB,EAAZ;AACAD,wBAAME,QAAN,CAAe,aAAf,EAA8B,6CAA9B;AACAF,wBAAME,QAAN,CAAe,YAAf,EAA6BR,QAA7B;AACAM,wBAAMI,MAAN,CAAa,MAAb,EAAqB,mBAArB,EAA0C;AACxCC,+BAAW,UAASC,MAAT,EAAgB;AACzB,0BAAGrF,QAAQgE,QAAR,CAAiBqB,OAAOC,OAAxB,CAAH,EAAoC;AAClC,4BAAIC,OAAOC,SAAP,CAAiBC,QAAjB,CAA0BC,IAA1B,CAAgCL,OAAOC,OAAP,CAAeK,GAA/C,MAAyD,gBAA7D,EAAgF;AAC9E,8BAAIC,iBAAiBP,OAAOC,OAAP,CAAeK,GAAf,CAAmBE,MAAxC;AACA;AACA,+BAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAIF,cAApB,EAAoCE,GAApC,EAAyC;AACvCsI,oDAAwBrI,IAAxB,CAA6BV,OAAOC,OAAP,CAAeK,GAAf,CAAmBG,CAAnB,CAA7B;AACD;AACF,yBAND,MAMO;AACLsI,kDAAwBrI,IAAxB,CAA6BV,OAAOC,OAAP,CAAeK,GAA5C;AACD;AACF;AACDmI,4CAAsBG,OAAtB,EAA+BC,gBAA/B,GAAiDrN,KAAKyN,yBAAL,CAA+BF,uBAA/B,CAAjD;AACD,qBAduC;AAexCpI,+BAAW,UAASxC,KAAT,EAAe;AACxB5C,iCAAWyF,MAAX,CAAkB7C,KAAlB,EAAyB,MAAzB,EAAiC,+DAAjC,EAAkG,KAAlG,EAAyG,KAAzG;AACD;AAjBuC,mBAA1C;AAmBD;AACF,eA7BD;AA8BD;;AAED,gBAAGsK,sBAAsBjI,MAAtB,KAAiC,CAApC,EAAsC;AACpC1B,uBAASjC,OAAT,CAAiB,KAAjB;AACD,aAFD,MAEO;AACL6L,6CAA+BlN,KAAKyN,yBAAL,CAA+BR,qBAA/B,CAA/B;AACA3J,uBAASjC,OAAT,CAAiB6L,4BAAjB;AACD;AACF,WAnDuC;AAoDxC/H,qBAAW,UAASxC,KAAT,EAAe;AACxB5C,uBAAWyF,MAAX,CAAkB7C,KAAlB,EAAyB,MAAzB,EAAiC,0CAAjC,EAA6E,KAA7E,EAAoF,KAApF;AACAW,qBAASjC,OAAT,CAAiB,KAAjB;AACD;AAvDuC,SAA1C;AAyDD;AACD,aAAOiC,SAAS+B,OAAhB;AACD,KAxED;;AA0EArF,SAAK0N,qBAAL,GAA6B,UAASX,SAAT,EAAoBC,YAApB,EAAkC;AAC7D,UAAI1J,WAAW7D,GAAG8D,KAAH,EAAf;AACA,UAAGyJ,iBAAiB,iBAApB,EAAuC;AACrC1J,iBAASjC,OAAT,CAAiB,KAAjB;AACD,OAFD,MAEO;AACL,YAAI4L,wBAAwB,EAA5B;AACA,YAAIC,+BAA+B,EAAnC;AACA;AACA,YAAItJ,WAAW,YAAUmJ,SAAzB;AACAnJ,oBAAY,gBAAZ;AACA,YAAIM,QAAQ,IAAIxE,aAAayE,UAAjB,EAAZ;AACAD,cAAME,QAAN,CAAe,aAAf,EAA8B,4CAA9B;AACAF,cAAME,QAAN,CAAe,YAAf,EAA6BR,QAA7B;AACAM,cAAMI,MAAN,CAAa,MAAb,EAAqB,mBAArB,EAA0C;AACxCC,qBAAW,UAASC,MAAT,EAAgB;AACzB,gBAAGrF,QAAQgE,QAAR,CAAiBqB,OAAOC,OAAxB,CAAH,EAAoC;AAClC,kBAAIC,OAAOC,SAAP,CAAiBC,QAAjB,CAA0BC,IAA1B,CAAgCL,OAAOC,OAAP,CAAeK,GAA/C,MAAyD,gBAA7D,EAAgF;AAC9E,oBAAIC,iBAAiBP,OAAOC,OAAP,CAAeK,GAAf,CAAmBE,MAAxC;AACA;AACA,qBAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAIF,cAApB,EAAoCE,GAApC,EAAyC;AACvCgI,wCAAsB/H,IAAtB,CAA2BV,OAAOC,OAAP,CAAeK,GAAf,CAAmBG,CAAnB,CAA3B;AACD;AACF,eAND,MAMO;AACLgI,sCAAsB/H,IAAtB,CAA2BV,OAAOC,OAAP,CAAeK,GAA1C;AACD;AACF;AACD,gBAAGmI,sBAAsBjI,MAAtB,KAAiC,CAApC,EAAsC;AACpC1B,uBAASjC,OAAT,CAAiB,KAAjB;AACD,aAFD,MAEO;AACL6L,6CAA+BlN,KAAK2N,yBAAL,CAA+BV,qBAA/B,CAA/B;AACA3J,uBAASjC,OAAT,CAAiB6L,4BAAjB;AACD;AACF,WAnBuC;AAoBxC/H,qBAAW,UAASxC,KAAT,EAAe;AACxB5C,uBAAWyF,MAAX,CAAkB7C,KAAlB,EAAyB,MAAzB,EAAiC,0CAAjC,EAA6E,KAA7E,EAAoF,KAApF;AACAW,qBAASjC,OAAT,CAAiB,KAAjB;AACD;AAvBuC,SAA1C;AAyBD;AACD,aAAOiC,SAAS+B,OAAhB;AACD,KAxCD;;AA0CA;AACArF,SAAKyN,yBAAL,GAAiC,UAASG,WAAT,EAAqB;AACpD,UAAIC,cAAc,EAAlB;AACAA,kBAAY9L,MAAZ,GAAqB,EAArB;AACA8L,kBAAYlM,QAAZ,GAAuB,qBAAvB;AACAkM,kBAAYzH,OAAZ,GAAsB,0BAAtB;AACAyH,kBAAYC,UAAZ,GAAyB,GAAzB;AACAD,kBAAYE,WAAZ,GAA0B,GAA1B;AACAF,kBAAYxH,IAAZ,GAAmB,2BAAnB;AACAwH,kBAAYnH,OAAZ,GAAsB,EAAtB;AACAvH,cAAQ4G,OAAR,CAAgB6H,WAAhB,EAA6B,UAASI,UAAT,EAAqBC,UAArB,EAAgC;AAC3D,YAAIC,SAAS,EAAb;AACAA,eAAOpH,MAAP,GAAgBkH,WAAWR,UAA3B;AACAU,eAAOnH,MAAP,GAAgBiH,WAAWG,WAA3B;AACAD,eAAOE,gBAAP,GAA0BJ,UAA1B;AACAH,oBAAY9L,MAAZ,CAAmBmM,OAAOpH,MAA1B,IAAoCoH,MAApC;AACAL,oBAAYnH,OAAZ,CAAoBxB,IAApB,CAAyBgJ,MAAzB;AACD,OAPD;AAQA,aAAOL,WAAP;AACD,KAlBD;;AAoBA;AACA7N,SAAK2N,yBAAL,GAAiC,UAASC,WAAT,EAAqB;AACpD,UAAIC,cAAc,EAAlB;AACAA,kBAAY9L,MAAZ,GAAqB,EAArB;AACA8L,kBAAYlM,QAAZ,GAAuB,qBAAvB;AACAkM,kBAAYzH,OAAZ,GAAsB,0BAAtB;AACAyH,kBAAYC,UAAZ,GAAyB,GAAzB;AACAD,kBAAYE,WAAZ,GAA0B,GAA1B;AACAF,kBAAYxH,IAAZ,GAAmB,2BAAnB;AACAwH,kBAAYnH,OAAZ,GAAsB,EAAtB;AACAvH,cAAQ4G,OAAR,CAAgB6H,WAAhB,EAA6B,UAASI,UAAT,EAAqBC,UAArB,EAAgC;AAC3D,YAAIC,SAAS,EAAb;AACAA,eAAOpH,MAAP,GAAgBkH,WAAWR,UAA3B;AACAU,eAAOnH,MAAP,GAAgBiH,WAAWG,WAA3B;AACAD,eAAOE,gBAAP,GAA0BJ,UAA1B;AACAH,oBAAYnH,OAAZ,CAAoBxB,IAApB,CAAyBgJ,MAAzB;AACD,OAND;AAOA,aAAOL,WAAP;AACD,KAjBD;;AAmBA;AACA7N,SAAK8L,gBAAL,GAAwB,UAASuC,KAAT,EAAe;AACrC,UAAIR,cAAc,EAAlB;AACAA,kBAAY9L,MAAZ,GAAqB,EAArB;AACA8L,kBAAYlM,QAAZ,GAAuB,uBAAvB;AACAkM,kBAAYS,YAAZ,GAA2B,sBAA3B;AACAT,kBAAYzH,OAAZ,GAAsB,eAAtB;AACAyH,kBAAYU,aAAZ,GAA4B,GAA5B;AACAV,kBAAYC,UAAZ,GAAyB,GAAzB;AACAD,kBAAYxH,IAAZ,GAAmB,aAAnB;AACAwH,kBAAYnH,OAAZ,GAAsB,EAAtB;AACAvH,cAAQ4G,OAAR,CAAgBsI,KAAhB,EAAuB,UAASG,SAAT,EAAoBC,SAApB,EAA8B;AACnD,YAAIP,SAAS,EAAb;AACAA,eAAOpH,MAAP,GAAgB0H,UAAUE,MAA1B;AACAR,eAAOnH,MAAP,GAAgByH,UAAUG,WAA1B;AACAT,eAAO9B,UAAP,GAAoBoC,SAApB;AACA,YAAGC,cAAc,CAAjB,EAAoB;AAClBZ,sBAAY3H,YAAZ,GAA2BgI,OAAOpH,MAAlC;AACD,SAFD,MAEO,IAAI0H,UAAUE,MAAV,KAAqB1O,KAAKI,MAA9B,EAAsC;AAC3CyN,sBAAY3H,YAAZ,GAA2BgI,OAAOpH,MAAlC;AACD;AACD+G,oBAAYnH,OAAZ,CAAoBxB,IAApB,CAAyBgJ,MAAzB;AACD,OAXD;AAYA,aAAOL,WAAP;AACD,KAvBD;;AAyBA;AACA7N,SAAK4O,cAAL,GAAsB,UAASC,GAAT,EAAa;AACjC,UAAIvL,WAAW7D,GAAG8D,KAAH,EAAf;AACA,UAAIK,WAAW,SAAOiL,GAAtB;AACA,UAAI3K,QAAQ,IAAIxE,aAAayE,UAAjB,EAAZ;AACAD,YAAME,QAAN,CAAe,aAAf,EAA8B,oCAA9B;AACAF,YAAME,QAAN,CAAe,YAAf,EAA6BR,QAA7B;AACAM,YAAMI,MAAN,CAAa,MAAb,EAAqB,mBAArB,EAA0C;AACxCC,mBAAW,UAASC,MAAT,EAAgB;AACzB,cAAIsK,YAAY,EAAhB;AACA,cAAG3P,QAAQgE,QAAR,CAAiBqB,OAAOC,OAAxB,CAAH,EAAoC;AAClC,gBAAIC,OAAOC,SAAP,CAAiBC,QAAjB,CAA0BC,IAA1B,CAAgCL,OAAOC,OAAP,CAAeK,GAA/C,MAAyD,gBAA7D,EAAgF;AAC9E,kBAAIC,iBAAiBP,OAAOC,OAAP,CAAeK,GAAf,CAAmBE,MAAxC;AACA;AACA,mBAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAIF,cAApB,EAAoCE,GAApC,EAAyC;AACvC6J,0BAAU5J,IAAV,CAAeV,OAAOC,OAAP,CAAeK,GAAf,CAAmBG,CAAnB,CAAf;AACD;AACF,aAND,MAMO;AACL6J,wBAAU5J,IAAV,CAAeV,OAAOC,OAAP,CAAeK,GAA9B;AACD;AACF;AACDxB,mBAASjC,OAAT,CAAiByN,SAAjB;AACD,SAfuC;AAgBxC3J,mBAAW,UAASxC,KAAT,EAAe;AACxB5C,qBAAWyF,MAAX,CAAkB7C,KAAlB,EAAyB,OAAzB,EAAkC,mCAAlC,EAAuE,KAAvE,EAA8E,KAA9E;AACAW,mBAAS8B,MAAT,CAAgBzC,KAAhB;AACD;AAnBuC,OAA1C;AAqBA,aAAOW,SAAS+B,OAAhB;AACD,KA5BD;;AA8BA;AACArF,SAAK+O,SAAL,GAAiB,UAASC,OAAT,EAAkB;AACjC,UAAG7P,QAAQ+D,SAAR,CAAkB8L,QAAQ5C,UAAR,CAAmBC,KAArC,KAA+C4C,WAAWD,QAAQ5C,UAAR,CAAmBC,KAA9B,EAAqC6C,OAArC,CAA6C,CAA7C,IAAkD,CAApG,EAAuG;AACrGlP,aAAKmP,QAAL,CAAcC,MAAd,CAAqBC,YAArB,GAAoCL,QAAQ5C,UAAR,CAAmBC,KAAvD;AACD,OAFD,MAEO;AACLrM,aAAKmP,QAAL,CAAcC,MAAd,CAAqBC,YAArB,GAAoC,MAApC;AACD;AACD,UAAGlQ,QAAQ+D,SAAR,CAAkB8L,QAAQ5C,UAAR,CAAmBkD,UAArC,KAAoDL,WAAWD,QAAQ5C,UAAR,CAAmBkD,UAA9B,EAA0CJ,OAA1C,CAAkD,CAAlD,IAAuD,CAA9G,EAAiH;AAC/GlP,aAAKmP,QAAL,CAAcC,MAAd,CAAqBG,gBAArB,GAAwCP,QAAQ5C,UAAR,CAAmBkD,UAA3D;AACD,OAFD,MAEO;AACLtP,aAAKmP,QAAL,CAAcC,MAAd,CAAqBG,gBAArB,GAAwC,MAAxC;AACD;AACDvP,WAAKmP,QAAL,CAAcC,MAAd,CAAqBI,KAArB,GAA6B,CAACP,WAAWjP,KAAKmP,QAAL,CAAcC,MAAd,CAAqBK,KAAhC,IAAyCR,WAAWjP,KAAKmP,QAAL,CAAcC,MAAd,CAAqBM,aAAhC,CAAzC,GAA0FT,WAAWjP,KAAKmP,QAAL,CAAcC,MAAd,CAAqBO,QAAhC,CAA1F,GAAsIV,WAAWjP,KAAKmP,QAAL,CAAcC,MAAd,CAAqBC,YAAhC,CAAvI,EAAsLH,OAAtL,CAA8L,CAA9L,CAA7B;AACD,KAZD;;AAcA;AACAlP,SAAK4P,eAAL,GAAuB,YAAW;AAChC,UAAIC,wBAAwB,CAA5B;AACA,UAAIC,yBAAyB,CAA7B;AACA,UAAIC,mBAAmB,CAAvB;AACA,UAAIC,oBAAoB,CAAxB;;AAEA;AACA,UAAIC,OAAOvL,OAAOuL,IAAP,CAAYjQ,KAAKU,YAAjB,CAAX;AACA,UAAIwP,cAAcD,KAAKjL,MAAL,GAAc,CAAhC;;AAEA7F,cAAQ4G,OAAR,CAAgB/F,KAAKU,YAAL,CAAkBwP,WAAlB,EAA+BC,SAA/C,EAA0D,UAAStC,WAAT,EAAqB;AAC7E,YAAGA,YAAYtG,MAAZ,KAAwB,SAA3B,EAAsC;AACpCpI,kBAAQ4G,OAAR,CAAgB8H,YAAY9L,MAA5B,EAAoC,UAASqO,YAAT,EAAuBC,YAAvB,EAAoC;AACtE,gBAAGD,aAAatJ,MAAb,KAAwBuJ,YAA3B,EAAwC;AACtC,kBAAIC,eAAe,MAAnB;AACA,kBAAIC,UAAU,MAAd;AACA,kBAAGpR,QAAQ+D,SAAR,CAAkBkN,aAAahC,gBAAb,CAA8BoC,UAAhD,CAAH,EAA+D;AAC7DF,+BAAeF,aAAahC,gBAAb,CAA8BoC,UAA7C;AACD;AACD,kBAAGrR,QAAQ+D,SAAR,CAAkBkN,aAAahC,gBAAb,CAA8BqC,mBAAhD,CAAH,EAAwE;AACtEF,0BAAUH,aAAahC,gBAAb,CAA8BqC,mBAAxC;AACD;AACDX,uCAAyB,CAACb,WAAWa,sBAAX,IAAqCb,WAAWqB,YAAX,CAAtC,EAAgEpB,OAAhE,CAAwE,CAAxE,CAAzB;AACAW,sCAAwB,CAACZ,WAAWY,qBAAX,IAAoCZ,WAAWsB,OAAX,CAArC,EAA0DrB,OAA1D,CAAkE,CAAlE,CAAxB;AACD;AACF,WAbD;AAcAlP,eAAKmP,QAAL,CAAcC,MAAd,CAAqBM,aAArB,GAAqCI,sBAArC;AACA9P,eAAKmP,QAAL,CAAcC,MAAd,CAAqBsB,iBAArB,GAAyCb,qBAAzC;AACD;AACD,YAAGhC,YAAYtG,MAAZ,KAAuB,SAA1B,EAAoC;AAClCpI,kBAAQ4G,OAAR,CAAgB8H,YAAY9L,MAA5B,EAAoC,UAASqO,YAAT,EAAuBC,YAAvB,EAAoC;AACtE,gBAAGlR,QAAQgE,QAAR,CAAiBiN,YAAjB,CAAH,EAAkC;AAChC,kBAAIO,UAAU,MAAd;AACA,kBAAIC,SAAS,MAAb;AACA,kBAAGzR,QAAQ+D,SAAR,CAAkBkN,aAAa/D,KAA/B,CAAH,EAAyC;AACvCsE,0BAAUP,aAAa/D,KAAvB;AACD;AACD,kBAAGlN,QAAQ+D,SAAR,CAAkBkN,aAAaK,mBAA/B,CAAH,EAAuD;AACrDG,yBAASR,aAAaK,mBAAtB;AACD;AACDT,kCAAoB,CAACf,WAAWe,iBAAX,IAAgCf,WAAW0B,OAAX,CAAjC,EAAsDzB,OAAtD,CAA8D,CAA9D,CAApB;AACAa,iCAAmB,CAACd,WAAWc,gBAAX,IAA+Bd,WAAW2B,MAAX,CAAhC,EAAoD1B,OAApD,CAA4D,CAA5D,CAAnB;AACD;AACF,WAbD;AAcAlP,eAAKmP,QAAL,CAAcC,MAAd,CAAqBO,QAArB,GAAgCK,iBAAhC;AACAhQ,eAAKmP,QAAL,CAAcC,MAAd,CAAqByB,YAArB,GAAoCd,gBAApC;AACD;AACF,OArCD;AAsCA,UAAG5Q,QAAQ+D,SAAR,CAAkBlD,KAAKmP,QAAvB,KAAoChQ,QAAQ+D,SAAR,CAAkBlD,KAAKmP,QAAL,CAAcC,MAAhC,CAAvC,EAA+E;AAC7EpP,aAAKmP,QAAL,CAAcC,MAAd,CAAqB0B,mBAArB,GAA2C,CAAC7B,WAAWa,sBAAX,IAAqCb,WAAWe,iBAAX,CAArC,GAAqEf,WAAWjP,KAAKmP,QAAL,CAAcC,MAAd,CAAqBK,KAAhC,CAAtE,EAA8GP,OAA9G,CAAsH,CAAtH,CAA3C;AACAlP,aAAKmP,QAAL,CAAcC,MAAd,CAAqB2B,kBAArB,GAA0C,CAAC9B,WAAWY,qBAAX,IAAoCZ,WAAWc,gBAAX,CAArC,EAAmEb,OAAnE,CAA2E,CAA3E,CAA1C;AACAlP,aAAKmP,QAAL,CAAcC,MAAd,CAAqBI,KAArB,GAA6B,CAACP,WAAWjP,KAAKmP,QAAL,CAAcC,MAAd,CAAqBK,KAAhC,IAAyCR,WAAWjP,KAAKmP,QAAL,CAAcC,MAAd,CAAqBM,aAAhC,CAAzC,GAA0FT,WAAWjP,KAAKmP,QAAL,CAAcC,MAAd,CAAqBO,QAAhC,CAA1F,GAAsIV,WAAWjP,KAAKmP,QAAL,CAAcC,MAAd,CAAqBC,YAAhC,CAAvI,EAAsLH,OAAtL,CAA8L,CAA9L,CAA7B;AACAlP,aAAKmP,QAAL,CAAcC,MAAd,CAAqB4B,SAArB,GAAiC,CAAC/B,WAAWjP,KAAKmP,QAAL,CAAcC,MAAd,CAAqB2B,kBAAhC,IAAuD9B,WAAWjP,KAAKmP,QAAL,CAAcC,MAAd,CAAqBG,gBAAhC,CAAxD,EAA2GL,OAA3G,CAAmH,CAAnH,CAAjC;AACD;AACF,KAtDD;;AAwDA;AACAlP,SAAKiR,UAAL,GAAkB,UAAUC,KAAV,EAAiBC,MAAjB,EAAyBC,QAAzB,EAAmC;AACnDpR,WAAKC,WAAL,GAAmB,IAAnB;AACA,UAAImR,SAAShQ,IAAT,GAAgB,QAApB,EAA8B;AAC5B,YAAIiQ,YAAY,WAASD,SAAS5I,IAAlB,GAAuB,eAAvC;AACA,YAAI5F,gBAAgB,SAApB;AACA,YAAIC,gBAAgB,WAASuO,SAAS5I,IAAlB,GAAuB,eAA3C;AACA,YAAI1F,iBAAiB,oBAArB;AACA/C,mBAAWgD,SAAX,CAAqBH,aAArB,EAAoCC,aAApC,EAAmDC,cAAnD;;AAEAqO,eAAOG,KAAP;AACD;AACF,KAXD;;AAaA;AACAtR,SAAKuR,UAAL,GAAkB,UAASL,KAAT,EAAgBC,MAAhB,EAAwBK,QAAxB,EAAkCC,IAAlC,EAAuC;AACvDzR,WAAKC,WAAL,GAAmB,KAAnB;AACD,KAFD;;AAIA,WAAOD,IAAP;AACD;AACF,CA/sCA,GAAD","file":"wizard.data.service.js","sourcesContent":["(function (){\r\n  'use strict';\r\n  angular\r\n    .module('swSelfService')\r\n    .service('WizardDataService', WizardDataService);\r\n\r\n  WizardDataService.$inject=['$rootScope','$q', 'XMLMCService','WizardFilterService','store','wssHelpers','$uibModal','wssLogging'];\r\n  function WizardDataService($rootScope, $q, XMLMCService, WizardFilterService, store, wssHelpers, $uibModal, wssLogging) {\r\n\r\n    var self = {\r\n      addingFiles: false,\r\n      isWssAdmin: wssHelpers.hasWebflag('OPTION_ADMIN'),\r\n      defSLA: 0, //This is the SLA that we select as default, when more than one SLA is presented via the Dataform\r\n      ciPicker: {\r\n        tabSet: {\r\n          'Your Services':'servyour',\r\n          'All Services': 'servall',\r\n          'Assets You Use': 'ciuse',\r\n          'Assets You Own': 'ciown'\r\n        },\r\n        loadingItems: false,\r\n        ciArray: [],\r\n        outputConfigObject: [],\r\n      },\r\n      wizardStages: {}\r\n    };\r\n\r\n    self.openTableAdminModal = function(){\r\n      $rootScope.adminModalSchema = 'table.schema';\r\n      $rootScope.adminModalContent = 'table.ci.picker.'+self.ciPicker.currListType;\r\n      var modalInstance = $uibModal.open({\r\n        animation: true,\r\n        templateUrl: 'templates/admin/modal.tableconfig.tpl.html',\r\n        controller: 'AdminTableController',\r\n        size: 'lg',\r\n        resolve: {\r\n          items: function () {\r\n            return '';\r\n          }\r\n        }\r\n      });\r\n      modalInstance.result.then(function () {\r\n        //Saved changes - broadcast message to refresh form\r\n        $rootScope.adminModalSchema = '';\r\n        $rootScope.adminModalContent = '';\r\n        self.ciPicker.setCIListSelect(self.ciPicker.currListType, false);\r\n      }, function (){\r\n        //Cancelled modal`\r\n      });\r\n    };\r\n\r\n    //Setup Modal for CI selector\r\n    self.ciPicker.openCIModal = function(question, size) {\r\n      self.custDetails = store.get('custDetails');\r\n      //self.instanceConfig = store.get('instanceConfig');\r\n      var modalInstance = $uibModal.open({\r\n        animation: true,\r\n        templateUrl: 'templates/wizard/wizard.custompicker.ci.modal.tpl.html',\r\n        controller: 'ModalCIPickerCtrl',\r\n        size: size,\r\n        resolve: {\r\n          items: function () {\r\n            return question;\r\n          }\r\n        }\r\n      });\r\n\r\n      modalInstance.result.then(function (selectedItems) {\r\n        question.answer = selectedItems;\r\n      }, function () {\r\n        //Modal Dismissed, don't do anything!\r\n      });\r\n    };\r\n\r\n    self.ciPicker.setOrder = function(oColumn, oIndex){\r\n      self.ciPicker[self.ciPicker.currListType].sortColumn = oIndex;\r\n      self.ciPicker[self.ciPicker.currListType].sortOrder = !self.ciPicker[self.ciPicker.currListType].sortOrder;\r\n      var strSortOrder = (self.ciPicker[self.ciPicker.currListType].sortOrder ? 'ASC' : 'DESC');\r\n      self.ciPicker[self.ciPicker.currListType].outputConfigObject.outputOrderBy = oColumn.dbtable +'.'+oColumn.column+' '+strSortOrder;\r\n      self.ciPicker.getCIs().then(function(response){\r\n        self.ciPicker[self.ciPicker.currListType].ciArray = response;\r\n        self.ciPicker.loadingItems = false;\r\n      }, function(error){\r\n        self.ciPicker.loadingItems = false;\r\n        var connErrorType = 'error';\r\n        var connErrorBody = 'The following error was returned when attempting to return your list of Assets or Services: '+error;\r\n        var connErrorTitle = 'CI Search Error!';\r\n        wssLogging.sendToast(connErrorType, connErrorBody, connErrorTitle);\r\n      });\r\n    };\r\n\r\n    self.ciPicker.setCIListSelect = function(servList, boolSkipConfig){\r\n      if(!angular.isDefined(boolSkipConfig)){\r\n        boolSkipConfig = true;\r\n      }\r\n      self.ciPicker.loadingItems = true;\r\n      self.ciPicker.currListType = servList;\r\n      if(angular.isDefined(self.ciPicker[servList]) && angular.isObject(self.ciPicker[servList].outputConfigObject) && boolSkipConfig === true) {\r\n        //We've already got the config object - no need to re-query it, just get the CIs\r\n        self.ciPicker.getCIs().then(function(response){\r\n          self.ciPicker[self.ciPicker.currListType].ciArray = response;\r\n          self.ciPicker.loadingItems = false;\r\n        }, function(error){\r\n          self.ciPicker.loadingItems = false;\r\n          var connErrorType = 'error';\r\n          var connErrorBody = 'The following error was returned when attempting to return your list of Assets or Services: '+error;\r\n          var connErrorTitle = 'CI Search Error!';\r\n          wssLogging.sendToast(connErrorType, connErrorBody, connErrorTitle);\r\n        });\r\n      } else {\r\n        self.ciPicker[servList] = {};\r\n        //Get config, call API to get item array, then populate ciArray\r\n        var ciConfSetting = 'table.ci.picker.'+servList;\r\n        wssHelpers.getTableConfig(ciConfSetting).then(function(response){\r\n          self.ciPicker[self.ciPicker.currListType].outputConfigObject = response;\r\n          self.ciPicker.getCIs().then(function(response){\r\n            self.ciPicker[self.ciPicker.currListType].ciArray = response;\r\n            self.ciPicker.loadingItems = false;\r\n          }, function(error){\r\n            self.ciPicker.loadingItems = false;\r\n            var connErrorType = 'error';\r\n            var connErrorBody = 'The following error was returned when attempting to return your list of Assets or Services: '+error;\r\n            var connErrorTitle = 'CI Search Error!';\r\n            wssLogging.sendToast(connErrorType, connErrorBody, connErrorTitle);\r\n          });\r\n          //Now, go get the CI's to populate the table with\r\n        }, function(error){\r\n          self.ciPicker.loadingItems = false;\r\n          var connErrorType = 'error';\r\n          var connErrorBody = 'The following error was returned when attempting to retrieve the Asset table configuration: '+error;\r\n          var connErrorTitle = 'Table Configuration Error!';\r\n          wssLogging.sendToast(connErrorType, connErrorBody, connErrorTitle);\r\n        });\r\n      }\r\n    };\r\n\r\n    self.ciPicker.getCIs = function() {\r\n      var deferred = $q.defer();\r\n      //Work out columns.\r\n      if(!angular.isDefined(self.ciPicker[self.ciPicker.currListType].outputConfigObject.strAddTables)){\r\n        self.ciPicker[self.ciPicker.currListType].outputConfigObject.strAddTables = wssHelpers.processAdditionalTables(self.ciPicker[self.ciPicker.currListType].outputConfigObject);\r\n      }\r\n      var itemArray = [];\r\n      var strDynFilter = '';\r\n      var sqparams = \"custid=\"+self.custDetails.keysearch;\r\n      sqparams += \"&table=\"+self.ciPicker[self.ciPicker.currListType].outputConfigObject.table;\r\n      sqparams += \"&columns=\"+self.ciPicker[self.ciPicker.currListType].outputConfigObject.outputSQLColumns;\r\n      sqparams += \"&orderby=\"+self.ciPicker[self.ciPicker.currListType].outputConfigObject.outputOrderBy;\r\n      sqparams += \"&appcodefilter=\"+self.ciPicker[self.ciPicker.currListType].outputConfigObject.enableAppcodeFilter;\r\n      sqparams += \"&dynfilter=\"+strDynFilter;\r\n      sqparams += \"&dynfiltercols=\"+self.ciPicker[self.ciPicker.currListType].outputConfigObject.filterSQLColumns;\r\n      sqparams += \"&addtables=\"+self.ciPicker[self.ciPicker.currListType].outputConfigObject.strAddTables;\r\n\r\n      //Now get a page worth of data\r\n      var xmlmc = new XMLMCService.MethodCall();\r\n      xmlmc.addParam(\"storedQuery\", self.ciPicker[self.ciPicker.currListType].outputConfigObject.recordsStoredQuery);\r\n      xmlmc.addParam(\"parameters\", sqparams);\r\n      xmlmc.invoke(\"data\", \"invokeStoredQuery\", {\r\n        onSuccess: function(params){\r\n          if(params.rowData) {\r\n            if( Object.prototype.toString.call( params.rowData.row ) === '[object Array]' ) {\r\n              var intArrayLength = params.rowData.row.length;\r\n              //obj is array\r\n              for (var i = 0; i < intArrayLength; i++) {\r\n                itemArray.push(params.rowData.row[i]);\r\n              }\r\n            } else {\r\n              itemArray.push(params.rowData.row);\r\n            }\r\n          }\r\n          deferred.resolve(itemArray);\r\n        },\r\n        onFailure: function(error){\r\n          deferred.reject(error);\r\n        }\r\n      });\r\n\r\n      return deferred.promise;\r\n    };\r\n\r\n    self.getDataform = function(intDataform) {\r\n      var deferred = $q.defer();\r\n      var sqparams = \"dfid=\"+intDataform;\r\n      var xmlmc = new XMLMCService.MethodCall();\r\n      xmlmc.addParam(\"storedQuery\", \"query/wss/services/services.dataform.get\");\r\n      xmlmc.addParam(\"parameters\", sqparams);\r\n      xmlmc.invoke(\"data\", \"invokeStoredQuery\", {\r\n        onSuccess: function(params){\r\n          if(angular.isObject(params.rowData.row)){\r\n            deferred.resolve(params.rowData.row);\r\n          } else {\r\n            deferred.reject(params);\r\n          }\r\n        },\r\n        onFailure: function(error){\r\n          wssLogging.logger(error, \"ERROR\", \"WizardDataService::getDataform\", false, false);\r\n          deferred.reject(error);\r\n        }\r\n      });\r\n      return deferred.promise;\r\n    };\r\n\r\n    self.getWizard = function(strWizardName) {\r\n      var deferred = $q.defer();\r\n      var sqparams = \"wizardname=\"+strWizardName;\r\n      var xmlmc = new XMLMCService.MethodCall();\r\n      xmlmc.addParam(\"storedQuery\", \"query/wss/wizards/wizard.get.main\");\r\n      xmlmc.addParam(\"parameters\", sqparams);\r\n      xmlmc.invoke(\"data\", \"invokeStoredQuery\", {\r\n        onSuccess: function(params){\r\n          if(angular.isObject(params.rowData.row)){\r\n            deferred.resolve(params.rowData.row);\r\n          } else {\r\n            deferred.reject(params);\r\n          }\r\n        },\r\n        onFailure: function(error){\r\n          wssLogging.logger(error, \"ERROR\", \"WizardDataService::getWizard\", false, false);\r\n          deferred.reject(error);\r\n        }\r\n      });\r\n      return deferred.promise;\r\n    };\r\n\r\n    self.getStageDetails = function(strWizardName, intStage) {\r\n      var deferred = $q.defer();\r\n      var sqparams = \"wizardname=\"+strWizardName;\r\n      sqparams += \"&stage=\"+intStage;\r\n      var xmlmc = new XMLMCService.MethodCall();\r\n      xmlmc.addParam(\"storedQuery\", \"query/wss/wizards/wizard.get.stage\");\r\n      xmlmc.addParam(\"parameters\", sqparams);\r\n      xmlmc.invoke(\"data\", \"invokeStoredQuery\", {\r\n        onSuccess: function(params){\r\n\t\t  if (angular.isObject(params.rowData)){\r\n\t\t\t  if(angular.isObject(params.rowData.row)){\r\n\t\t\t\tdeferred.resolve(params.rowData.row);\r\n\t\t\t  } else {\r\n\t\t\t\tdeferred.reject(params);\r\n\t\t\t  }\r\n\t\t  }\r\n\t\t  else{\r\n\t\t\tvar connErrorType = 'error';\r\n\t\t\tvar connErrorBody = 'This wizard has not been configured correctly. It does not have an identified last stage. Please inform the System Administrator.';\r\n\t\t\tvar connErrorTitle = 'Wizard Configuration Error!';\r\n\t\t\twssLogging.sendToast(connErrorType, connErrorBody, connErrorTitle, false, false);\r\n\t\t  }\r\n        },\r\n        onFailure: function(error){\r\n          deferred.reject(error);\r\n        }\r\n      });\r\n      return deferred.promise;\r\n    };\r\n\r\n    self.getStageQuestions = function(intStage) {\r\n      var deferred = $q.defer();\r\n      var sqparams = \"stage=\"+intStage;\r\n      var xmlmc = new XMLMCService.MethodCall();\r\n      xmlmc.addParam(\"storedQuery\", \"query/wss/wizards/wizard.get.questions\");\r\n      xmlmc.addParam(\"parameters\", sqparams);\r\n      xmlmc.invoke(\"data\", \"invokeStoredQuery\", {\r\n        onSuccess: function(params){\r\n          if(params.rowData) {\r\n            var questionArray = [];\r\n            if( Object.prototype.toString.call( params.rowData.row ) === '[object Array]' ) {\r\n              var intArrayLength = params.rowData.row.length;\r\n              //obj is array\r\n              for (var i = 0; i < intArrayLength; i++) {\r\n                questionArray.push(params.rowData.row[i]);\r\n              }\r\n            } else {\r\n              questionArray.push(params.rowData.row);\r\n            }\r\n\r\n            // Now we have our question array populated, cycle through them and add\r\n            // any applicable options, filters and default value processing  for output\r\n            angular.forEach(questionArray, function(qVal, qKey){\r\n\r\n              //Process default value filtering\r\n              if(angular.isDefined(qVal.defaultvalue) && qVal.defaultvalue !== \"\"){\r\n                questionArray[qKey].defaultvalue = WizardFilterService.processFilter(qVal.defaultvalue, false);\r\n              }\r\n\r\n              //Apply filters to right-hand-side answer summary display\r\n              questionArray[qKey].qfilter = \"\";\r\n              switch(qVal.type) {\r\n                case 'Date':\r\n                  questionArray[qKey].qfilter = \"momentToDate\";\r\n                  break;\r\n                case 'Date Range':\r\n                  questionArray[qKey].qfilter = \"momentToDateRange\";\r\n                  break;\r\n                case 'Selectbox':\r\n                case 'Radiobox':\r\n                case 'Option Selector - Single Select':\r\n                  questionArray[qKey].qfilter = \"optionDisplay\";\r\n                  break;\r\n                case 'Custom Picker':\r\n                  switch(qVal.pickername) {\r\n                    case 'File Attachments':\r\n                      questionArray[qKey].qfilter = \"fileDisplay\";\r\n                      break;\r\n                    case 'Configuration Items':\r\n                      questionArray[qKey].qfilter = \"ciPickerDisplay\";\r\n                      break;\r\n                    default:\r\n                      questionArray[qKey].qfilter = \"optionDisplay\";\r\n                      break;\r\n                  }\r\n                  break;\r\n                case 'Checkbox':\r\n                  questionArray[qKey].qfilter = \"checkboxDisplay\";\r\n                  //Now set a bool value in the question object - this is to track changes to the checkbox value\r\n                  //for when a checkbox is marked as mandatory\r\n                  questionArray[qKey].checked = false;\r\n                  break;\r\n                case 'Textbox':\r\n                  questionArray[qKey].inputtype = 'text';\r\n                  if(angular.isDefined(questionArray[qKey].validation_type)) {\r\n                    switch(questionArray[qKey].validation_type) {\r\n                      case 'Email Address':\r\n                        questionArray[qKey].inputtype = 'email';\r\n                        break;\r\n                      case 'Numeric':\r\n                        questionArray[qKey].inputtype = 'number';\r\n                        break;\r\n                    }\r\n                  }\r\n                  break;\r\n              }\r\n              //END filteredbyDates\r\n\r\n              //Get/populate question options\r\n              questionArray[qKey].options = [];\r\n              if( qVal.type === 'Selectbox' ||\r\n                  qVal.type === 'Radiobox'  ||\r\n                  qVal.type === 'Checkbox'){\r\n\r\n                self.getQuestionOptions(qVal).then(function(respOptions){\r\n                  questionArray[qKey].options = respOptions;\r\n\r\n                  //Cycle through question options, add to answer object if we match default value\r\n                  if( angular.isDefined(questionArray[qKey].defaultvalue) &&\r\n                      questionArray[qKey].defaultvalue !== \"\"){\r\n                    angular.forEach(questionArray[qKey].options, function(qOptVal){\r\n                      if(qOptVal.keycol === questionArray[qKey].defaultvalue){\r\n                        if(qVal.type === 'Checkbox'){\r\n                          questionArray[qKey].answer = {};\r\n                          questionArray[qKey].answer[qOptVal.keycol] = qOptVal.discol;\r\n                        } else {\r\n                          questionArray[qKey].answer = qOptVal;\r\n                        }\r\n                      }\r\n                    });\r\n                  }\r\n                });\r\n              } else if (qVal.type === 'Custom Picker'){\r\n                if(qVal.pickername === 'Customer Organisations' || qVal.pickername === 'All Organisations'){\r\n                  //Get cust Related Organisations\r\n                  self.getOrgs(qVal.pickername).then(function(oOrgs){\r\n                    //Then set picker options\r\n                    questionArray[qKey].options = oOrgs;\r\n                    //Cycle through question options, add to answer object if we match default value\r\n                    if( angular.isDefined(questionArray[qKey].defaultvalue) &&\r\n                        questionArray[qKey].defaultvalue !== \"\"){\r\n                      angular.forEach(questionArray[qKey].options, function(qOptVal){\r\n                        if(qOptVal.keycol === questionArray[qKey].defaultvalue){\r\n                          questionArray[qKey].answer = qOptVal;\r\n                        }\r\n                      });\r\n                    }\r\n                  }, function(error){\r\n                    wssLogging.logger(error, \"ERROR\", \"WizardDataService::getStageQuestions-getOrgs\", false, false);\r\n                  });\r\n                } else if (qVal.pickername === 'Category') {\r\n                  //Get Probcodes\r\n                  self.getProfileTree().then(function(oCodes){\r\n                    //Then set tree data to picker options\r\n                    questionArray[qKey].options = oCodes;\r\n                  }, function(error){\r\n                    wssLogging.logger(error, \"ERROR\", \"WizardDataService::getStageQuestions-getProfileTree\", false, false);\r\n                  });\r\n                } else if (qVal.pickername === 'Configuration Items') {\r\n                  //Set a default value for this isn't going to be easy...\r\n                }\r\n              }\r\n            });\r\n            deferred.resolve(questionArray);\r\n          } else {\r\n            deferred.reject('No Questions Found.');\r\n          }\r\n        },\r\n        onFailure: function(error){\r\n          wssLogging.logger(error, \"ERROR\", \"WizardDataService::getStageQuestions\", false, false);\r\n          deferred.reject(error);\r\n        }\r\n      });\r\n      return deferred.promise;\r\n    };\r\n\r\n    //Get customer specific, or all, organisations\r\n    self.getOrgs = function(strRel) {\r\n      self.custDetails = store.get('custDetails');\r\n      var oOrgs = [];\r\n      var deferred = $q.defer();\r\n      var xmlmc = new XMLMCService.MethodCall();\r\n      if(strRel === \"Customer Organisations\") {\r\n        var sqparams = \"custid=\"+self.custDetails.keysearch;\r\n        xmlmc.addParam(\"storedQuery\", \"query/wss/customer/customer.get.relorgs\");\r\n        xmlmc.addParam(\"parameters\", sqparams);\r\n      } else {\r\n        xmlmc.addParam(\"storedQuery\", \"query/wss/customer/customer.get.allorgs\");\r\n      }\r\n      xmlmc.invoke(\"data\", \"invokeStoredQuery\", {\r\n        onSuccess: function(params){\r\n          if(params.rowData) {\r\n            if( Object.prototype.toString.call( params.rowData.row ) === '[object Array]' ) {\r\n              var intArrayLength = params.rowData.row.length;\r\n              for (var i = 0; i < intArrayLength; i++) {\r\n                oOrgs.push(params.rowData.row[i]);\r\n              }\r\n            } else {\r\n              oOrgs.push(params.rowData.row);\r\n            }\r\n            deferred.resolve(oOrgs);\r\n          }\r\n        },\r\n        onFailure: function(error){\r\n          wssLogging.logger(error, \"ERROR\", \"WizardDataService::getOrgs\", false, false);\r\n          deferred.reject(error);\r\n        }\r\n      });\r\n      return deferred.promise;\r\n    };\r\n\r\n    //Get question options that are hard-coded in the question\r\n    self.getQuestionOptions = function(qObj) {\r\n      var qOptions = [];\r\n      var deferred = $q.defer();\r\n      //Get static question options first\r\n      var sqparams = \"qid=\"+qObj.pk_qid;\r\n      var xmlmc = new XMLMCService.MethodCall();\r\n      xmlmc.addParam(\"storedQuery\", \"query/wss/wizards/wizard.q.options.static\");\r\n      xmlmc.addParam(\"parameters\", sqparams);\r\n      xmlmc.invoke(\"data\", \"invokeStoredQuery\", {\r\n        onSuccess: function(params){\r\n          if(params.rowData) {\r\n            if( Object.prototype.toString.call( params.rowData.row ) === '[object Array]' ) {\r\n              var intArrayLength = params.rowData.row.length;\r\n              //obj is array\r\n              for (var i = 0; i < intArrayLength; i++) {\r\n                qOptions.push(params.rowData.row[i]);\r\n              }\r\n            } else {\r\n              qOptions.push(params.rowData.row);\r\n            }\r\n          }\r\n\r\n          //Now get dynamic wizard options\r\n          if (angular.isDefined(qObj.dbtable) && qObj.dbtable !== \"\" &&\r\n              angular.isDefined(qObj.keycol) && qObj.keycol !== \"\" &&\r\n              angular.isDefined(qObj.txtcol) && qObj.txtcol !== \"\"\r\n            ) {\r\n\r\n            self.getDynamicInputData(qObj).then(function(dynData){\r\n              angular.forEach(dynData, function(dynVal, dynKey){\r\n                qOptions.push(dynVal);\r\n              });\r\n              deferred.resolve(qOptions);\r\n            });\r\n          } else {\r\n              deferred.resolve(qOptions);\r\n          }\r\n        },\r\n        onFailure: function(error){\r\n          wssLogging.logger(error, \"ERROR\", \"WizardDataService::getQuestionOptions\", false, false);\r\n          deferred.reject(error);\r\n        }\r\n      });\r\n      return deferred.promise;\r\n    };\r\n\r\n    //Get dynamic input data from given table/keycol/discol/filter\r\n    self.getDynamicInputData = function(qObj, strSelector){\r\n      var qOptions = [];\r\n      var deferred = $q.defer();\r\n      var sqparams = \"\";\r\n      var xmlmc = new XMLMCService.MethodCall();\r\n      sqparams += \"qtable=\"+qObj.dbtable;\r\n      sqparams += \"&qkeycol=\"+qObj.keycol;\r\n      //Add display column if exists\r\n      if(angular.isDefined(qObj.txtcol) && qObj.txtcol !== \"\"){\r\n        sqparams += \"&qdiscol=\"+qObj.txtcol;\r\n      }\r\n      if(angular.isDefined(qObj.filter) && qObj.filter !== \"\"){\r\n        //Process provided question filter\r\n        var strQFilter = WizardFilterService.processFilter(qObj.filter, true);\r\n        strQFilter = xmlmc.encodeBase64(strQFilter);\r\n        sqparams += \"&qfilter=\"+strQFilter;\r\n      }\r\n\r\n      xmlmc.addParam(\"storedQuery\", \"query/wss/wizards/wizard.q.options.dynamic\");\r\n      xmlmc.addParam(\"parameters\", sqparams);\r\n      xmlmc.invoke(\"data\", \"invokeStoredQuery\", {\r\n        onSuccess: function(params){\r\n          if(params.rowData) {\r\n            if( Object.prototype.toString.call( params.rowData.row ) === '[object Array]' ) {\r\n              var intArrayLength = params.rowData.row.length;\r\n              for (var i = 0; i < intArrayLength; i++) {\r\n                qOptions.push(params.rowData.row[i]);\r\n              }\r\n            } else {\r\n              qOptions.push(params.rowData.row);\r\n            }\r\n            deferred.resolve(qOptions);\r\n          }\r\n        },\r\n        onFailure: function(error){\r\n          wssLogging.logger(error, \"ERROR\", \"WizardDataService::getDynamicInputData\", false, false);\r\n          deferred.reject(error);\r\n        }\r\n      });\r\n      return deferred.promise;\r\n    };\r\n\r\n    //Get treeview data for Profile Code\r\n    self.getProfileTree = function() {\r\n      self.wssConfig = store.get('wssConfig');\r\n      var deferred = $q.defer();\r\n      self.treeData = [];\r\n      var xmlmc = new XMLMCService.MethodCall();\r\n      xmlmc.addParam(\"returnFullTree\", \"true\");\r\n      xmlmc.invoke(\"selfservice\", \"customerGetProfileCodeTree\", {\r\n        onSuccess: function(response){\r\n          var catList = [];\r\n          var inCatList = {};\r\n          angular.forEach(response.ProfileChildNode, function(prVal, prKey){\r\n\r\n            //Make all the levels available\r\n\r\n            // var arrCatLevels = prVal.name.split(' -> ');\r\n            // if(arrCatLevels.length <= self.wssConfig.logprofilelevels){\r\n            //   inCatList[prVal.name] = prVal;\r\n            // }\r\n            inCatList[prVal.name] = prVal;\r\n          });\r\n          //Cycle through each of the objects in the response, building the catalog tree data\r\n          angular.forEach(inCatList, function(value, currTreeKey){\r\n            //Split catType in to array\r\n            var arrCatType = value.name.split(' -> ');\r\n            //Make all children available too\r\n            // if(arrCatType.length <= self.wssConfig.logprofilelevels){\r\n              var strCurrentCat = \"\";\r\n              self.parentId = \"\";\r\n              //Move through each category level, setting up the flat tree data array\r\n              angular.forEach(arrCatType, function(catType, catKey){\r\n                var currCat = {};\r\n                if(catKey !== 0){\r\n                  strCurrentCat += \" -> \";\r\n                }\r\n                strCurrentCat += catType;\r\n                currCat.id = strCurrentCat;\r\n                currCat.parentlabel = self.parentId;\r\n                currCat.name = catType;\r\n                currCat.swValue = inCatList[strCurrentCat].code;\r\n                catList.push(currCat);\r\n                self.parentId = catType;\r\n              });\r\n            //}\r\n          });\r\n          //Unflatten treeview data, and return;\r\n          self.treeData = wssHelpers.unflattenTreeview(catList, 'name');\r\n          deferred.resolve(self.treeData);\r\n        },\r\n        onFailure: function(error){\r\n          wssLogging.logger(error, \"ERROR\", \"WizardDataService::getProfileTree\", false, false);\r\n          deferred.reject(error);\r\n        }\r\n      });\r\n      return deferred.promise;\r\n    };\r\n\r\n    //Take selected probcode, populate question answer\r\n    self.probcodeSelected = function(objItems){\r\n      var objAnswer = [];\r\n      if(angular.isDefined(objItems)){\r\n        objAnswer.keycol = objItems[0].swValue;\r\n        objAnswer.discol = objItems[0].id;\r\n      }\r\n      //If we con't have a keycol selected,\r\n      if(!angular.isDefined(objAnswer.keycol)){\r\n        return '';\r\n      }\r\n      return objAnswer;\r\n    };\r\n\r\n    //Take selected option, populate question answer\r\n    self.optionSelected = function(objItems){\r\n      var objAnswer = [];\r\n      if(angular.isDefined(objItems)){\r\n        objAnswer.keycol = objItems[0].id;\r\n        objAnswer.discol = objItems[0].name;\r\n      }\r\n      //If we con't have a keycol selected,\r\n      if(!angular.isDefined(objAnswer.keycol)){\r\n        return '';\r\n      }\r\n      return objAnswer;\r\n    };\r\n\r\n    //Take selected option(s), populate question answer\r\n    self.multiOptionSelected = function(objItems){\r\n      var strAnswer = '';\r\n      angular.forEach(objItems, function(itemVal){\r\n        if(strAnswer !== '') strAnswer += ', ';\r\n        strAnswer += itemVal.swname;\r\n      });\r\n      return strAnswer;\r\n    };\r\n\r\n    //This is to track changes to the checkbox values\r\n    self.checkboxChanged = function(question) {\r\n      question.checked = false;\r\n      angular.forEach(question.answer, function(oVal, oKey){\r\n        if(oVal.checked === true) question.checked = true;\r\n      });\r\n    };\r\n\r\n    //Function to build option selector\r\n    self.loadOptionData = function(question, parent){\r\n      var deferred = $q.defer();\r\n      var qOptions = [];\r\n      var sqparams = \"\";\r\n      var xmlmc = new XMLMCService.MethodCall();\r\n      if (!parent) {\r\n        //We don't have a parent. Go get first level options\r\n        sqparams += \"qtable=\"+question.dbtable;\r\n        sqparams += \"&qkeycol=\"+question.keycol;\r\n        //Add display column if exists\r\n        if(angular.isDefined(question.txtcol) && question.txtcol !== \"\"){\r\n          sqparams += \"&qdiscol=\"+question.txtcol;\r\n        }\r\n        //Add details column if exists\r\n        if(angular.isDefined(question.prim_extdet) && question.prim_extdet !== \"\"){\r\n          sqparams += \"&qdetcol=\"+question.txtcol;\r\n        }\r\n        if(angular.isDefined(question.filter) && question.filter !== \"\"){\r\n          //Process provided question filter\r\n          sqparams += \"&qfilter=\"+WizardFilterService.processFilter(question.filter, true);\r\n        }\r\n        xmlmc.addParam(\"storedQuery\", \"query/wss/wizards/wizard.q.options.dynamic\");\r\n        xmlmc.addParam(\"parameters\", sqparams);\r\n        xmlmc.invoke(\"data\", \"invokeStoredQuery\", {\r\n          onSuccess: function(params){\r\n            if(params.rowData) {\r\n              if( Object.prototype.toString.call( params.rowData.row ) === '[object Array]' ) {\r\n                var intArrayLength = params.rowData.row.length;\r\n                for (var i = 0; i < intArrayLength; i++) {\r\n                  var qOption = [];\r\n                  qOption.id = params.rowData.row[i].keycol;\r\n                  if(angular.isDefined(params.rowData.row[i].discol)){\r\n                    qOption.name = params.rowData.row[i].discol;\r\n                    qOption.swname = params.rowData.row[i].discol;\r\n                  } else {\r\n                    qOption.name = params.rowData.row[i].keycol;\r\n                    qOption.swname = params.rowData.row[i].keycol;\r\n                  }\r\n                  if(angular.isDefined(params.rowData.row[i].detcol)){\r\n                    qOption.name = qOption.name + \" - \" + params.rowData.row[i].detcol;\r\n                  }\r\n                  qOption.hasChildren = true;\r\n                  qOptions.push(qOption);\r\n                }\r\n              } else {\r\n                var singOption = [];\r\n                singOption.id = params.rowData.row.keycol;\r\n                if(angular.isDefined(params.rowData.row.discol)){\r\n                  singOption.name = params.rowData.row.discol;\r\n                  singOption.swname = params.rowData.row.discol;\r\n                } else {\r\n                  singOption.name = params.rowData.row.keycol;\r\n                  singOption.swname = params.rowData.row.keycol;\r\n                }\r\n                if(angular.isDefined(params.rowData.row.detcol)){\r\n                  singOption.name = singOption.name + \" - \" + params.rowData.row.detcol;\r\n                }\r\n                qOptions.push(singOption);\r\n              }\r\n              deferred.resolve(qOptions);\r\n            }\r\n          },\r\n          onFailure: function(error){\r\n            wssLogging.logger(error, \"ERROR\", \"WizardDataService::loadOptionData-noParent\", false, false);\r\n            deferred.reject(error);\r\n          }\r\n        });\r\n      }\r\n      else {\r\n        //We DO have a parent. Go get second level (selectable) options\r\n        sqparams += \"qtable=\"+question.sec_table;\r\n        sqparams += \"&qkeycol=\"+question.sec_keycol;\r\n        //Add display column if exists\r\n        if(angular.isDefined(question.sec_txtcol) && question.sec_txtcol !== \"\"){\r\n          sqparams += \"&qdiscol=\"+question.sec_txtcol;\r\n        }\r\n        //Add details column if exists\r\n        if(angular.isDefined(question.sec_extdet) && question.sec_extdet !== \"\"){\r\n          sqparams += \"&qdetcol=\"+question.sec_extdet;\r\n        }\r\n        if(angular.isDefined(question.sec_filter) && question.sec_filter !== \"\"){\r\n          //Process provided question filter\r\n          sqparams += \"&qfilter=\"+WizardFilterService.processFilter(question.sec_filter, true);\r\n        }\r\n        if(angular.isDefined(question.sec_filtercolumn) && question.sec_filtercolumn !== \"\"){\r\n          //Process provided question filter\r\n          sqparams += \"&qfiltercol=\"+question.sec_filtercolumn;\r\n          sqparams += \"&qfiltercolval=\"+parent.id;\r\n        }\r\n        xmlmc.addParam(\"storedQuery\", \"query/wss/wizards/wizard.q.options.dynamic\");\r\n        xmlmc.addParam(\"parameters\", sqparams);\r\n        xmlmc.invoke(\"data\", \"invokeStoredQuery\", {\r\n          onSuccess: function(params){\r\n            if(params.rowData) {\r\n              if( Object.prototype.toString.call( params.rowData.row ) === '[object Array]' ) {\r\n                var intArrayLength = params.rowData.row.length;\r\n                for (var i = 0; i < intArrayLength; i++) {\r\n                  var qOption = [];\r\n                  qOption.id = params.rowData.row[i].keycol;\r\n                  if(angular.isDefined(params.rowData.row[i].discol)){\r\n                    qOption.name = params.rowData.row[i].discol;\r\n                    qOption.swname = params.rowData.row[i].discol;\r\n                  } else {\r\n                    qOption.name = params.rowData.row[i].keycol;\r\n                    qOption.swname = params.rowData.row[i].keycol;\r\n                  }\r\n                  if(angular.isDefined(params.rowData.row[i].detcol)){\r\n                    qOption.name = qOption.name + \" - \" + params.rowData.row[i].detcol;\r\n                  }\r\n                  qOptions.push(qOption);\r\n                }\r\n              } else {\r\n                var singOption = [];\r\n                singOption.id = params.rowData.row.keycol;\r\n                if(angular.isDefined(params.rowData.row.discol)){\r\n                  singOption.name = params.rowData.row.discol;\r\n                  singOption.swname = params.rowData.row.discol;\r\n                } else {\r\n                  singOption.name = params.rowData.row.keycol;\r\n                  singOption.swname = params.rowData.row.keycol;\r\n                }\r\n                if(angular.isDefined(params.rowData.row.detcol)){\r\n                  singOption.name = singOption.name + \" - \" + params.rowData.row.detcol;\r\n                }\r\n                qOptions.push(singOption);\r\n              }\r\n              deferred.resolve(qOptions);\r\n            } else {\r\n              //No children from the option selector\r\n              //Set parent object to not-expanded to remove loader\r\n              parent._hsmeta.isActive = false;\r\n              parent._hsmeta.isExpanded = false;\r\n              var connErrorType = 'error';\r\n              var connErrorBody = 'There are no options available against <strong>'+parent.name+\"</strong>\";\r\n              var connErrorTitle = 'No Options Available!';\r\n              wssLogging.sendToast(connErrorType, connErrorBody, connErrorTitle);\r\n            }\r\n          },\r\n          onFailure: function(error){\r\n            wssLogging.logger(error, \"ERROR\", \"WizardDataService::loadOptionData-hasParent\", true, false);\r\n            deferred.reject(error);\r\n          }\r\n        });\r\n      }\r\n      return deferred.promise;\r\n    };\r\n\r\n    //Get SLA's as specified in Dataform\r\n    //Pass back in the format of a Radiobutton question\r\n    self.getSLAQuestion = function(objDataform, objService) {\r\n      var deferred = $q.defer();\r\n      //Setup SLA Question object\r\n      var objSLAQuestion = {};\r\n      var strRelType = '';\r\n      if( !angular.isDefined(objDataform.cp_sla_first) ||\r\n          (angular.isDefined(objDataform.cp_sla_first) && objDataform.cp_sla_first === 'Service')){\r\n            strRelType = 'SERV';\r\n            //Go get SLA's aligned to Service\r\n            self.getServSubSLA(objService.fk_cmdb_id, strRelType).then(function(objSLAs){\r\n              //Get Class-specific default SLA & Priority\r\n              self.getClassDefaultSLA(objService.fk_cmdb_id, strRelType, objDataform.callclass).then(function(respClassDefSLA){\r\n                self.defSLA = respClassDefSLA;\r\n                //Build SLA question around Service SLAs\r\n                objSLAQuestion = self.buildSLAQuestion(objSLAs);\r\n                deferred.resolve(objSLAQuestion);\r\n              });\r\n            }, function(error){\r\n              wssLogging.logger(error, \"ERROR\", \"WizardDataService::getSLAQuestion\", false, false);\r\n              deferred.reject(error);\r\n            });\r\n      } else if (angular.isDefined(objDataform.cp_sla_first) && objDataform.cp_sla_first === \"Subscription\"){\r\n        strRelType = 'SUBS';\r\n        //Go get SLA's aligned to Subscription\r\n        self.getServSubSLA(objService.subs_id, strRelType).then(function(objSLAs){\r\n          //Get Class-specific default SLA & Priority\r\n          self.getClassDefaultSLA(objService.subs_id, strRelType, objDataform.callclass).then(function(respClassDefSLA){\r\n            self.defSLA = respClassDefSLA;\r\n            //Build SLA question around Subscription SLAs\r\n            objSLAQuestion = self.buildSLAQuestion(objSLAs);\r\n            deferred.resolve(objSLAQuestion);\r\n          });\r\n        }, function(error){\r\n          wssLogging.logger(error, \"ERROR\", \"WizardDataService::getSLAQuestion\", false, false);\r\n          deferred.reject(error);\r\n        });\r\n      } else if (angular.isDefined(objDataform.cp_sla_first) && objDataform.cp_sla_first === \"Subscription then Service\"){\r\n        strRelType = 'SUBS';\r\n        //Go get SLA's aligned to Subscription, if there are none, get those aligned to Service\r\n        self.getServSubSLA(objService.subs_id, strRelType).then(function(objSLAs){\r\n          if(objSLAs.length === 0) {\r\n            strRelType = 'SERV';\r\n            //No SLAs associated to the Subscription - go get SLA's aligned to Service instead\r\n            self.getServSubSLA(objService.fk_cmdb_id, strRelType).then(function(objSLAs){\r\n              //Get Class-specific default SLA & Priority\r\n              self.getClassDefaultSLA(objService.fk_cmdb_id, strRelType, objDataform.callclass).then(function(respClassDefSLA){\r\n                self.defSLA = respClassDefSLA;\r\n                //Build SLA question around Service SLAs\r\n                objSLAQuestion = self.buildSLAQuestion(objSLAs);\r\n                deferred.resolve(objSLAQuestion);\r\n              });\r\n            }, function(error){\r\n              wssLogging.logger(error, \"ERROR\", \"WizardDataService::getSLAQuestion\", false, false);\r\n              deferred.reject(error);\r\n            });\r\n          } else {\r\n            //Get Class-specific default SLA & Priority\r\n            self.getClassDefaultSLA(objService.subs_id, strRelType, objDataform.callclass).then(function(respClassDefSLA){\r\n              self.defSLA = respClassDefSLA;\r\n              //Build SLA question around Subscription SLAs\r\n              objSLAQuestion = self.buildSLAQuestion(objSLAs);\r\n              deferred.resolve(objSLAQuestion);\r\n            });\r\n          }\r\n        }, function(error){\r\n          wssLogging.logger(error, \"ERROR\", \"WizardDataService::getSLAQuestion\", false, false);\r\n          deferred.reject(error);\r\n        });\r\n      }\r\n      return deferred.promise;\r\n    };\r\n\r\n    self.getDefaultSLAOptions = function(objDataform, objService) {\r\n      var deferred = $q.defer();\r\n      var returnPrice = \"0.00\";\r\n      self.getSLAQuestion(objDataform, objService).then(function(slaQuestionResp){\r\n        if(angular.isDefined(slaQuestionResp.defaultvalue) && slaQuestionResp.defaultvalue > 0) {\r\n          angular.forEach(slaQuestionResp.options, function(slaQVal){\r\n            if(slaQVal.keycol === slaQuestionResp.defaultvalue && angular.isDefined(slaQVal.slaoptions.price)) {\r\n              returnPrice = slaQVal.slaoptions;\r\n            }\r\n          });\r\n        }\r\n        deferred.resolve(returnPrice);\r\n      }, function(error) {\r\n        deferred.resolve(returnPrice);\r\n      });\r\n      return deferred.promise;\r\n    };\r\n\r\n    //Get SLAs from Service or Subscription\r\n    self.getServSubSLA = function(idServSub, slaType){\r\n      var deferred = $q.defer();\r\n      var sqparams = \"slatype=\"+slaType;\r\n      sqparams += \"&sid=\"+idServSub;\r\n      var xmlmc = new XMLMCService.MethodCall();\r\n      xmlmc.addParam(\"storedQuery\", \"query/wss/sla/sla.servsub.get\");\r\n      xmlmc.addParam(\"parameters\", sqparams);\r\n      xmlmc.invoke(\"data\", \"invokeStoredQuery\", {\r\n        onSuccess: function(params){\r\n          var slaArray = [];\r\n          if(angular.isObject(params.rowData)){\r\n            if( Object.prototype.toString.call( params.rowData.row ) === '[object Array]' ) {\r\n              var intArrayLength = params.rowData.row.length;\r\n              //obj is array\r\n              for (var i = 0; i < intArrayLength; i++) {\r\n                slaArray.push(params.rowData.row[i]);\r\n              }\r\n            } else {\r\n              slaArray.push(params.rowData.row);\r\n            }\r\n          }\r\n          deferred.resolve(slaArray);\r\n        },\r\n        onFailure: function(error){\r\n          wssLogging.logger(error, \"ERROR\", \"WizardDataService::getServSubSLA\", false, false);\r\n          deferred.reject(error);\r\n        }\r\n      });\r\n      return deferred.promise;\r\n    };\r\n\r\n    self.getClassDefaultSLA = function(relId, relType, callClass){\r\n      var slaId = '0';\r\n      var deferred = $q.defer();\r\n      var sqparams = \"reltype=\"+relType;\r\n      sqparams += \"&relid=\"+relId;\r\n      sqparams += \"&callclass=\"+callClass;\r\n      var xmlmc = new XMLMCService.MethodCall();\r\n      xmlmc.addParam(\"storedQuery\", \"query/wss/sla/sla.callclass.default.get\");\r\n      xmlmc.addParam(\"parameters\", sqparams);\r\n      xmlmc.invoke(\"data\", \"invokeStoredQuery\", {\r\n        onSuccess: function(params){\r\n          if(angular.isObject(params.rowData)){\r\n            slaId = params.rowData.row.fk_slad;\r\n          }\r\n          deferred.resolve(slaId);\r\n        },\r\n        onFailure: function(error){\r\n          wssLogging.logger(error, \"WARN\", \"WizardDataService::getClassDefaultSLA\", false, false);\r\n          deferred.resolve(slaId);\r\n        }\r\n      });\r\n      return deferred.promise;\r\n    };\r\n\r\n    self.getStandardComponents = function(intServId, strCallClass) {\r\n      var deferred = $q.defer();\r\n      if(strCallClass !== 'Service Request') {\r\n        deferred.resolve(false);\r\n      } else {\r\n        var objStandardComponents = [];\r\n        var objStandardComponentQuestion = {};\r\n        //Get standard components first\r\n        var sqparams = \"servid=\"+intServId;\r\n        sqparams += \"&optional=false\";\r\n        var xmlmc = new XMLMCService.MethodCall();\r\n        xmlmc.addParam(\"storedQuery\", \"query/wss/services/components.standard.get\");\r\n        xmlmc.addParam(\"parameters\", sqparams);\r\n        xmlmc.invoke(\"data\", \"invokeStoredQuery\", {\r\n          onSuccess: function(params){\r\n            if(angular.isObject(params.rowData)){\r\n              if( Object.prototype.toString.call( params.rowData.row ) === '[object Array]' ) {\r\n                var intArrayLength = params.rowData.row.length;\r\n                //obj is array\r\n                for (var i = 0; i < intArrayLength; i++) {\r\n                  objStandardComponents.push(params.rowData.row[i]);\r\n                }\r\n              } else {\r\n                objStandardComponents.push(params.rowData.row);\r\n              }\r\n              //Now get amendable components for each objStandardComponents\r\n              angular.forEach(objStandardComponents, function(compVal, compKey){\r\n                objStandardComponents[compKey].customComponents = [];\r\n                if(compVal.flg_cancustomise === \"1\"){\r\n                  var objCustomisedComponents = [];\r\n                  //Get standard components first\r\n                  var sqparams = \"servid=\"+compVal.pk_auto_id;\r\n                  var xmlmc = new XMLMCService.MethodCall();\r\n                  xmlmc.addParam(\"storedQuery\", \"query/wss/services/components.alternate.get\");\r\n                  xmlmc.addParam(\"parameters\", sqparams);\r\n                  xmlmc.invoke(\"data\", \"invokeStoredQuery\", {\r\n                    onSuccess: function(params){\r\n                      if(angular.isObject(params.rowData)){\r\n                        if( Object.prototype.toString.call( params.rowData.row ) === '[object Array]' ) {\r\n                          var intArrayLength = params.rowData.row.length;\r\n                          //obj is array\r\n                          for (var i = 0; i < intArrayLength; i++) {\r\n                            objCustomisedComponents.push(params.rowData.row[i]);\r\n                          }\r\n                        } else {\r\n                          objCustomisedComponents.push(params.rowData.row);\r\n                        }\r\n                      }\r\n                      objStandardComponents[compKey].customComponents =self.buildStandardCompQuestion(objCustomisedComponents);\r\n                    },\r\n                    onFailure: function(error){\r\n                      wssLogging.logger(error, \"WARN\", \"WizardDataService::getStandardComponents-CustomisedComponents\", false, false);\r\n                    }\r\n                  });\r\n                }\r\n              });\r\n            }\r\n\r\n            if(objStandardComponents.length === 0){\r\n              deferred.resolve(false);\r\n            } else {\r\n              objStandardComponentQuestion = self.buildStandardCompQuestion(objStandardComponents);\r\n              deferred.resolve(objStandardComponentQuestion);\r\n            }\r\n          },\r\n          onFailure: function(error){\r\n            wssLogging.logger(error, \"WARN\", \"WizardDataService::getStandardComponents\", false, false);\r\n            deferred.resolve(false);\r\n          }\r\n        });\r\n      }\r\n      return deferred.promise;\r\n    };\r\n\r\n    self.getOptionalComponents = function(intServId, strCallClass) {\r\n      var deferred = $q.defer();\r\n      if(strCallClass !== 'Service Request') {\r\n        deferred.resolve(false);\r\n      } else {\r\n        var objStandardComponents = [];\r\n        var objStandardComponentQuestion = {};\r\n        //Get standard components first\r\n        var sqparams = \"servid=\"+intServId;\r\n        sqparams += \"&optional=true\";\r\n        var xmlmc = new XMLMCService.MethodCall();\r\n        xmlmc.addParam(\"storedQuery\", \"query/wss/services/components.standard.get\");\r\n        xmlmc.addParam(\"parameters\", sqparams);\r\n        xmlmc.invoke(\"data\", \"invokeStoredQuery\", {\r\n          onSuccess: function(params){\r\n            if(angular.isObject(params.rowData)){\r\n              if( Object.prototype.toString.call( params.rowData.row ) === '[object Array]' ) {\r\n                var intArrayLength = params.rowData.row.length;\r\n                //obj is array\r\n                for (var i = 0; i < intArrayLength; i++) {\r\n                  objStandardComponents.push(params.rowData.row[i]);\r\n                }\r\n              } else {\r\n                objStandardComponents.push(params.rowData.row);\r\n              }\r\n            }\r\n            if(objStandardComponents.length === 0){\r\n              deferred.resolve(false);\r\n            } else {\r\n              objStandardComponentQuestion = self.buildOptionalCompQuestion(objStandardComponents);\r\n              deferred.resolve(objStandardComponentQuestion);\r\n            }\r\n          },\r\n          onFailure: function(error){\r\n            wssLogging.logger(error, \"WARN\", \"WizardDataService::getOptionalComponents\", false, false);\r\n            deferred.resolve(false);\r\n          }\r\n        });\r\n      }\r\n      return deferred.promise;\r\n    };\r\n\r\n    //Takes object containing Optional Components, build and returns a wizard question\r\n    self.buildStandardCompQuestion = function(oComponents){\r\n      var objQuestion = {};\r\n      objQuestion.answer = {};\r\n      objQuestion.question = 'Standard Components';\r\n      objQuestion.qfilter = 'standardComponentDisplay';\r\n      objQuestion.flg_hidden = '0';\r\n      objQuestion.flg_prefixq = '1';\r\n      objQuestion.type = 'StandardComponentRadiobox';\r\n      objQuestion.options = [];\r\n      angular.forEach(oComponents, function(objCompVal, objCompKey){\r\n        var option = {};\r\n        option.keycol = objCompVal.pk_auto_id;\r\n        option.discol = objCompVal.description;\r\n        option.componentoptions = objCompVal;\r\n        objQuestion.answer[option.keycol] = option;\r\n        objQuestion.options.push(option);\r\n      });\r\n      return objQuestion;\r\n    };\r\n\r\n    //Takes object containing Optional Components, build and returns a wizard question\r\n    self.buildOptionalCompQuestion = function(oComponents){\r\n      var objQuestion = {};\r\n      objQuestion.answer = {};\r\n      objQuestion.question = 'Optional Components';\r\n      objQuestion.qfilter = 'optionalComponentDisplay';\r\n      objQuestion.flg_hidden = '0';\r\n      objQuestion.flg_prefixq = '1';\r\n      objQuestion.type = 'OptionalComponentCheckbox';\r\n      objQuestion.options = [];\r\n      angular.forEach(oComponents, function(objCompVal, objCompKey){\r\n        var option = {};\r\n        option.keycol = objCompVal.pk_auto_id;\r\n        option.discol = objCompVal.description;\r\n        option.componentoptions = objCompVal;\r\n        objQuestion.options.push(option);\r\n      });\r\n      return objQuestion;\r\n    };\r\n\r\n    //Takes object containing SLAs, build and returns a wizard question\r\n    self.buildSLAQuestion = function(oSLAs){\r\n      var objQuestion = {};\r\n      objQuestion.answer = {};\r\n      objQuestion.question = 'Service Level Options';\r\n      objQuestion.targetcolumn = 'opencall.itsm_sladef';\r\n      objQuestion.qfilter = 'optionDisplay';\r\n      objQuestion.flg_mandatory = '1';\r\n      objQuestion.flg_hidden = '0';\r\n      objQuestion.type = 'SLARadiobox';\r\n      objQuestion.options = [];\r\n      angular.forEach(oSLAs, function(objSLAVal, objSLAKey){\r\n        var option = {};\r\n        option.keycol = objSLAVal.fk_sla;\r\n        option.discol = objSLAVal.fk_sla_name;\r\n        option.slaoptions = objSLAVal;\r\n        if(objSLAKey === 0 ){\r\n          objQuestion.defaultvalue = option.keycol;\r\n        } else if (objSLAVal.fk_sla === self.defSLA) {\r\n          objQuestion.defaultvalue = option.keycol;\r\n        }\r\n        objQuestion.options.push(option);\r\n      });\r\n      return objQuestion;\r\n    };\r\n\r\n    //Get Jump on value options for question\r\n    self.getJumpRecords = function(qid){\r\n      var deferred = $q.defer();\r\n      var sqparams = \"qid=\"+qid;\r\n      var xmlmc = new XMLMCService.MethodCall();\r\n      xmlmc.addParam(\"storedQuery\", \"query/wss/wizards/wizard.get.jumps\");\r\n      xmlmc.addParam(\"parameters\", sqparams);\r\n      xmlmc.invoke(\"data\", \"invokeStoredQuery\", {\r\n        onSuccess: function(params){\r\n          var jumpArray = [];\r\n          if(angular.isObject(params.rowData)){\r\n            if( Object.prototype.toString.call( params.rowData.row ) === '[object Array]' ) {\r\n              var intArrayLength = params.rowData.row.length;\r\n              //obj is array\r\n              for (var i = 0; i < intArrayLength; i++) {\r\n                jumpArray.push(params.rowData.row[i]);\r\n              }\r\n            } else {\r\n              jumpArray.push(params.rowData.row);\r\n            }\r\n          }\r\n          deferred.resolve(jumpArray);\r\n        },\r\n        onFailure: function(error){\r\n          wssLogging.logger(error, \"ERROR\", \"WizardDataService::getJumpRecords\", false, false);\r\n          deferred.reject(error);\r\n        }\r\n      });\r\n      return deferred.promise;\r\n    };\r\n\r\n    //When the SLA radiobutton is changed, recalculate the Service Costs\r\n    self.slaChange = function(oOption) {\r\n      if(angular.isDefined(oOption.slaoptions.price) && parseFloat(oOption.slaoptions.price).toFixed(2) > 0) {\r\n        self.dataForm.prices.servicelevel = oOption.slaoptions.price;\r\n      } else {\r\n        self.dataForm.prices.servicelevel = \"0.00\";\r\n      }\r\n      if(angular.isDefined(oOption.slaoptions.total_cost) && parseFloat(oOption.slaoptions.total_cost).toFixed(2) > 0) {\r\n        self.dataForm.prices.serviceLevelCost = oOption.slaoptions.total_cost;\r\n      } else {\r\n        self.dataForm.prices.serviceLevelCost = \"0.00\";\r\n      }\r\n      self.dataForm.prices.total = (parseFloat(self.dataForm.prices.basic) + parseFloat(self.dataForm.prices.customisation) + parseFloat(self.dataForm.prices.optional) + parseFloat(self.dataForm.prices.servicelevel)).toFixed(2);\r\n    };\r\n\r\n    //When a Componment is changed, or just prior to submitting a completed wizard, calculate costs/prices and update object\r\n    self.componentChange = function() {\r\n      var customisationCompCost = 0;\r\n      var customisationCompPrice = 0;\r\n      var optionalCompCost = 0;\r\n      var optionalCompPrice = 0;\r\n\r\n      //Get object keys to work out length of Wizard Stages object\r\n      var keys = Object.keys(self.wizardStages);\r\n      var intEndStage = keys.length - 1;\r\n\r\n      angular.forEach(self.wizardStages[intEndStage].questions, function(objQuestion){\r\n        if(objQuestion.pk_qid ===  'QSTCOMP') {\r\n          angular.forEach(objQuestion.answer, function(objAnswerVal, intAnswerKey){\r\n            if(objAnswerVal.keycol !== intAnswerKey){\r\n              var cusPriceDiff = '0.00';\r\n              var cusCost = '0.00';\r\n              if(angular.isDefined(objAnswerVal.componentoptions.price_diff)){\r\n                cusPriceDiff = objAnswerVal.componentoptions.price_diff;\r\n              }\r\n              if(angular.isDefined(objAnswerVal.componentoptions.total_cost_for_item)){\r\n                cusCost = objAnswerVal.componentoptions.total_cost_for_item;\r\n              }\r\n              customisationCompPrice = (parseFloat(customisationCompPrice) + parseFloat(cusPriceDiff)).toFixed(2);\r\n              customisationCompCost = (parseFloat(customisationCompCost) + parseFloat(cusCost)).toFixed(2);\r\n            }\r\n          });\r\n          self.dataForm.prices.customisation = customisationCompPrice;\r\n          self.dataForm.prices.customisationCost = customisationCompCost;\r\n        }\r\n        if(objQuestion.pk_qid === 'QOPCOMP'){\r\n          angular.forEach(objQuestion.answer, function(objAnswerVal, intAnswerKey){\r\n            if(angular.isObject(objAnswerVal)){\r\n              var opPrice = '0.00';\r\n              var opCost = '0.00';\r\n              if(angular.isDefined(objAnswerVal.price)){\r\n                opPrice = objAnswerVal.price;\r\n              }\r\n              if(angular.isDefined(objAnswerVal.total_cost_for_item)){\r\n                opCost = objAnswerVal.total_cost_for_item;\r\n              }\r\n              optionalCompPrice = (parseFloat(optionalCompPrice) + parseFloat(opPrice)).toFixed(2);\r\n              optionalCompCost = (parseFloat(optionalCompCost) + parseFloat(opCost)).toFixed(2);\r\n            }\r\n          });\r\n          self.dataForm.prices.optional = optionalCompPrice;\r\n          self.dataForm.prices.optionalCost = optionalCompCost;\r\n        }\r\n      });\r\n      if(angular.isDefined(self.dataForm) && angular.isDefined(self.dataForm.prices)){\r\n        self.dataForm.prices.totalComponentPrice = (parseFloat(customisationCompPrice) + parseFloat(optionalCompPrice) + parseFloat(self.dataForm.prices.basic)).toFixed(2);\r\n        self.dataForm.prices.totalComponentCost = (parseFloat(customisationCompCost) + parseFloat(optionalCompCost)).toFixed(2);\r\n        self.dataForm.prices.total = (parseFloat(self.dataForm.prices.basic) + parseFloat(self.dataForm.prices.customisation) + parseFloat(self.dataForm.prices.optional) + parseFloat(self.dataForm.prices.servicelevel)).toFixed(2);\r\n        self.dataForm.prices.totalCost = (parseFloat(self.dataForm.prices.totalComponentCost)  + parseFloat(self.dataForm.prices.serviceLevelCost)).toFixed(2);\r\n      }\r\n    };\r\n\r\n    //Check size of files being attached\r\n    self.checkFiles = function (event, reader, fileList) {\r\n      self.addingFiles = true;\r\n      if (fileList.size > 10000000) {\r\n        var fileError = \"File [\"+fileList.name+\"] is too big!\";\r\n        var connErrorType = 'warning';\r\n        var connErrorBody = \"File [\"+fileList.name+\"] is too big!\";\r\n        var connErrorTitle = 'File Size Warning!';\r\n        wssLogging.sendToast(connErrorType, connErrorBody, connErrorTitle);\r\n\r\n        reader.abort();\r\n      }\r\n    };\r\n\r\n    //\r\n    self.filesAdded = function(event, reader, fileObjs, file){\r\n      self.addingFiles = false;\r\n    };\r\n\r\n    return self;\r\n  }\r\n}());\r\n"]}