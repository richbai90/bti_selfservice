{"version":3,"sources":["../../../_itsm_default_v2_template/app/services/affectedservices.service.js"],"names":["angular","module","factory","AffectedServicesService","$inject","$q","XMLMCService","store","wssLogging","self","custDetails","get","instanceConfig","getActiveNotifications","notificationsLoading","deferred","defer","currPageNum","pageNo","notifArray","CIIDArray","sqparams","selfServiceInstance","keysearch","fk_company_id","site","department","subdepartment","category","currCountSQ","notifDetailsSQ","xmlmc","MethodCall","addParam","invoke","onSuccess","params","rowData","Object","prototype","toString","call","row","intArrayLength","length","i","strCIID","ci_auto_id","indexOf","push","resolve","onFailure","error","logger","promise"],"mappings":"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","file":"affectedservices.service.js","sourcesContent":["(function (){\r\n    'use strict';\r\n    angular\r\n      .module('swSelfService')\r\n      .factory('AffectedServicesService', AffectedServicesService);\r\n\r\n      AffectedServicesService.$inject=['$q', 'XMLMCService','store','wssLogging'];\r\n\r\n    function AffectedServicesService($q, XMLMCService, store, wssLogging)\r\n\t{\r\n\t\tvar self = {\r\n\t\t\t'notificationsLoading': false,\r\n\t\t\t'notifDetailsSQ': 'query/wss/notifications/affectedservices.list.select',\r\n\t\t\t'notifArray': [],\r\n\t\t\t'totalNotif': 0\r\n\t\t};\r\n\t\r\n\t\tself.custDetails=store.get(\"custDetails\");\r\n\t\tself.instanceConfig=store.get(\"instanceConfig\"); \r\n\r\n\t\tself.getActiveNotifications = function()\r\n\t\t{\r\n\t\t\tself.notificationsLoading = true;\r\n\t\t\tvar deferred = $q.defer();\r\n\t\t\t//Work out columns.\r\n\t\t\tvar currPageNum = self.pageNo;\r\n\t\t\tvar notifArray = [];\r\n\t\t\tvar CIIDArray = [];\r\n\t\t\tvar sqparams = \"ssid=\"+self.instanceConfig.selfServiceInstance;\r\n\t\t\tsqparams += \"&custid=\"+self.custDetails.keysearch;\r\n\t\t\tsqparams += \"&fk_company_id=\"+self.custDetails.fk_company_id;\r\n\t\t\tsqparams += \"&site=\"+self.custDetails.site;\r\n\t\t\tsqparams += \"&department=\"+self.custDetails.department;\r\n\t\t\tsqparams += \"&subdepartment=\"+self.custDetails.subdepartment;\r\n\t\t\tsqparams += \"&cat=\"+self.category;\r\n\r\n\t\t\tself.currCountSQ = self.notifDetailsSQ;\r\n\t\t\t//--if (self.totalNotif > 0) {\r\n\t\t\t\r\n\t\t\tvar xmlmc = new XMLMCService.MethodCall();\r\n\t\t\txmlmc.addParam(\"storedQuery\", self.currCountSQ);\r\n\t\t\txmlmc.addParam(\"parameters\", sqparams);\r\n\t\t\txmlmc.invoke(\"data\", \"invokeStoredQuery\", {\r\n\t\t\tonSuccess: function(params)\r\n\t\t\t{\r\n\t\t\t  /* if(params.rowData)\r\n\t\t\t  {\r\n\t\t\t\tif( Object.prototype.toString.call( params.rowData.row ) === '[object Array]' )\r\n\t\t\t\t{\r\n\t\t\t\t  var intArrayLength = params.rowData.row.length;\r\n\t\t\t\t  //obj is array\r\n\t\t\t\t  for (var i = 0; i < intArrayLength; i++)\r\n\t\t\t\t  {\r\n\t\t\t\t\tnotifArray.push(params.rowData.row[i]);\r\n\t\t\t\t  }\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t  notifArray.push(params.rowData.row);\r\n\t\t\t\t}\r\n\t\t\t\tself.notificationsLoading = false;\r\n\t\t\t\tdeferred.resolve(notifArray);\r\n\t\t\t  }\r\n\t\t\t  else\r\n\t\t\t  {\r\n\t\t\t\tself.notificationsLoading = false;\r\n\t\t\t\tdeferred.resolve('');\r\n\t\t\t  } */\r\n\t\t\t\tif(params.rowData)\r\n\t\t\t\t{\r\n\t\t\t\t\tif( Object.prototype.toString.call( params.rowData.row ) === '[object Array]' )\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tvar intArrayLength = params.rowData.row.length;\r\n\t\t\t\t\t\t//obj is array\r\n\t\t\t\t\t\tfor (var i = 0; i < intArrayLength; i++)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t//-- Prevent duplicate rows in Affected Services lists\r\n\t\t\t\t\t\t\tvar strCIID = params.rowData.row[i].ci_auto_id;\r\n\t\t\t\t\t\t\tif (CIIDArray.indexOf(strCIID) == -1)\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tCIIDArray.push(strCIID);\r\n\t\t\t\t\t\t\t\tCIIDArray.push(params.rowData.row[i]);\r\n\t\t\t\t\t\t\t\tnotifArray.push(params.rowData.row[i]);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tnotifArray.push(params.rowData.row);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tself.notificationsLoading = false;\r\n\t\t\t\t\tdeferred.resolve(notifArray);\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tself.notificationsLoading = false;\r\n\t\t\t\t\tdeferred.resolve('');\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tonFailure: function(error)\r\n\t\t\t{\r\n\t\t\t\twssLogging.logger(error, \"ERROR\", \"AffectedServicesService::getActiveNotifications\", false, false);\r\n\t\t\t}\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\treturn deferred.promise;\r\n\t\t};\r\n\t\treturn self;\r\n\t}\r\n})();\r\n"]}