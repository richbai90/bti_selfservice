{"version":3,"sources":["../../../_itsm_default_v2_template/app/controllers/knowledge.ctrl.js"],"names":["angular","module","controller","KnowledgeCtrl","$inject","$scope","SWSessionService","KnowledgeService","$stateParams","knowledge","searchTypes","display","value","searchCriteria","maxResults","searchString","searchOptions","title","keywords","problem","solution","searchResults","showSearchStringAlert","getKBCatList","then","kbcats","getDefaultSearchSettings","settings","systemSettings","boolLoadDefaultSearchSettings","setSrchCatFrmSysSetting","setSrchTypeFrmSysSetting","searchType","catalog","searchSectionValid","someSelected","object","Object","keys","some","key","forEach","kbcat","name","catalogName","submitKBSearch","checkActiveSession","searchKB","kbArticleArray","getExternalDocPath","getArticleDetails","kbRef","articleDetails","externalUrl","$location","host","docPath","resetSearchCriteria","$on","KBArticleController","$rootScope","$window","$state","loadArticleDetails","incrementAccessCounter","isDefined","boolExternal","open","goBackToSearchPage","article","getRelatedArticles","getRelatedTypes","getProfileInfo","callProbCode","strCode","strInfo","profileInfo","articleList","arrRelatedArticles","typesString","strRelatedTypes","goToRelatedArticle","docRef","go","notify","fromStateName","sc","so"],"mappings":"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","file":"knowledge.ctrl.js","sourcesContent":["(function () {\r\n    'use strict';\r\n\r\n\tangular\r\n        .module('swSelfService')\r\n        .controller('KnowledgeCtrl', KnowledgeCtrl);\r\n    KnowledgeCtrl.$inject = ['$scope','SWSessionService','KnowledgeService', '$stateParams'];\r\n    function KnowledgeCtrl($scope, SWSessionService, KnowledgeService, $stateParams)\r\n    {\r\n\t\t$scope.knowledge = KnowledgeService;\r\n\r\n\t\t$scope.searchTypes =\r\n\t\t[\r\n\t\t\t{display:\"Natural language query (ask a question)\",value:1},\r\n\t\t\t{display:\"Word search (any words can match)\",value:2},\r\n\t\t\t{display:\"Word search (all words must match)\",value:3}\r\n\t\t];\r\n\r\n\t\t$scope.searchCriteria = {};\r\n\t\t$scope.searchCriteria.maxResults = $stateParams.maxResults;\r\n\t\t$scope.searchCriteria.searchString = $stateParams.searchString;\r\n\t\t$scope.searchCriteria.searchOptions = [];\r\n\t\t$scope.searchCriteria.searchOptions.title = $stateParams.title;\r\n\t\t$scope.searchCriteria.searchOptions.keywords = $stateParams.keywords;\r\n\t\t$scope.searchCriteria.searchOptions.problem = $stateParams.problem;\r\n\t\t$scope.searchCriteria.searchOptions.solution = $stateParams.solution;\r\n\t\t$scope.searchResults = $stateParams.searchResults;\r\n\t\t$scope.showSearchStringAlert = false;\r\n\r\n\t\t$scope.knowledge.getKBCatList().then(function(kbcats)\r\n\t\t{\r\n\t\t\t$scope.kbcats = kbcats;\r\n\t\t\t$scope.knowledge.getDefaultSearchSettings().then(function(settings)\r\n\t\t\t{\r\n\t\t\t\t//-- This exposes to the template the booleans from System Settings.\r\n\t\t\t\t$scope.systemSettings = settings;\r\n\r\n\t\t\t\tif ($stateParams.boolLoadDefaultSearchSettings)\r\n\t\t\t\t{\r\n\t\t\t\t\t//-- Use default search settings from system settings\r\n\t\t\t\t\t$scope.setSrchCatFrmSysSetting();\r\n\t\t\t\t\t$scope.setSrchTypeFrmSysSetting();\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\t//-- Use passed in search settings (if we are going back to search)\r\n\t\t\t\t\t$scope.searchCriteria.searchType = $stateParams.searchType;\r\n\t\t\t\t\t$scope.searchCriteria.catalog = $stateParams.catalog;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\t//-- Function to determine if \"search section\" is valid.\r\n\t\t//-- (At lease 1 search option must be selected if we are using a \"word search\")\r\n\t\t$scope.searchSectionValid = function()\r\n\t\t{\r\n\t\t\tif ($scope.searchCriteria.searchType != 1)\r\n\t\t\t{\r\n\t\t\t\tif (!$scope.someSelected($scope.searchCriteria.searchOptions))\r\n\t\t\t\t{\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t};\r\n\r\n\t\t//-- Function used to determine if at least 1 element of passed in object is set to true\r\n\t\t$scope.someSelected = function (object)\r\n\t\t{\r\n\t\t  return Object.keys(object).some(function (key)\r\n\t\t  {\r\n\t\t\treturn object[key];\r\n\t\t  });\r\n\t\t};\r\n\r\n\t\t$scope.setSrchTypeFrmSysSetting = function ()\r\n\t\t{\r\n\t\t\t//-- Set search type based on system setting\r\n\t\t\tswitch($scope.systemSettings.searchType)\r\n\t\t\t{\r\n\t\t\t\tcase \"Natural language query (ask a question)\":\r\n\t\t\t\t\t$scope.searchCriteria.searchType = 1;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"Word Search (any words can match)\":\r\n\t\t\t\t\t$scope.searchCriteria.searchType = 2;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"Word Search (all words must match)\":\r\n\t\t\t\t\t$scope.searchCriteria.searchType = 3;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\t$scope.searchCriteria.searchType = 1;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t$scope.setSrchCatFrmSysSetting = function ()\r\n\t\t{\r\n\t\t\t//-- Set catalog name based on system setting\r\n\t\t\tangular.forEach($scope.kbcats, function(kbcat, key)\r\n\t\t\t{\r\n\t\t\t\tif (kbcat.name == $scope.systemSettings.catalogName)\r\n\t\t\t\t{\r\n\t\t\t\t\t$scope.searchCriteria.catalog = kbcat;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\t$scope.submitKBSearch = function()\r\n\t\t{\r\n\t\t\tSWSessionService.checkActiveSession().then(function()\r\n\t\t\t{\r\n\t\t\t\tif ($scope.searchSectionValid())\r\n\t\t\t\t{\r\n\t\t\t\t\t//-- Check that a search string has been entered\r\n\t\t\t\t\tif($scope.searchCriteria.searchString !== \"\")\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif ($scope.searchCriteria.maxResults <= 500 && $scope.searchCriteria.maxResults > 0)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t$scope.knowledge.searchKB($scope.searchCriteria, true).then(function(kbArticleArray)\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t$scope.searchResults = kbArticleArray;\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t//-- if no search string entered...\r\n\t\t\t\t\t\t$scope.showSearchStringAlert = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\t$scope.getExternalDocPath = function()\r\n\t\t{\r\n\t\t\t$scope.knowledge.getArticleDetails($stateParams.kbRef).then(function(articleDetails)\r\n\t\t\t{\r\n\t\t\t\tvar externalUrl = \"http://\" + $location.host() + \"/sw/kb/\" + articleDetails.docPath;\r\n\t\t\t\treturn externalUrl;\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\t$scope.resetSearchCriteria = function()\r\n\t\t{\r\n\t\t\t$scope.setSrchCatFrmSysSetting();\r\n\t\t\t$scope.setSrchTypeFrmSysSetting();\r\n\t\t\t$scope.searchCriteria.searchOptions.title = true;\r\n\t\t\t$scope.searchCriteria.searchOptions.keywords = true;\r\n\t\t\t$scope.searchCriteria.searchOptions.problem = true;\r\n\t\t\t$scope.searchCriteria.searchOptions.solution = true;\r\n\t\t\t$scope.searchCriteria.maxResults = 100;\r\n\t\t\t$scope.searchCriteria.searchString = \"\";\r\n\t\t\t$scope.searchResults = [];\r\n\t\t\t$scope.showSearchStringAlert = false;\r\n\t\t};\r\n\r\n\t\t//Watch for logout broadcast to clean up session-specific data ready for a new user\r\n\t\t$scope.$on('logout',function()\r\n\t\t{\r\n\t\t\t$scope.knowledge = {};\r\n\t\t});\r\n\t}\r\n\r\n\tangular\r\n        .module('swSelfService')\r\n        .controller('KBArticleController', KBArticleController);\r\n    KBArticleController.$inject = ['$scope','$rootScope','SWSessionService','KnowledgeService','$stateParams','$window','$location','$state'];\r\n    function KBArticleController($scope, $rootScope, SWSessionService, KnowledgeService, $stateParams, $window, $location, $state)\r\n    {\r\n\r\n\t\t$scope.knowledge = KnowledgeService;\r\n\r\n\t\tSWSessionService.checkActiveSession().then(function()\r\n\t\t{\r\n\t\t\t$scope.loadArticleDetails($stateParams.kbRef);\r\n\t\t});\r\n\t\t\r\n\t\t$scope.loadArticleDetails = function(kbRef)\r\n\t\t{\r\n\t\t\t$scope.knowledge.getArticleDetails(kbRef).then(function(articleDetails)\r\n\t\t\t{\r\n\t\t\t\t$scope.incrementAccessCounter();\r\n\t\t\t\t//-- Check if docPath is defined to determine if document is Internal or External\r\n\t\t\t\tif (angular.isDefined(articleDetails.docPath))\r\n\t\t\t\t{\r\n\t\t\t\t\t$scope.boolExternal = true;\r\n\t\t\t\t\tvar externalUrl = \"http://\" + $location.host() + \"/sw/kb/\" + articleDetails.docPath;\r\n\r\n\t\t\t\t\t//-- Open external doxument in new window\r\n\t\t\t\t\t$window.open(externalUrl);\r\n\r\n\t\t\t\t\t//-- Return to search results in old window\r\n\t\t\t\t\t$scope.goBackToSearchPage();\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\t$scope.boolExternal = false;\r\n\r\n\t\t\t\t\t//-- Internal document, so expose article details to template\r\n\t\t\t\t\t$scope.article = articleDetails;\r\n\t\t\t\t\t$scope.getRelatedArticles(kbRef);\r\n\t\t\t\t\t$scope.getRelatedTypes(kbRef);\r\n\t\t\t\t\t$scope.getProfileInfo(articleDetails.callProbCode);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t$scope.getProfileInfo = function(strCode)\r\n\t\t{\r\n\t\t\t$scope.knowledge.getProfileInfo(strCode).then(function(strInfo)\r\n\t\t\t{\r\n\t\t\t\t$scope.profileInfo = strInfo;\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\t$scope.getRelatedArticles = function(kbRef)\r\n\t\t{\r\n\t\t\t$scope.knowledge.getRelatedArticles(kbRef).then(function(articleList)\r\n\t\t\t{\r\n\t\t\t\t$scope.arrRelatedArticles = articleList;\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\t$scope.getRelatedTypes = function(kbRef)\r\n\t\t{\r\n\t\t\t$scope.knowledge.getRelatedTypes(kbRef).then(function(typesString)\r\n\t\t\t{\r\n\t\t\t\t$scope.strRelatedTypes = typesString;\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\t$scope.incrementAccessCounter = function()\r\n\t\t{\r\n\t\t\t$scope.knowledge.incrementAccessCounter($stateParams.kbRef);\r\n\t\t};\r\n\r\n\t\t$scope.goToRelatedArticle = function(docRef)\r\n\t\t{\r\n\t\t\t//-- Go to new article but don't trigger state reload (basically just updates URL)\r\n\t\t\t$state.go('kbarticle',{kbRef : docRef},{\r\n\t\t\t\tnotify:false,\r\n\t\t\t});\r\n\t\t\t//-- Load new article details without changing state\r\n\t\t\t$scope.loadArticleDetails(docRef);\r\n\t\t}\r\n\t\t\r\n\t\t$scope.goBackToSearchPage = function()\r\n\t\t{\r\n\t\t\tif(angular.isDefined($rootScope.fromStateName) && $rootScope.fromStateName === 'globalsearch')\r\n\t\t\t{\r\n\t\t\t\t$state.go(\"globalsearch\");\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tvar sc = $stateParams.searchCriteria;\r\n\t\t\t\tvar so = $stateParams.searchOptions;\r\n\r\n\t\t\t\t$state.go(\"knowledge\", {\tsearchType \t\t\t\t\t\t: sc.searchType,\r\n\t\t\t\t\t\t\t\t\t\t\tsearchString\t\t\t\t\t: sc.searchString,\r\n\t\t\t\t\t\t\t\t\t\t\tcatalog\t\t\t\t\t\t\t: sc.catalog,\r\n\t\t\t\t\t\t\t\t\t\t\tkeywords\t\t\t\t\t\t: so.keywords,\r\n\t\t\t\t\t\t\t\t\t\t\ttitle\t\t\t\t\t\t\t: so.title,\r\n\t\t\t\t\t\t\t\t\t\t\tproblem\t\t\t\t\t\t\t: so.problem,\r\n\t\t\t\t\t\t\t\t\t\t\tsolution \t\t\t\t\t\t: so.solution,\r\n\t\t\t\t\t\t\t\t\t\t\tmaxResults\t\t\t\t\t\t: sc.maxResults,\r\n\t\t\t\t\t\t\t\t\t\t\tsearchResults \t\t\t\t\t: $stateParams.searchResults,\r\n\t\t\t\t\t\t\t\t\t\t\tboolLoadDefaultSearchSettings \t: $stateParams.boolLoadDefaultSearchSettings });\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t//Watch for logout broadcast to clean up session-specific data ready for a new user\r\n\t\t$scope.$on('logout',function()\r\n\t\t{\r\n\t\t\t$scope.knowledge = {};\r\n\t\t});\r\n\t}\r\n\r\n\r\n})();\r\n"]}