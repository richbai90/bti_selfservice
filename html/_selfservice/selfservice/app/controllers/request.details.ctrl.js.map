{"version":3,"sources":["../../../_itsm_default_v2_template/app/controllers/request.details.ctrl.js"],"names":["angular","module","controller","RequestDetailsController","$inject","$q","$scope","$rootScope","SWSessionService","$stateParams","RequestDetailsService","$state","RequestInteractService","wssHelpers","wssLogging","$previousState","store","$uibModal","$timeout","previousState","get","isWssAdmin","hasWebflag","ratingValue","ratingStates","stateOn","stateOff","accStatus","closeOthers","detailsOpen","bpmOpen","extDataOpen","haveRights","authRequired","loadingRequest","loadingDiary","loadingAttachments","loadingAssets","loadingComponents","ratingRequest","updatingRequest","closingRequest","cancellingRequest","addingFiles","authorisingRequest","updateType","callClass","classAssets","classComponents","workflowObject","workflowHasProgression","newFileAttachments","requestID","requestService","requestUpdateService","$on","checkFiles","event","reader","fileList","size","toastType","toastBody","name","toastTitle","sendToast","abort","filesAdded","fileObjs","file","requestList","go","state","authRequest","authoriseRequest","authText","authDecision","then","response","objNewCustDetails","authCount","numAuths","set","getRequestDetails","getRequestDiary","buildBPMOutput","error","rateRequest","requestDetails","c_rating","c_ratingtxt","ratingText","arrRating","updateRating","updateRequest","updatetxt","getRequestAttachments","clearForm","updateForm","$setPristine","$setUntouched","showUpdatePanel","status","showAuthPanel","showClosure","showCancellation","showRequestCost","showRequestAuthComponents","isDefined","authComponents","length","showBPM","bpm_workflow_id","showExtData","extendedData","progressTypeClass","prType","progressSpacer","progress","type","workflowProgression","bpmDetails","bpm_progress_perc","progressPerc","push","title","value","bpm_stage_title","bpm_status_id","getWorkflowProgression","progRecords","getBPMExtendedTableData","buildProgressionBars","openTableAdminModal","adminModalSchema","adminModalContent","modalInstance","open","animation","templateUrl","resolve","items","recordPage","result","checkActiveSession","callclass","isRequestAuth","authResponse","authTitle","authDescription","description","compPrice","request_comp_price","slaPrice","request_sla_price","totalPrice","request_price","authDecisions","custDetails","fk_manager","getRequestAuthComponents","authCompResponse","getRequestComponents","getAssetsTableStructure","outputSQLColumns","getRequestAssets","getIcon","getStyle"],"mappings":"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","file":"request.details.ctrl.js","sourcesContent":["(function () {\r\n    'use strict';\r\n    angular\r\n        .module('swSelfService')\r\n        .controller('RequestDetailsController', RequestDetailsController);\r\n\r\n    RequestDetailsController.$inject = ['$q','$scope','$rootScope','SWSessionService','$stateParams','RequestDetailsService','$state', 'RequestInteractService', 'wssHelpers','wssLogging','$previousState', 'store','$uibModal','$timeout'];\r\n\r\n    function RequestDetailsController($q, $scope, $rootScope, SWSessionService, $stateParams, RequestDetailsService, $state, RequestInteractService, wssHelpers, wssLogging, $previousState, store, $uibModal, $timeout)\r\n    {\r\n      //Get previous state\r\n      var previousState = $previousState.get();\r\n      $scope.isWssAdmin = wssHelpers.hasWebflag('OPTION_ADMIN');\n\n      //-- Initialise Rating Stars\n      $scope.ratingValue = null;\n      $scope.ratingStates = [\n        {stateOn: 'fa fa-star fa-1x', stateOff: 'fa fa-star-o fa-1x'},\n        {stateOn: 'fa fa-star fa-1x', stateOff: 'fa fa-star-o fa-1x'},\n        {stateOn: 'fa fa-star fa-1x', stateOff: 'fa fa-star-o fa-1x'}\n      ];\n\n      //Accordion Settings for side panel\r\n      $scope.accStatus = {\r\n        closeOthers: true,\r\n        detailsOpen: true,\r\n        bpmOpen: false,\r\n        extDataOpen: false\r\n      };\r\n\r\n      //Booleans for view initialisation\r\n      $scope.haveRights = false;\r\n      $scope.authRequired = false;\r\n\r\n      //Booleans for spinner directive control\r\n      $scope.loadingRequest = true;\r\n      $scope.loadingDiary = true;\r\n      $scope.loadingAttachments = true;\r\n      $scope.loadingAssets = true;\r\n      $scope.loadingComponents = true;\r\n\r\n      //Booleans for Ladda directive control\r\n      $scope.ratingRequest = false;\r\n      $scope.updatingRequest = false;\r\n      $scope.closingRequest = false;\r\n      $scope.cancellingRequest = false;\r\n      $scope.addingFiles = false;\r\n      $scope.authorisingRequest = false;\r\n\r\n      $scope.updateType = '';\r\n      $scope.callClass = '';\r\n      $scope.classAssets = false;\r\n      $scope.classComponents = false;\r\n\r\n      $scope.workflowObject = [];\r\n      $scope.workflowHasProgression = false;\r\n\r\n      //Clean out the new file attachments model\r\n      $scope.newFileAttachments = [];\r\n\r\n      $scope.requestID = $stateParams.requestID;\r\n\r\n      //Scope objects for details and interaction services\r\n      $scope.requestService = RequestDetailsService;\r\n      $scope.requestUpdateService = RequestInteractService;\r\n\r\n      //Watch for logout broadcast to clean up session-specific data ready for a new user\r\n      $scope.$on('logout',function(){\r\n        $scope.requestService  = {};\r\n        $scope.requestUpdateService  = {};\r\n      });\r\n\r\n      //Check size of files being attached\r\n      $scope.checkFiles = function (event, reader, fileList) {\r\n        $scope.addingFiles = true;\r\n        if (fileList.size > 10000000) {\r\n          var toastType = \"error\";\r\n          var toastBody = \"File [\"+fileList.name+\"] is too big!\";\r\n          var toastTitle = \"File Size Error!\";\r\n          wssLogging.sendToast(toastType, toastBody, toastTitle);\r\n          reader.abort();\r\n        }\r\n      };\r\n\r\n      //\r\n      $scope.filesAdded = function(event, reader, fileObjs, file){\r\n        $scope.addingFiles = false;\r\n      };\r\n\r\n      //back button function\r\n      $scope.requestList = function() {\r\n        if(previousState){\r\n          $state.go(previousState.state.name, {});\r\n        } else {\r\n          $state.go('home', {});\r\n        }\r\n      };\r\n\r\n      //Process authorisation decision\r\n      $scope.authRequest = function () {\r\n        $scope.authorisingRequest = true;\r\n        $scope.requestUpdateService.authoriseRequest($scope.requestID, $scope.authText, $scope.authDecision).then(function(response){\r\n          $scope.authRequired = false;\r\n          $scope.authorisingRequest = false;\r\n          var objNewCustDetails = store.get(\"custDetails\");\r\n          objNewCustDetails.authCount = SWSessionService.numAuths;\r\n          store.set(\"custDetails\", objNewCustDetails);\r\n          wssLogging.sendToast('success', 'Your authorisation decision has been set successfully!');\r\n          $scope.loadingDiary = true;\r\n          //now we've authorised, get request details, diary and BPM output again to update the model\r\n          $scope.requestService.getRequestDetails($scope.requestID).then(function(){\r\n            $scope.requestService.getRequestDiary($scope.requestID).then(function(){\r\n              $scope.buildBPMOutput();\r\n              $scope.loadingDiary = false;\r\n            });\r\n          });\r\n        }, function(error) {\r\n          var toastType = \"error\";\r\n          var toastBody = 'Authorisation of this request has failed.';\r\n          var toastTitle = \"Request Authorisation Failed!\";\r\n          wssLogging.sendToast(toastType, toastBody, toastTitle);\r\n          $scope.authorisingRequest = false;\r\n        });\r\n      };\r\n\r\n      ///Rate the request in the current scope\r\n      $scope.rateRequest = function() {\r\n        if($scope.requestService.requestDetails.c_rating == $scope.ratingValue &&\r\n            $scope.requestService.requestDetails.c_ratingtxt == $scope.ratingText) {\r\n          return;\r\n        }\r\n        $scope.ratingRequest = true;\r\n\r\n        $scope.arrRating = {\r\n          'origRating': $scope.requestService.requestDetails.c_rating,\r\n          'newRating': $scope.ratingValue,\r\n          'origText': $scope.requestService.requestDetails.c_ratingtxt,\r\n          'newText': $scope.ratingText\r\n        };\r\n\r\n        $scope.requestUpdateService.updateRating($scope.requestID, $scope.arrRating).then(function(response){\r\n          wssLogging.sendToast('success', $scope.requestID + ' has been rated successfully!');\r\n          $scope.loadingDiary = true;\r\n          $scope.requestService.getRequestDiary($scope.requestID).then(function(){\r\n            $scope.loadingDiary = false;\r\n          });\r\n          $scope.ratingRequest = false;\r\n        }, function(error) {\r\n          var toastType = \"error\";\r\n          var toastBody = 'The rating of this request has failed.';\r\n          var toastTitle = \"Request Rating Failed!\";\r\n          wssLogging.sendToast(toastType, toastBody, toastTitle);\r\n          $scope.ratingRequest = false;\r\n        });\r\n      };\r\n\r\n\r\n      ///Update the request in the current scope\r\n      $scope.updateRequest = function() {\r\n        switch($scope.updateType){\r\n          case \"Update\":\r\n            $scope.updatingRequest = true;\r\n            break;\r\n          case \"Close\":\r\n            $scope.closingRequest = true;\r\n            break;\r\n          case \"Cancel\":\r\n            $scope.cancellingRequest = true;\r\n            break;\r\n        }\r\n\r\n        //Monitor rating changes\r\n        $scope.arrRating = {\r\n          'origRating': $scope.requestService.requestDetails.c_rating,\r\n          'newRating': $scope.ratingValue,\r\n          'origText': $scope.requestService.requestDetails.c_ratingtxt,\r\n          'newText': $scope.ratingText\r\n        };\r\n\r\n        $scope.requestUpdateService.updateRequest($scope.requestID, $scope.updatetxt, $scope.updateType, $scope.newFileAttachments).then(function(response){\r\n          $scope.newFileAttachments = [];\r\n          var toastType = 'success';\r\n          var toastBody = $scope.requestID + ' has been updated successfully!';\r\n          wssLogging.sendToast(toastType, toastBody);\r\n          $scope.loadingDiary = true;\r\n          $scope.requestService.getRequestDiary($scope.requestID).then(function(){\r\n            $scope.loadingDiary = false;\r\n            $scope.requestService.getRequestAttachments($scope.requestID);\r\n          });\r\n          $timeout(function () {\r\n            $scope.updatingRequest = false;\r\n            $scope.closingRequest = false;\r\n            $scope.cancellingRequest = false;\r\n          }, 500);\r\n        }, function(error) {\r\n          var toastType = \"error\";\r\n          var toastBody = 'The update of this request has failed.';\r\n          if(error === \"Unable to update this request as it in a status that cannot be updated.\"){\r\n            toastBody = error;\r\n          }\r\n          var toastTitle = \"Request Update Failed!\";\r\n          wssLogging.sendToast(toastType, toastBody, toastTitle);\r\n          $timeout(function () {\r\n            $scope.updatingRequest = false;\r\n            $scope.closingRequest = false;\r\n            $scope.cancellingRequest = false;\r\n          }, 500);\r\n        });\r\n        $scope.clearForm();\r\n      };\r\n\r\n      //Clear update form\r\n      $scope.clearForm = function(){\r\n        $scope.updateForm.$setPristine();\r\n        $scope.updateForm.$setUntouched();\r\n        $scope.updatetxt = '';\r\n      };\r\n\r\n\r\n      //Should Update panel be displayed?\r\n      $scope.showUpdatePanel = function() {\r\n        return (wssHelpers.hasWebflag('OPTION_CAN_UPDATE_CALLS') &&\r\n                $scope.requestService.requestDetails.status != \"16\" &&\r\n                $scope.requestService.requestDetails.status != \"17\" &&\r\n                $scope.requestService.requestDetails.status != \"18\"\r\n        );\r\n      };\r\n\r\n      //Should authorisation panel be displayed?\r\n      $scope.showAuthPanel = function() {\r\n        return ($scope.authRequired &&\r\n                wssHelpers.hasWebflag('OPTION_CAN_UPDATE_CALLS') &&\r\n                $scope.requestService.requestDetails.status != \"16\" &&\r\n                $scope.requestService.requestDetails.status != \"17\" &&\r\n                $scope.requestService.requestDetails.status != \"18\"\r\n        );\r\n      };\r\n\r\n      //Show the close request button?\r\n      $scope.showClosure = function() {\r\n        return (wssHelpers.hasWebflag('OPTION_CAN_CLOSE_CALLS') && ($scope.callClass == 'Incident' || $scope.callClass == 'Change Request') );\r\n      };\r\n\r\n      //Show the cancel request button?\r\n      $scope.showCancellation = function() {\r\n        return ($scope.callClass === 'Service Request');\r\n      };\r\n\r\n      //Show the cost of request for Service Requests\r\n      $scope.showRequestCost = function() {\r\n        return ($scope.callClass === 'Service Request');\r\n      };\r\n\r\n      //Show authorisation components\r\n      $scope.showRequestAuthComponents = function() {\r\n        if(!angular.isDefined($scope.authComponents)){\r\n          return false;\r\n        }\r\n        return ($scope.callClass === 'Service Request' && $scope.authComponents.length > 0);\r\n      };\r\n\r\n      //Show the BPM accordion panel\r\n      $scope.showBPM = function() {\r\n        return (angular.isDefined($scope.requestService.requestDetails.bpm_workflow_id) && $scope.requestService.requestDetails.bpm_workflow_id !== \"\");\r\n      };\r\n\r\n      //Show the BPM Extended Data accordion panel\r\n      $scope.showExtData = function(){\r\n        if(!angular.isDefined($scope.workflowObject.extendedData)){\r\n          return false;\r\n        }\r\n        return ($scope.workflowObject.extendedData.length > 0);\r\n      };\r\n\r\n      //Pass back class for progression boxes\r\n      $scope.progressTypeClass = function(prType){\r\n        return \"bpm_pr_box_\"+prType;\r\n      };\r\n\r\n      //Is current progress bar a spacer?\r\n      $scope.progressSpacer = function(progress){\r\n        return (progress.type === \"\");\r\n      };\r\n\r\n      //Build the data objects required to output the BPM and Extended Data accordions\r\n      $scope.buildBPMOutput = function(){\r\n        //Define workflow data object and children\r\n        $scope.workflowObject = [];\r\n        $scope.workflowObject.workflowProgression = [];\r\n        $scope.workflowObject.extendedData = [];\r\n        $scope.workflowObject.bpmDetails = [];\r\n        $scope.workflowObject.workflowHasProgression = false;\r\n\r\n        if(angular.isDefined($scope.requestService.requestDetails.bpm_progress_perc)){\r\n          $scope.workflowObject.progressPerc = $scope.requestService.requestDetails.bpm_progress_perc;\r\n        } else {\r\n          $scope.workflowObject.progressPerc = \"0\";\r\n        }\r\n\r\n        //BPM Details\r\n        $scope.workflowObject.bpmDetails.push({\r\n          title: 'Process',\r\n          value: $scope.requestService.requestDetails.bpm_workflow_id\r\n        });\r\n        $scope.workflowObject.bpmDetails.push({\r\n          title: 'Stage',\r\n          value: $scope.requestService.requestDetails.bpm_stage_title\r\n        });\r\n        $scope.workflowObject.bpmDetails.push({\r\n          title: 'Status',\r\n          value: $scope.requestService.requestDetails.bpm_status_id\r\n        });\r\n\r\n        //Get workflow progression records\r\n        $scope.requestService.getWorkflowProgression().then(function(progRecords){\r\n          //Get extended table data (if exists)\r\n          $scope.workflowObject.extendedData = $scope.requestService.getBPMExtendedTableData();\r\n          //Build progression bar data\r\n          if(progRecords.length > 0) {\r\n            $scope.workflowObject.workflowProgression = $scope.requestService.buildProgressionBars(progRecords);\r\n            $scope.workflowObject.workflowHasProgression = true;\r\n          }\r\n\r\n        }, function(error){\r\n          var toastType = 'error';\r\n          var toastBody = 'Unable to retrieve the workflow details for this request.';\r\n          var toastTitle = 'Request Workflow Error';\r\n          wssLogging.sendToast(toastType, toastBody, toastTitle);\r\n        });\r\n      };\r\n\r\n      $scope.openTableAdminModal = function(){\r\n        $rootScope.adminModalSchema = 'table.schema';\r\n        $rootScope.adminModalContent = 'table.request.assets';\r\n        var modalInstance = $uibModal.open({\r\n          animation: true,\r\n          templateUrl: 'templates/admin/modal.tableconfig.tpl.html',\r\n          controller: 'AdminTableController',\r\n          size: 'lg',\r\n          resolve: {\r\n            items: function () {\r\n              return 'requests.'+$rootScope.recordPage;\r\n            }\r\n          }\r\n        });\r\n        modalInstance.result.then(function () {\r\n          //Saved changes - broadcast message to refresh form\r\n\r\n        }, function () {\r\n          //Cancelled modal - do nothing\r\n        });\r\n      };\r\n\r\n      //Check session, if active then get request details - this runs when the controller is initialised\r\n      SWSessionService.checkActiveSession().then(function(){\r\n        $scope.requestService.getRequestDetails($scope.requestID).then(function(){\r\n          $scope.loadingRequest = false;\r\n          $scope.haveRights = true;\r\n          $scope.ratingValue = $scope.requestService.requestDetails.c_rating;\r\n          $scope.ratingText = $scope.requestService.requestDetails.c_ratingtxt;\r\n          $scope.callClass = $scope.requestService.requestDetails.callclass;\r\n\r\n          //Does the request need authorising by the session customer?\r\n          $scope.requestService.isRequestAuth().then(function(authResponse){\r\n            \r\n\t\t\tif (authResponse)\r\n\t\t\t{\r\n\t\t\t\t$scope.authRequired = true;\r\n\t\t\t\t$scope.authTitle = authResponse.title;\r\n\t\t\t\t$scope.authDescription = authResponse.description;\r\n\t\t\t\t$scope.compPrice = authResponse.request_comp_price;\r\n\t\t\t\t$scope.slaPrice = authResponse.request_sla_price;\r\n\t\t\t\t$scope.totalPrice = authResponse.request_price;\r\n\t\t\t\t$scope.authDecisions = [];\r\n\t\t\t\t$scope.authDecisions[0] = 'Authorised';\r\n\t\t\t\t$scope.authDecisions[1] = 'Rejected';\r\n\t\t\t\tif($scope.requestService.custDetails.fk_manager != \"\")\r\n\t\t\t\t{\r\n\t\t\t\t\t$scope.authDecisions[2] = 'Pass to my manager';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t\r\n          });\r\n\r\n          //If Service Request, get service authorisation components\r\n          if($scope.callClass === 'Service Request'){\r\n            $scope.authComponents = [];\r\n            $scope.requestService.getRequestAuthComponents().then(function(authCompResponse){\r\n              $scope.authComponents = authCompResponse;\r\n            });\r\n          }\r\n          //Build BPM object\r\n          $scope.buildBPMOutput();\r\n\r\n          //Get the call diary\r\n          $scope.requestService.getRequestDiary($scope.requestID).then(function(){\r\n              $scope.loadingDiary = false;\r\n\r\n              //Show any relevant file attachments against the request\r\n              $scope.requestService.getRequestAttachments($scope.requestID).then(function(response){\r\n                $scope.loadingAttachments = false;\r\n              }, function(error){\r\n                $scope.loadingAttachments = false;\r\n              });\r\n\r\n              if($scope.requestService.requestDetails.callclass == \"Service Request\" ) {\r\n                $scope.classComponents = true;\r\n                //Get request components for calls of class Service Request\r\n                $scope.requestService.getRequestComponents($scope.requestID).then(function(){\r\n                    $scope.loadingComponents = false;\r\n                });\r\n              } else {\r\n                $scope.classAssets = true;\r\n                //Get request assets/services for calls of class !Service Request\r\n                $scope.requestService.getAssetsTableStructure().then(function(response){\r\n                  if(angular.isDefined(response.outputSQLColumns) && response.outputSQLColumns !== ''){\r\n                    $scope.requestService.getRequestAssets($scope.requestID).then(function(){\r\n                      $scope.loadingAssets = false;\r\n                    }, function(error){\r\n                      $scope.loadingAssets = false;\r\n                      var toastTitle = 'Asset Load Failed!';\r\n                      var toastType = 'error';\r\n                      var toastBody = 'The retrieval of the assets for this request has failed.';\r\n                      wssLogging.sendToast(toastType, toastBody, toastTitle);\r\n                    });\r\n                  } else {\r\n                    var toastTitle = 'Affected Items Load Failed!';\r\n                    var toastType = 'error';\r\n                    var toastBody = 'No Schema could be loaded for the Affected Items table.';\r\n                    wssLogging.sendToast(toastType, toastBody, toastTitle);\r\n                  }\r\n                }, function(error){\r\n                  $scope.loadingAssets = false;\r\n                  var toastTitle = 'Affected Items Load Failed!';\r\n                  var toastType = 'error';\r\n                  var toastBody = 'No Schema could be loaded for the Affected Items table.';\r\n                  wssLogging.sendToast(toastType, toastBody, toastTitle);\r\n                });\r\n              }\r\n          });\r\n        }, function(error){\r\n          $scope.haveRights = false;\r\n          $scope.loadingRequest = false;\r\n          $scope.loadingDiary = false;\r\n          $scope.loadingAttachments = false;\r\n          $scope.loadingAssets = false;\r\n          $scope.loadingComponents = false;\r\n          var toastTitle = 'Request View Failed!';\r\n          var toastType = 'error';\r\n          var toastBody = 'Unable to retrieve the details of this request. Please contact your System Administrator.';\r\n          wssLogging.sendToast(toastType, toastBody, toastTitle);\r\n        });\r\n      }, function(){\r\n        //Session error\r\n      });\r\n\r\n      $scope.getIcon = function(callclass) {\r\n        switch (callclass) {\r\n          case \"Incident\":\r\n          return \"fa-exclamation-triangle\";\r\n          case \"Service Request\":\r\n          return \"fa-bullhorn\";\r\n          case \"Change Request\":\r\n          return \"fa-plus-circle\";\r\n          default:\r\n          return \"fa-tasks\";\r\n        }\r\n      };\r\n\r\n      $scope.getStyle = function(callclass) {\r\n        switch (callclass) {\r\n          case \"Incident\":\r\n          return \"color:orange;\";\r\n          case \"Service Request\":\r\n          return \"color: green;\";\r\n          case \"Change Request\":\r\n          return \"color: purple;\";\r\n          default:\r\n          return \"\";\r\n        }\r\n      };\r\n    }\r\n})();\r\n"]}