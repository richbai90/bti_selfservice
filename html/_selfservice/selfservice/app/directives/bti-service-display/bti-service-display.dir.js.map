{"version":3,"sources":["../../../../_itsm_default_v2_template/app/directives/bti-service-display/bti-service-display.dir.js"],"names":["angular","module","directive","btiServiceDisplayDirective","servicesService","swSession","$q","catServ","$rootScope","$state","wssHelpers","store","wssLogging","$window","restrict","templateUrl","scope","controller","ServiceCategoryDirectiveController","$scope","custServices","selectedCategory","selectCategory","row","col","currCat","_categories","categories","selected","catTreeData","addServicesToCategories","services","i","length","Array","isArray","children","reduce","acc","service","pk_config_type","content","push","checkActiveSession","then","getCustServices","getCatTreeData","cat","hasOwnProperty","parentlabel","open","deferred","defer","getTreeData","response","resolve","promise","firstOpen","getCategorySize","Math","floor","isFav","serviceId","isDefined","favServices","addFav","subsId","servId","addCustomerFavourite","error","toastType","toastBody","toastTitle","sendToast","delFav","delCustomerFavourite","canRaiseIncident","flg_allow_support","canLogCall","listType","canRaiseRequest","flg_allow_request","canAddFav","hasWebflag","raiseRequest","requestClass","remove","dfId","dfClass","fk_df_support","fk_df_onreq","fk_df_onsub","dataFormID","dataFormClass","getSubscriptionRecord","subs_id","objSubscription","objRequest","serviceDetails","subscription","set","go","logger","vsb_title","selectCategoryGroup","evt","stopPropagation","$on"],"mappings":"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","file":"bti-service-display.dir.js","sourcesContent":["(function () {\r\n  'use strict';\r\n  angular\r\n    .module('swSelfService')\r\n    .directive('btiServiceDisplay', [\r\n      'ServicesService',\r\n      'SWSessionService',\r\n      '$q',\r\n      'ServiceCategoryService',\r\n      '$rootScope',\r\n      '$state',\r\n      'wssHelpers',\r\n      'store',\r\n      'wssLogging',\r\n      '$window',\r\n      btiServiceDisplayDirective,\r\n    ]);\r\n\r\n  function btiServiceDisplayDirective(servicesService, swSession, $q, catServ, $rootScope, $state, wssHelpers, store, wssLogging, $window) {\r\n    return {\r\n      restrict: 'E',\r\n      templateUrl: 'app/directives/bti-service-display/service-display.tpl.html',\r\n      scope: {},\r\n      controller: ServiceCategoryDirectiveController,\r\n    };\r\n\r\n    function ServiceCategoryDirectiveController($scope) {\r\n      $scope.custServices = servicesService;\r\n      var selectedCategory = [0, 0];\r\n      $scope.selectCategory = function (row, col) {\r\n        $scope.currCat = _categories[row][col];\r\n        $scope.categories[selectedCategory[0]][selectedCategory[1]].selected = false;\r\n        $scope.categories[row][col].selected = true;\r\n        selectedCategory = [row, col];\r\n      };\r\n\r\n      var _categories = [];\r\n      var catTreeData = [];\r\n\r\n      function addServicesToCategories(categories, services) {\r\n        for (var i = 0; i < categories.length; i++) {\r\n          if (Array.isArray(categories[i])) {\r\n            addServicesToCategories(categories[i], services)\r\n          } else {\r\n            if (categories[i].children.length > 0) {\r\n              addServicesToCategories(categories[i].children, services);\r\n            }\r\n\r\n            categories[i].services = services.reduce(function (acc, service) {\r\n              if (service.pk_config_type === categories[i].content) {\r\n                acc.push(service);\r\n              }\r\n\r\n              return acc;\r\n\r\n            }, [])\r\n          }\r\n        }\r\n      }\r\n\r\n      //Check session, if active then get all services\r\n      swSession.checkActiveSession().then(function () {\r\n        servicesService.getCustServices().then(function (services) {\r\n          getCatTreeData().then(function (categories) {\r\n            _categories.push(categories.reduce(function (acc, cat) {\r\n              if (!cat.hasOwnProperty('children')) {\r\n                cat.children = [];\r\n              }\r\n              if (cat.parentlabel === '') {\r\n                cat.open = true;\r\n                cat.selected = false;\r\n                if (acc.length < 6) {\r\n                  acc.push(cat)\r\n                } else {\r\n                  _categories.push(acc);\r\n                  acc = [];\r\n                  acc.push(cat)\r\n                }\r\n              }\r\n              return acc;\r\n            }, []));\r\n            addServicesToCategories(_categories, services);\r\n            $scope.categories = _categories;\r\n          });\r\n        });\r\n      });\r\n\r\n      function getCatTreeData() {\r\n        var deferred = $q.defer();\r\n        if (catTreeData.length === 0) {\r\n          catServ.getTreeData().then(function (response) {\r\n            catTreeData = response;\r\n            deferred.resolve(catTreeData)\r\n          })\r\n        } else {\r\n          deferred.resolve(catTreeData)\r\n        }\r\n        return deferred.promise;\r\n      }\r\n\r\n      $scope.firstOpen = true;\r\n\r\n      $scope.getCategorySize = function (categories) {\r\n        return Math.floor(12 / categories.length)\r\n      };\r\n\r\n      $scope.isFav = function (serviceId) {\r\n        if (angular.isDefined(servicesService.favServices) && servicesService.favServices[serviceId] === true) {\r\n          return true;\r\n        }\r\n        return false;\r\n      };\r\n\r\n      $scope.addFav = function (subsId, servId) {\r\n        servicesService.addCustomerFavourite(subsId, servId).then(function (response) {\r\n        }, function (error) {\r\n          var toastType = \"error\";\r\n          var toastBody = 'Adding this Service to your list of favourites failed.';\r\n          var toastTitle = \"Service Favourite Failed!\";\r\n          wssLogging.sendToast(toastType, toastBody, toastTitle);\r\n        });\r\n      };\r\n\r\n      $scope.delFav = function (servId) {\r\n        servicesService.delCustomerFavourite(servId).then(function () {\r\n        }, function (error) {\r\n          var toastType = \"error\";\r\n          var toastBody = 'Removing this Service from your list of favourites failed.';\r\n          var toastTitle = \"Service Favourite Failed!\";\r\n          wssLogging.sendToast(toastType, toastBody, toastTitle);\r\n        });\r\n      };\r\n\r\n      $scope.canRaiseIncident = function (service) {\r\n        return (service.flg_allow_support === '1' &&\r\n        $scope.canLogCall() &&\r\n        servicesService.listType !== 'own' &&\r\n        servicesService.listType !== 'unsub');\r\n      };\r\n\r\n      $scope.canRaiseRequest = function (service) {\r\n        return (service.flg_allow_request === '1' &&\r\n        $scope.canLogCall() &&\r\n        servicesService.listType !== 'own' &&\r\n        servicesService.listType !== 'unsub');\r\n      };\r\n\r\n      $scope.canAddFav = function () {\r\n        return (servicesService.listType !== 'own' &&\r\n        servicesService.listType !== 'unsub');\r\n      };\r\n\r\n      $scope.canLogCall = function () {\r\n        return wssHelpers.hasWebflag('OPTION_CAN_LOG_CALLS');\r\n      };\r\n\r\n      $scope.raiseRequest = function (service, requestClass) {\r\n        store.remove(\"currDataForm\");\r\n        var dfId = '0';\r\n        var dfClass = '';\r\n        switch (requestClass) {\r\n          case \"Incident\":\r\n            if (angular.isDefined(service.fk_df_support) && service.fk_df_support > 0) {\r\n              dfId = service.fk_df_support;\r\n              dfClass = requestClass;\r\n            }\r\n            break;\r\n          case \"Service Request\":\r\n            if (angular.isDefined(service.fk_df_onreq) && service.fk_df_onreq > 0) {\r\n              dfId = service.fk_df_onreq;\r\n              dfClass = requestClass;\r\n            }\r\n            break;\r\n          case \"Subscription\":\r\n            if (angular.isDefined(service.fk_df_onsub) && service.fk_df_onsub > 0) {\r\n              dfId = service.fk_df_onsub;\r\n              dfClass = requestClass;\r\n            }\r\n            break;\r\n        }\r\n        $rootScope.dataFormID = dfId;\r\n        $rootScope.dataFormClass = dfClass;\r\n\r\n        if (dfId !== '0') {\r\n          //Get subscription details\r\n          servicesService.getSubscriptionRecord(service.subs_id).then(function (objSubscription) {\r\n            var objRequest = {\r\n              dataFormID: dfId,\r\n              requestClass: dfClass,\r\n              serviceDetails: service,\r\n              subscription: objSubscription\r\n            };\r\n            store.set(\"currDataForm\", objRequest);\r\n            $state.go('requestwizard');\r\n          });\r\n        } else {\r\n          wssLogging.logger('No Wizard has been set up for this Service [' + service.vsb_title + ']. Please contact your Service Desk with the name of the Service to report this configuration issue.', \"ERROR\", \"ServiceListCtrl::raiseRequest\", false, true, \"Request Wizard Error!\");\r\n        }\r\n      };\r\n\r\n      $scope.selectCategoryGroup = function (cat, evt) {\r\n        cat.open = !cat.open;\r\n        evt.stopPropagation();\r\n      };\r\n\r\n      $scope.$on('logout', function () {\r\n        $scope.custServices = {};\r\n      });\r\n\r\n    }\r\n\r\n  }\r\n\r\n\r\n})();"]}